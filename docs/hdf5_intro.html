<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />




<title>HDF</title>

<script src="site_libs/header-attrs-2.25/header-attrs.js"></script>
<script src="site_libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/cosmo.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<style>h1 {font-size: 34px;}
       h1.title {font-size: 38px;}
       h2 {font-size: 30px;}
       h3 {font-size: 24px;}
       h4 {font-size: 18px;}
       h5 {font-size: 16px;}
       h6 {font-size: 12px;}
       code {color: inherit; background-color: rgba(0, 0, 0, 0.04);}
       pre:not([class]) { background-color: white }</style>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<script src="site_libs/clipboard-1.7.1/clipboard.min.js"></script>
<link href="site_libs/primer-tooltips-1.4.0/build.css" rel="stylesheet" />
<link href="site_libs/klippy-0.0.0.9500/css/klippy.min.css" rel="stylesheet" />
<script src="site_libs/klippy-0.0.0.9500/js/klippy.min.js"></script>

<style type="text/css">
  code{white-space: pre-wrap;}
  span.smallcaps{font-variant: small-caps;}
  span.underline{text-decoration: underline;}
  div.column{display: inline-block; vertical-align: top; width: 50%;}
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  ul.task-list{list-style: none;}
    </style>



<style type="text/css">
  code {
    white-space: pre;
  }
  .sourceCode {
    overflow: visible;
  }
</style>
<style type="text/css" data-origin="pandoc">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; } /* Alert */
code span.an { color: #008000; } /* Annotation */
code span.at { } /* Attribute */
code span.bu { } /* BuiltIn */
code span.cf { color: #0000ff; } /* ControlFlow */
code span.ch { color: #008080; } /* Char */
code span.cn { } /* Constant */
code span.co { color: #008000; } /* Comment */
code span.cv { color: #008000; } /* CommentVar */
code span.do { color: #008000; } /* Documentation */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.im { } /* Import */
code span.in { color: #008000; } /* Information */
code span.kw { color: #0000ff; } /* Keyword */
code span.op { } /* Operator */
code span.ot { color: #ff4000; } /* Other */
code span.pp { color: #ff4000; } /* Preprocessor */
code span.sc { color: #008080; } /* SpecialChar */
code span.ss { color: #008080; } /* SpecialString */
code span.st { color: #008080; } /* String */
code span.va { } /* Variable */
code span.vs { color: #008080; } /* VerbatimString */
code span.wa { color: #008000; font-weight: bold; } /* Warning */

</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    var j = 0;
    while (j < rules.length) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") {
        j++;
        continue;
      }
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' && rule.style.backgroundColor === '') {
        j++;
        continue;
      }
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>




<link rel="stylesheet" href="html-md-01.css" type="text/css" />



<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
img {
  max-width:100%;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
details > summary > p:only-child {
  display: inline;
}
pre code {
  padding: 0;
}
</style>


<style type="text/css">
.dropdown-submenu {
  position: relative;
}
.dropdown-submenu>.dropdown-menu {
  top: 0;
  left: 100%;
  margin-top: -6px;
  margin-left: -1px;
  border-radius: 0 6px 6px 6px;
}
.dropdown-submenu:hover>.dropdown-menu {
  display: block;
}
.dropdown-submenu>a:after {
  display: block;
  content: " ";
  float: right;
  width: 0;
  height: 0;
  border-color: transparent;
  border-style: solid;
  border-width: 5px 0 5px 5px;
  border-left-color: #cccccc;
  margin-top: 5px;
  margin-right: -10px;
}
.dropdown-submenu:hover>a:after {
  border-left-color: #adb5bd;
}
.dropdown-submenu.pull-left {
  float: none;
}
.dropdown-submenu.pull-left>.dropdown-menu {
  left: -100%;
  margin-left: 10px;
  border-radius: 6px 0 6px 6px;
}
</style>

<script type="text/javascript">
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark the anchor link active (and if it's in a dropdown, also mark that active)
  var dropdown = menuAnchor.closest('li.dropdown');
  if (window.bootstrap) { // Bootstrap 4+
    menuAnchor.addClass('active');
    dropdown.find('> .dropdown-toggle').addClass('active');
  } else { // Bootstrap 3
    menuAnchor.parent().addClass('active');
    dropdown.addClass('active');
  }

  // Navbar adjustments
  var navHeight = $(".navbar").first().height() + 15;
  var style = document.createElement('style');
  var pt = "padding-top: " + navHeight + "px; ";
  var mt = "margin-top: -" + navHeight + "px; ";
  var css = "";
  // offset scroll position for anchor links (for fixed navbar)
  for (var i = 1; i <= 6; i++) {
    css += ".section h" + i + "{ " + pt + mt + "}\n";
  }
  style.innerHTML = "body {" + pt + "padding-bottom: 40px; }\n" + css;
  document.head.appendChild(style);
});
</script>

<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before, .tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "\e259";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "\e258";
  font-family: 'Glyphicons Halflings';
  border: none;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
  background-color: transparent;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<!-- code folding -->




</head>

<body>


<div class="container-fluid main-container">




<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-bs-toggle="collapse" data-target="#navbar" data-bs-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">R for Earth-System Science</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="overview.html">Overview</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Topics
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li class="dropdown-header">Lecture topics</li>
    <li>
      <a href="intro.html">Introduction: R, RStudio, and other infrastructure</a>
    </li>
    <li>
      <a href="usingR.html">Using R</a>
    </li>
    <li>
      <a href="ESSdata.html">Earth-system science data</a>
    </li>
    <li>
      <a href="netCDF.html">netCDF in R</a>
    </li>
    <li>
      <a href="netcdf_terra.html">netCDF and terra</a>
    </li>
    <li>
      <a href="plots1.html">Plots (1)</a>
    </li>
    <li>
      <a href="plots1.html">Plots (2)</a>
    </li>
    <li>
      <a href="maps1.html">Maps (1)</a>
    </li>
    <li>
      <a href="maps2.html">Maps (2)</a>
    </li>
    <li>
      <a href="geospatial.html">Geospatial analyses</a>
    </li>
    <li>
      <a href="correlation.html">Correlation and regression</a>
    </li>
    <li>
      <a href="prediction.html">Prediction</a>
    </li>
    <li>
      <a href="pca.html">PCA</a>
    </li>
    <li>
      <a href="svd.html">Singular Value Decomposistion</a>
    </li>
    <li>
      <a href="highdim.html">High-resolution &amp; high-dimensional data</a>
    </li>
    <li>
      <a href="multivariate.html">Multivariate methods</a>
    </li>
    <li>
      <a href="timeseries.html">Time-series analysis</a>
    </li>
    <li>
      <a href="otherlang.html">Other Languages</a>
    </li>
    <li class="dropdown-header">Other topics</li>
    <li>
      <a href="sf_stars_sftime.html">sf / stars / sftime</a>
    </li>
    <li>
      <a href="hdf5_intro.html">HDF in R</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Tasks
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li class="dropdown-header">Tasks</li>
    <li>
      <a href="installR.html">Install R and RStudio</a>
    </li>
    <li>
      <a href="Ex_UsingR.html">Using R exercise</a>
    </li>
    <li>
      <a href="install_netCDF.html">Install netCDF &amp; Panoply</a>
    </li>
    <li>
      <a href="transfer.html">File transfer</a>
    </li>
    <li>
      <a href="texteditor.html">Install a text editor</a>
    </li>
    <li>
      <a href="dataselection.html">Project data set selection</a>
    </li>
    <li>
      <a href="markdown.html">Markdown and RMarkdown</a>
    </li>
    <li>
      <a href="pandoc.html">Pandoc</a>
    </li>
    <li>
      <a href="GitHub.html">GitHub and UO pages.uoregon.edu</a>
    </li>
    <li>
      <a href="localweb.html">Local websites</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Other
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="readings.html">Readings</a>
    </li>
    <li>
      <a href="websites.html">Old course web pages</a>
    </li>
  </ul>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="about.html">About</a>
</li>
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div id="header">



<h1 class="title toc-ignore">HDF</h1>

</div>

<div id="TOC">
<ul>
<li><a href="#introduction" id="toc-introduction"><span
class="toc-section-number">1</span> Introduction</a></li>
<li><a href="#preliminary-set-up" id="toc-preliminary-set-up"><span
class="toc-section-number">2</span> Preliminary set up</a>
<ul>
<li><a href="#convert-an-hdf4-file-to-hdf5"
id="toc-convert-an-hdf4-file-to-hdf5"><span
class="toc-section-number">2.1</span> Convert an HDF4 file to
HDF5</a></li>
</ul></li>
<li><a href="#read-a-simple-hdf5-file"
id="toc-read-a-simple-hdf5-file"><span
class="toc-section-number">3</span> Read a simple HDF5 file</a>
<ul>
<li><a href="#plot-the-uv-data" id="toc-plot-the-uv-data"><span
class="toc-section-number">3.1</span> Plot the UV data</a></li>
</ul></li>
<li><a href="#read-a-more-complicated-hdf5-file"
id="toc-read-a-more-complicated-hdf5-file"><span
class="toc-section-number">4</span> Read a more complicated HDF5
file</a>
<ul>
<li><a href="#plot-the-gfed-burned-fraction-data"
id="toc-plot-the-gfed-burned-fraction-data"><span
class="toc-section-number">4.1</span> plot the GFED burned fraction
data</a></li>
</ul></li>
</ul>
</div>

<script>
  addClassKlippyTo("pre.r, pre.markdown");
  addKlippy('right', 'top', 'auto', '1', 'Copy code', 'Copied!');
</script>
<p><span style="color: green;"><strong>NOTE:  This page has been revised
for the 2024 version of the course, but there may be some additional
edits.</strong>   <br></p>
<div id="introduction" class="section level1" number="1">
<h1><span class="header-section-number">1</span> Introduction</h1>
<p>HDF (Hierarchical Data Format), see <a
href="https://www.hdfgroup.org">[https://www.hdfgroup.org]</a> is
another format for storing large data files and associated metadata,
that is not unrealted to netCDF, because in fact netCDF-4 uses the HDF-5
“data model” to store data. There are currently two versions of HDF in
use HDF4 and HDF5, and two special cases designed for handling satellite
remote-sensing data (HDF-EOS and HDF-EOS5). Unlike netCDF-4, which is
backward compatible with netCDF-3, the two versions are not mutually
readible, but there are tools for converting between the different
versions (as well as for converting HDF files to netCDF files).</p>
<p>HDF5 files can be read and written in R using the <code>rhdf5</code>
package, which is part of the Bioconductor collection of packages. HDF4
files can also be handled via the <code>rgdal</code> package, but the
process is more cumbersome. Consequently, the current standard approach
for analyzing HDF4 data in R is to first convert it to HDF5 or netCDF,
and proceed from there using <code>rhdf5</code>.</p>
<p>Compared to netCDF files, HDF files can be messy: they can contain
images as well as data, and HDF5 files in particular may contain groups
of datasets, which emulated in some ways the folder/directory stucture
on a local machine. This will become evident below.</p>
</div>
<div id="preliminary-set-up" class="section level1" number="2">
<h1><span class="header-section-number">2</span> Preliminary set up</h1>
<p>The <code>rhdf5</code> package can be retrieved from Bioconductor,
and installed as follows. Generally, a lot of dependent packages will
also need to be installed as well, but the process is usually
straightforward.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a><span class="co"># install rhdf5</span></span>
<span id="cb1-2"><a href="#cb1-2" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">requireNamespace</span>(<span class="st">&quot;rhdf5&quot;</span>, <span class="at">quietly =</span> <span class="cn">TRUE</span>))</span>
<span id="cb1-3"><a href="#cb1-3" tabindex="-1"></a>  <span class="fu">install.packages</span>(<span class="st">&quot;BiocManager&quot;</span>)</span>
<span id="cb1-4"><a href="#cb1-4" tabindex="-1"></a>BiocManager<span class="sc">::</span><span class="fu">install</span>(<span class="st">&quot;rhdf5&quot;</span>, <span class="at">version =</span> <span class="st">&quot;3.18&quot;</span>, <span class="at">force =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<p>The examples below use data from TEMIS, the Tropospheric Emission
Monitoring Internet Service (<a
href="http://www.temis.nl/index.php">[http://www.temis.nl/index.php]</a>),
and the Global Fire Emissions Database (GFED, <a
href="https://www.globalfiredata.org/index.html">[https://www.globalfiredata.org/index.html]</a>).
The TEMIS data are HDF4 and need to be converted, while the GFED data
are HDF5. The specific data sets can be found on the ClimateLab SFTP
server.</p>
<p>The various conversion tasks and tools are:</p>
<ul>
<li>HDF4 to HDF5: <code>h4toh5convert</code> from the HDFGroup <a
href="https://portal.hdfgroup.org/downloads/h4h5tools/h4h5tools_2_2_5.html">[h4h5tools]</a></li>
<li>HDF4 to netCDF: <code>h4tonccf</code> (netCDF-3), and
<code>h4tonccf_nc4</code> (netCDF-4), from HDF-EOS <a
href="http://hdfeos.org/software/h4cflib.php">[http://hdfeos.org/software/h4cflib.php]</a></li>
<li>HDF4 and HDF5 (and other file types) to netCDF:
<code>ncl_convert2nc</code> from Unidata <a
href="https://www.ncl.ucar.edu/overview.shtml">[https://www.ncl.ucar.edu/]</a></li>
</ul>
<p>The first two conversion tools have installers for MacOS, Windows and
Linux. On the Mac, it will usually be the case that the executable file
should be moved to the /Applications folder, while on Windows the usual
fooling around with paths will be required. The
<code>ncl_convert2nc</code> tool is part of NCL, which can be installed
on run on Windows 10/11 machines using the Linux subsystem for Windows
(WSL2.</p>
<p>There are some useful tutorials on using HDF in R from the NSF NEON
program:</p>
<ul>
<li><a
href="http://neonscience.github.io/neon-data-institute-2016//R/intro-hdf5-R/">[intro-hdf5-R]</a></li>
<li><a
href="https://www.neonscience.org/hdf5-intro-r">[hdf5-intro-r]</a></li>
<li><a
href="https://github.com/NEONScience/NEON-Data-Skills/tree/master/code/HDF5">[HDF5]</a></li>
</ul>
<p>Begin by loading the appropriate packages:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" tabindex="-1"></a><span class="co"># load packages</span></span>
<span id="cb2-2"><a href="#cb2-2" tabindex="-1"></a><span class="fu">library</span>(sf)</span>
<span id="cb2-3"><a href="#cb2-3" tabindex="-1"></a><span class="fu">library</span>(rhdf5)</span>
<span id="cb2-4"><a href="#cb2-4" tabindex="-1"></a><span class="fu">library</span>(terra)</span>
<span id="cb2-5"><a href="#cb2-5" tabindex="-1"></a><span class="fu">library</span>(RColorBrewer)</span></code></pre></div>
<p>For latter plotting of the data, also read a world outline file. The
file(s) can be copied from the class RESS server, or by downloading the
contents of the folder at <a
href="https://pages.uoregon.edu/bartlein/RESS/shp_files/world2015/">[https://pages.uoregon.edu/bartlein/RESS/shp_files/world2015/]</a>.
Clicking on this link should open a file listing on the server, from
which you can download the files. Note that shape files consist of
multiple files, e.g. <code>*.shp</code>, <code>*.shx</code>,
<code>*.dbf</code>, <code>*.prj</code>, <code>cpg</code>, and all must
be downloaded.Alternatively you could use FileZilla to download the
files from the course SFTP server. Note that shape files consist of
multiple files, e.g. <code>*.shp</code>, <code>*.shx</code>,
<code>*.dbf</code>, <code>*.prj</code>, <code>cpg</code>, and all must
be downloaded.</p>
<p>Move the download files to a convenient folder,
e.g. <code>/Users/bartlein/Projects/ESSD/data/shp_files/world2015/</code>,
and plot the outlines.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" tabindex="-1"></a><span class="co"># plot the world outline</span></span>
<span id="cb3-2"><a href="#cb3-2" tabindex="-1"></a>shp_file <span class="ot">&lt;-</span> <span class="st">&quot;/Users/bartlein/Projects/RESS/data/shp_files/world2015/UIA_World_Countries_Boundaries.shp&quot;</span></span>
<span id="cb3-3"><a href="#cb3-3" tabindex="-1"></a>world_outline <span class="ot">&lt;-</span> <span class="fu">as</span>(<span class="fu">st_geometry</span>(<span class="fu">read_sf</span>(shp_file)), <span class="at">Class =</span> <span class="st">&quot;Spatial&quot;</span>)</span>
<span id="cb3-4"><a href="#cb3-4" tabindex="-1"></a><span class="fu">plot</span>(world_outline, <span class="at">col=</span><span class="st">&quot;lightblue&quot;</span>, <span class="at">lwd=</span><span class="dv">1</span>)</span></code></pre></div>
<p><img src="hdf5_intro_files/figure-html/hdf5-intro-1-1.png" width="75%" height="75%" /></p>
<p>Convert the <code>world_outline</code> to a spatial vector for adding
to <code>terra</code> maps later.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" tabindex="-1"></a><span class="co"># convert world_outline to a spatial vector</span></span>
<span id="cb4-2"><a href="#cb4-2" tabindex="-1"></a>world_otl <span class="ot">&lt;-</span> <span class="fu">vect</span>(world_outline)</span>
<span id="cb4-3"><a href="#cb4-3" tabindex="-1"></a><span class="fu">class</span>(world_otl)</span></code></pre></div>
<pre><code>## [1] &quot;SpatVector&quot;
## attr(,&quot;package&quot;)
## [1] &quot;terra&quot;</code></pre>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" tabindex="-1"></a><span class="fu">plot</span>(world_otl)</span></code></pre></div>
<p><img src="hdf5_intro_files/figure-html/convert_outline-1.png" width="75%" height="75%" /></p>
<div id="convert-an-hdf4-file-to-hdf5" class="section level2"
number="2.1">
<h2><span class="header-section-number">2.1</span> Convert an HDF4 file
to HDF5</h2>
<p>Here’s a link to the <code>.hdf</code> file: <a
href="https://pages.uoregon.edu/bartlein/RESS/hdf_files/uvief20190423.hdf">[https://pages.uoregon.edu/bartlein/RESS/hdf_files/hdf_files/uvief20190423.hdf/]</a>.
Download the file and copy the file a convenient places, say, a folder
<code>/hdf_files</code> in your data folder
(e.g. <code>/Users/bartlein/Projects/ESSD/data/hdf_files/</code>)</p>
<p>In this example, a data set of the “Clear-Sky UV Index”” from TEMIS
was downloaded (i.e. <code>uvief20190423.hdf</code> – 2019-04-23) from
the website listed above. This is an HDF4 file, which can be verified in
Panoply. Viewing files in Panoply is always good practice–in this case
the particular layout of the data in file is rather ambiguous at first
glance, and so getting a look at the contents of the file before
attempting to read it is a good idea.</p>
<p>The HDF4 file can be converted by typing in a terminal or command
window (for example):</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" tabindex="-1"></a>h4toh5convert uvief20190423.hdf</span>
<span id="cb7-2"><a href="#cb7-2" tabindex="-1"></a><span class="co"># or, e.g.: /Users/bartlein/Downloads/hdf/HDF_Group/H4H5/2.2.5/bin/h4toh5convert GFED4.0_DQ_2015270_BA.hdf</span></span>
<span id="cb7-3"><a href="#cb7-3" tabindex="-1"></a><span class="co"># if the h4toh5convert.exe program isn&#39;t in the PATH</span></span></code></pre></div>
<p>This will create the file <code>uvief20190423.h5</code>. (Note that
an explicit output filename and path can be included. Not everything in
the HDF4 file will be converted, and it’s likely that a number of error
messages will appear, giving the impression that the operation has
failed. Check to see whether in fact the HDF5 was indeed created, and
has something in it (via Panoply).)</p>
</div>
</div>
<div id="read-a-simple-hdf5-file" class="section level1" number="3">
<h1><span class="header-section-number">3</span> Read a simple HDF5
file</h1>
<p>Begin by setting paths and filenames:</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" tabindex="-1"></a><span class="co"># set path and filename</span></span>
<span id="cb8-2"><a href="#cb8-2" tabindex="-1"></a>hdf_path <span class="ot">&lt;-</span> <span class="st">&quot;/Users/bartlein/Projects/RESS/data/hdf_files/&quot;</span></span>
<span id="cb8-3"><a href="#cb8-3" tabindex="-1"></a>hdf_name <span class="ot">&lt;-</span> <span class="st">&quot;uvief20190423.h5&quot;</span></span>
<span id="cb8-4"><a href="#cb8-4" tabindex="-1"></a>hdf_file <span class="ot">&lt;-</span> <span class="fu">paste</span>(hdf_path, hdf_name, <span class="at">sep=</span><span class="st">&quot;&quot;</span>)</span></code></pre></div>
<p>List the contents of the file. (WARNING: This can produce a lot of
output)</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" tabindex="-1"></a><span class="co"># list the file content</span></span>
<span id="cb9-2"><a href="#cb9-2" tabindex="-1"></a><span class="fu">h5ls</span>(hdf_file)</span></code></pre></div>
<pre><code>##   group         name       otype  dclass        dim
## 0     /    Latitudes H5I_DATASET   FLOAT        720
## 1     /   Longitudes H5I_DATASET   FLOAT       1440
## 2     / Ozone_column H5I_DATASET INTEGER 1440 x 720
## 3     /    UVI_error H5I_DATASET INTEGER 1440 x 720
## 4     /    UVI_field H5I_DATASET INTEGER 1440 x 720
## 5     /     fakeDim0 H5I_DATASET INTEGER        720
## 6     /     fakeDim1 H5I_DATASET INTEGER       1440</code></pre>
<p>Read the attributes of the <code>UVI_field</code> variable, the UV
index:</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" tabindex="-1"></a><span class="co"># read the attributes of UVI_field</span></span>
<span id="cb11-2"><a href="#cb11-2" tabindex="-1"></a><span class="fu">h5readAttributes</span>(hdf_file, <span class="at">name =</span> <span class="st">&quot;UVI_field&quot;</span>)</span></code></pre></div>
<pre><code>## Warning in H5Aread(A, ...): Reading attribute data of type &#39;VLEN&#39; not yet implemented. Values replaced
## by NA&#39;s.</code></pre>
<pre><code>## $DIMENSION_LIST
## [1] NA NA
## 
## $No_data_value
## [1] &quot;-1.0E+03 * scale_factor&quot;
## 
## $Scale_factor
## [1] 0.001
## 
## $Title
## [1] &quot;Erythemal UV index&quot;
## 
## $Units
## [1] &quot;1  [ 1 UV index unit equals 25 mW/m2 ]&quot;</code></pre>
<p>Get the latitudes and longitudes of the grid:</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" tabindex="-1"></a><span class="co"># get lons and lats</span></span>
<span id="cb14-2"><a href="#cb14-2" tabindex="-1"></a>lon <span class="ot">&lt;-</span> <span class="fu">h5read</span>(hdf_file, <span class="st">&quot;/Longitudes&quot;</span>)</span>
<span id="cb14-3"><a href="#cb14-3" tabindex="-1"></a>nlon <span class="ot">&lt;-</span> <span class="fu">length</span>(lon)</span>
<span id="cb14-4"><a href="#cb14-4" tabindex="-1"></a>nlon</span></code></pre></div>
<pre><code>## [1] 1440</code></pre>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" tabindex="-1"></a><span class="fu">head</span>(lon); <span class="fu">tail</span>(lon)</span></code></pre></div>
<pre><code>## [1] -179.875 -179.625 -179.375 -179.125 -178.875 -178.625</code></pre>
<pre><code>## [1] 178.625 178.875 179.125 179.375 179.625 179.875</code></pre>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" tabindex="-1"></a>lat <span class="ot">&lt;-</span> <span class="fu">h5read</span>(hdf_file, <span class="st">&quot;/Latitudes&quot;</span>)</span>
<span id="cb19-2"><a href="#cb19-2" tabindex="-1"></a>nlat <span class="ot">&lt;-</span> <span class="fu">length</span>(lat)</span>
<span id="cb19-3"><a href="#cb19-3" tabindex="-1"></a>nlat</span></code></pre></div>
<pre><code>## [1] 720</code></pre>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" tabindex="-1"></a><span class="fu">head</span>(lat); <span class="fu">tail</span>(lat)</span></code></pre></div>
<pre><code>## [1] -89.875 -89.625 -89.375 -89.125 -88.875 -88.625</code></pre>
<pre><code>## [1] 88.625 88.875 89.125 89.375 89.625 89.875</code></pre>
<p>Get the UV data, and convert it to a <code>SpatRaster</code> object,
and get a short summary. Note that the UVI data is in layer 3 of the
raster brick.</p>
<div class="sourceCode" id="cb24"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" tabindex="-1"></a>hdf_file <span class="ot">&lt;-</span> <span class="st">&quot;/Users/bartlein/Projects/RESS/data/hdf_files/uvief20190423.h5&quot;</span></span>
<span id="cb24-2"><a href="#cb24-2" tabindex="-1"></a>UVI_in <span class="ot">&lt;-</span> <span class="fu">rast</span>(hdf_file, <span class="at">lyrs =</span> <span class="dv">3</span>)</span></code></pre></div>
<pre><code>## Warning: [rast] unknown extent</code></pre>
<div class="sourceCode" id="cb26"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" tabindex="-1"></a>UVI_in</span></code></pre></div>
<pre><code>## class       : SpatRaster 
## dimensions  : 720, 1440, 1  (nrow, ncol, nlyr)
## resolution  : 1, 1  (x, y)
## extent      : 0, 1440, 0, 720  (xmin, xmax, ymin, ymax)
## coord. ref. :  
## source      : uvief20190423.h5://UVI_field 
## varname     : UVI_field 
## name        : UVI_field</code></pre>
<div class="sourceCode" id="cb28"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" tabindex="-1"></a><span class="fu">plot</span>(UVI_in)</span></code></pre></div>
<p><img src="hdf5_intro_files/figure-html/read_UVI1-1.png" width="75%" height="75%" /></p>
<p>Notice that the raster has an unknown extent (i.e the range of
longitudes and latitudes), and it also appears to be upside down. Flip
the raster, and add the longitude and latitude extent.</p>
<div class="sourceCode" id="cb29"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" tabindex="-1"></a><span class="co"># flip the raster</span></span>
<span id="cb29-2"><a href="#cb29-2" tabindex="-1"></a>UVI <span class="ot">&lt;-</span> <span class="fu">flip</span>(UVI_in, <span class="at">direction =</span> <span class="st">&quot;vertical&quot;</span>)</span>
<span id="cb29-3"><a href="#cb29-3" tabindex="-1"></a><span class="co"># add the spatial extent</span></span>
<span id="cb29-4"><a href="#cb29-4" tabindex="-1"></a><span class="fu">ext</span>(UVI) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="sc">-</span><span class="fl">179.875</span>, <span class="fl">179.875</span>, <span class="sc">-</span><span class="fl">89.875</span>, <span class="fl">89.875</span>)</span>
<span id="cb29-5"><a href="#cb29-5" tabindex="-1"></a>UVI</span></code></pre></div>
<pre><code>## class       : SpatRaster 
## dimensions  : 720, 1440, 1  (nrow, ncol, nlyr)
## resolution  : 0.2498264, 0.2496528  (x, y)
## extent      : -179.875, 179.875, -89.875, 89.875  (xmin, xmax, ymin, ymax)
## coord. ref. :  
## source(s)   : memory
## varname     : UVI_field 
## name        : UVI_field 
## min value   :         0 
## max value   :     18342</code></pre>
<p>Plot the raster:</p>
<div class="sourceCode" id="cb31"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" tabindex="-1"></a><span class="fu">plot</span>(UVI)</span></code></pre></div>
<p><img src="hdf5_intro_files/figure-html/hdf5-intro-4-1.png" width="75%" height="75%" /></p>
<p>Looks ok. Remove the input file:</p>
<div class="sourceCode" id="cb32"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" tabindex="-1"></a><span class="co"># Remove the input file</span></span>
<span id="cb32-2"><a href="#cb32-2" tabindex="-1"></a><span class="fu">remove</span>(UVI_in)</span></code></pre></div>
<p>Note that the data could also be read as an a matrix, or 2d array</p>
<div class="sourceCode" id="cb33"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" tabindex="-1"></a><span class="co"># read the UV data</span></span>
<span id="cb33-2"><a href="#cb33-2" tabindex="-1"></a>h1 <span class="ot">&lt;-</span> <span class="fu">h5read</span>(hdf_file, <span class="st">&quot;/UVI_field&quot;</span>)</span>
<span id="cb33-3"><a href="#cb33-3" tabindex="-1"></a><span class="fu">class</span>(h1); <span class="fu">str</span>(h1)</span></code></pre></div>
<pre><code>## [1] &quot;matrix&quot; &quot;array&quot;</code></pre>
<pre><code>##  int [1:1440, 1:720] 0 0 0 0 0 0 0 0 0 0 ...</code></pre>
<p>Remove the array:</p>
<div class="sourceCode" id="cb36"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" tabindex="-1"></a><span class="co"># Remove the input file</span></span>
<span id="cb36-2"><a href="#cb36-2" tabindex="-1"></a><span class="fu">remove</span>(h1)</span></code></pre></div>
<div id="plot-the-uv-data" class="section level2" number="3.1">
<h2><span class="header-section-number">3.1</span> Plot the UV data</h2>
<p>A plot with overlain outlines can be produced as follows:</p>
<div class="sourceCode" id="cb37"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" tabindex="-1"></a>color_fun <span class="ot">&lt;-</span> <span class="fu">colorRampPalette</span>(<span class="fu">brewer.pal</span>(<span class="dv">9</span>,<span class="st">&quot;YlOrRd&quot;</span>))</span>
<span id="cb37-2"><a href="#cb37-2" tabindex="-1"></a><span class="fu">plot</span>(UVI, <span class="at">col =</span> <span class="fu">color_fun</span>(<span class="dv">50</span>), <span class="at">main =</span> <span class="st">&quot;UV Index&quot;</span>, <span class="at">ylab =</span> <span class="st">&quot;Latitude&quot;</span>, <span class="at">xlab =</span> <span class="st">&quot;Longitude&quot;</span>)</span>
<span id="cb37-3"><a href="#cb37-3" tabindex="-1"></a><span class="fu">plot</span>(world_otl, <span class="at">add =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<p><img src="hdf5_intro_files/figure-html/rasterPlot-1.png" width="75%" height="75%" /></p>
<p>The <code>colorRampPalette()</code> function creates another function
<code>color_fun</code> that can be used to interpolate a color scale or
ramp, here the <code>RColorBrewer</code> “YlOrRd” scale. When supplied
to the <code>col</code> argument in the <code>plot()</code> function, it
creats a color ramp with 50 steps</p>
<p>Close the open files before moving on:</p>
<div class="sourceCode" id="cb38"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" tabindex="-1"></a><span class="co"># close open HDF5 files</span></span>
<span id="cb38-2"><a href="#cb38-2" tabindex="-1"></a><span class="fu">h5closeAll</span>()</span></code></pre></div>
</div>
</div>
<div id="read-a-more-complicated-hdf5-file" class="section level1"
number="4">
<h1><span class="header-section-number">4</span> Read a more complicated
HDF5 file</h1>
<p>A much more stuctured file that exploits the ability of HDF5 to store
data in “groups” that mimics in some ways the directory or folder
structure on a local computer is represented by the GFED4.1 fire data
set. Here’s a link to the file: <a
href="https://pages.uoregon.edu/bartlein/RESS/hdf_files/GFED4.1s_2016.hdf5">[https://pages.uoregon.edu/bartlein/RESS/hdf_files/hdf_files/GFED4.1s_2016.hdf5]</a>.
Dowload the file as usual. Begin by setting paths and file names.</p>
<div class="sourceCode" id="cb39"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" tabindex="-1"></a><span class="co"># set path </span></span>
<span id="cb39-2"><a href="#cb39-2" tabindex="-1"></a>hdf_path <span class="ot">&lt;-</span> <span class="st">&quot;/Users/bartlein/Projects/RESS/data/hdf_files/&quot;</span></span>
<span id="cb39-3"><a href="#cb39-3" tabindex="-1"></a>hdf_name <span class="ot">&lt;-</span> <span class="st">&quot;GFED4.1s_2016.hdf5&quot;</span></span>
<span id="cb39-4"><a href="#cb39-4" tabindex="-1"></a>hdf_file <span class="ot">&lt;-</span> <span class="fu">paste</span>(hdf_path, hdf_name, <span class="at">sep=</span><span class="st">&quot;&quot;</span>)</span></code></pre></div>
<p>List the file contents, DOUBLE WARNING: This really does produce a
lot of output, only some is included here:</p>
<div class="sourceCode" id="cb40"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" tabindex="-1"></a><span class="co"># list the file contents</span></span>
<span id="cb40-2"><a href="#cb40-2" tabindex="-1"></a><span class="fu">h5ls</span>(hdf_file) <span class="co"># may create a lot of output</span></span></code></pre></div>
<div class="sourceCode" id="cb41"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" tabindex="-1"></a><span class="do">##                            group                name       otype  dclass        dim</span></span>
<span id="cb41-2"><a href="#cb41-2" tabindex="-1"></a><span class="do">## 0                              /              ancill   H5I_GROUP                   </span></span>
<span id="cb41-3"><a href="#cb41-3" tabindex="-1"></a><span class="do">## 1                        /ancill       basis_regions H5I_DATASET INTEGER 1440 x 720</span></span>
<span id="cb41-4"><a href="#cb41-4" tabindex="-1"></a><span class="do">## 2                        /ancill      grid_cell_area H5I_DATASET   FLOAT 1440 x 720</span></span>
<span id="cb41-5"><a href="#cb41-5" tabindex="-1"></a><span class="do">## 3                              /           biosphere   H5I_GROUP                   </span></span>
<span id="cb41-6"><a href="#cb41-6" tabindex="-1"></a><span class="do">## 4                     /biosphere                  01   H5I_GROUP                   </span></span>
<span id="cb41-7"><a href="#cb41-7" tabindex="-1"></a><span class="do">## 5                  /biosphere/01                  BB H5I_DATASET   FLOAT 1440 x 720</span></span>
<span id="cb41-8"><a href="#cb41-8" tabindex="-1"></a><span class="do">## 6                  /biosphere/01                 NPP H5I_DATASET   FLOAT 1440 x 720</span></span>
<span id="cb41-9"><a href="#cb41-9" tabindex="-1"></a><span class="do">## 7                  /biosphere/01                  Rh H5I_DATASET   FLOAT 1440 x 720</span></span>
<span id="cb41-10"><a href="#cb41-10" tabindex="-1"></a><span class="do">## 8                     /biosphere                  02   H5I_GROUP                   </span></span>
<span id="cb41-11"><a href="#cb41-11" tabindex="-1"></a><span class="do">## 9                  /biosphere/02                  BB H5I_DATASET   FLOAT 1440 x 720</span></span>
<span id="cb41-12"><a href="#cb41-12" tabindex="-1"></a><span class="do">## 10                 /biosphere/02                 NPP H5I_DATASET   FLOAT 1440 x 720</span></span>
<span id="cb41-13"><a href="#cb41-13" tabindex="-1"></a><span class="do">## 11                 /biosphere/02                  Rh H5I_DATASET   FLOAT 1440 x 720</span></span>
<span id="cb41-14"><a href="#cb41-14" tabindex="-1"></a>...</span>
<span id="cb41-15"><a href="#cb41-15" tabindex="-1"></a></span>
<span id="cb41-16"><a href="#cb41-16" tabindex="-1"></a><span class="do">## 52                             /         burned_area   H5I_GROUP                   </span></span>
<span id="cb41-17"><a href="#cb41-17" tabindex="-1"></a><span class="do">## 53                  /burned_area                  01   H5I_GROUP                   </span></span>
<span id="cb41-18"><a href="#cb41-18" tabindex="-1"></a><span class="do">## 54               /burned_area/01     burned_fraction H5I_DATASET   FLOAT 1440 x 720</span></span>
<span id="cb41-19"><a href="#cb41-19" tabindex="-1"></a><span class="do">## 55               /burned_area/01              source H5I_DATASET INTEGER 1440 x 720</span></span>
<span id="cb41-20"><a href="#cb41-20" tabindex="-1"></a><span class="do">## 56                  /burned_area                  02   H5I_GROUP                   </span></span>
<span id="cb41-21"><a href="#cb41-21" tabindex="-1"></a><span class="do">## 57               /burned_area/02     burned_fraction H5I_DATASET   FLOAT 1440 x 720</span></span>
<span id="cb41-22"><a href="#cb41-22" tabindex="-1"></a><span class="do">## 58               /burned_area/02              source H5I_DATASET INTEGER 1440 x 720</span></span>
<span id="cb41-23"><a href="#cb41-23" tabindex="-1"></a><span class="do">## 59                  /burned_area                  03   H5I_GROUP                   </span></span>
<span id="cb41-24"><a href="#cb41-24" tabindex="-1"></a>...</span></code></pre></div>
<p>Read the longtidues and latiudes. A preliminary look at the file in
Panoply revealed that longitudes and latitudes were stored as full
matices, as opposed to vectors. Consequently, after reading, only the
first row (for longitude) and first column (for latitude) were
stored.</p>
<div class="sourceCode" id="cb42"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" tabindex="-1"></a><span class="co"># read lons and lats</span></span>
<span id="cb42-2"><a href="#cb42-2" tabindex="-1"></a>lon_array <span class="ot">&lt;-</span> <span class="fu">h5read</span>(hdf_file, <span class="st">&quot;lon&quot;</span>)</span>
<span id="cb42-3"><a href="#cb42-3" tabindex="-1"></a>lon <span class="ot">&lt;-</span> lon_array[,<span class="dv">1</span>]</span>
<span id="cb42-4"><a href="#cb42-4" tabindex="-1"></a>nlon <span class="ot">&lt;-</span> <span class="fu">length</span>(lon)</span>
<span id="cb42-5"><a href="#cb42-5" tabindex="-1"></a>nlon</span></code></pre></div>
<pre><code>## [1] 1440</code></pre>
<div class="sourceCode" id="cb44"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" tabindex="-1"></a><span class="fu">head</span>(lon); <span class="fu">tail</span>(lon)</span></code></pre></div>
<pre><code>## [1] -179.875 -179.625 -179.375 -179.125 -178.875 -178.625</code></pre>
<pre><code>## [1] 178.625 178.875 179.125 179.375 179.625 179.875</code></pre>
<div class="sourceCode" id="cb47"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" tabindex="-1"></a>lat_array <span class="ot">&lt;-</span> <span class="fu">h5read</span>(hdf_file, <span class="st">&quot;lat&quot;</span>)</span>
<span id="cb47-2"><a href="#cb47-2" tabindex="-1"></a>lat <span class="ot">&lt;-</span> lat_array[<span class="dv">1</span>,]</span>
<span id="cb47-3"><a href="#cb47-3" tabindex="-1"></a>nlat <span class="ot">&lt;-</span> <span class="fu">length</span>(lat)</span>
<span id="cb47-4"><a href="#cb47-4" tabindex="-1"></a>nlat</span></code></pre></div>
<pre><code>## [1] 720</code></pre>
<div class="sourceCode" id="cb49"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1" tabindex="-1"></a>lat <span class="ot">&lt;-</span> lat[nlat<span class="sc">:</span><span class="dv">1</span>]</span>
<span id="cb49-2"><a href="#cb49-2" tabindex="-1"></a><span class="fu">head</span>(lat); <span class="fu">tail</span>(lat)</span></code></pre></div>
<pre><code>## [1] -89.875 -89.625 -89.375 -89.125 -88.875 -88.625</code></pre>
<pre><code>## [1] 88.625 88.875 89.125 89.375 89.625 89.875</code></pre>
<p>Read the attributes of the <code>burned_area</code> variable:</p>
<div class="sourceCode" id="cb52"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1" tabindex="-1"></a><span class="co"># read the attributes of the burned_area variable</span></span>
<span id="cb52-2"><a href="#cb52-2" tabindex="-1"></a><span class="fu">h5readAttributes</span>(hdf_file, <span class="at">name =</span> <span class="st">&quot;/burned_area/07/burned_fraction/&quot;</span>)</span></code></pre></div>
<pre><code>## $long_name
## [1] &quot;GFED4s burned fraction. Note that this INCLUDES an experimental \&quot;small fire\&quot; estimate and is thus different from the Giglio et al. (2013) paper&quot;
## 
## $units
## [1] &quot;Fraction of grid cell&quot;</code></pre>
<p>From the listing of the contents of the file, and the information
provided in Panoply, it can be seen that, for example, the burned
fraction (the proportion of a grid cell burned), for July 2016 is in the
variable named <code>/burned_area/07/burned_fraction</code>. Get that
variable:</p>
<div class="sourceCode" id="cb54"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1" tabindex="-1"></a><span class="co"># read a raster slice</span></span>
<span id="cb54-2"><a href="#cb54-2" tabindex="-1"></a>h2 <span class="ot">&lt;-</span> <span class="fu">h5read</span>(hdf_file, <span class="st">&quot;/burned_area/07/burned_fraction&quot;</span>)</span>
<span id="cb54-3"><a href="#cb54-3" tabindex="-1"></a><span class="fu">class</span>(h2); <span class="fu">str</span>(h2)</span></code></pre></div>
<pre><code>## [1] &quot;matrix&quot; &quot;array&quot;</code></pre>
<pre><code>##  num [1:1440, 1:720] 0 0 0 0 0 0 0 0 0 0 ...</code></pre>
<p>The distribution of the burned fraction data is extremely
long-tailed, meaning there are a lot of small values and few large
ones:</p>
<div class="sourceCode" id="cb57"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb57-1"><a href="#cb57-1" tabindex="-1"></a><span class="fu">hist</span>(h2, <span class="at">breaks =</span> <span class="dv">40</span>)</span></code></pre></div>
<p><img src="hdf5_intro_files/figure-html/hist1-1.png" width="75%" height="75%" /></p>
<p>The usual strategy for dealing with such data is to log transform
it:</p>
<div class="sourceCode" id="cb58"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb58-1"><a href="#cb58-1" tabindex="-1"></a>h2[h2 <span class="sc">==</span> <span class="fl">0.0</span>] <span class="ot">&lt;-</span> <span class="cn">NA</span></span>
<span id="cb58-2"><a href="#cb58-2" tabindex="-1"></a>h2 <span class="ot">&lt;-</span> <span class="fu">log10</span>(h2)</span>
<span id="cb58-3"><a href="#cb58-3" tabindex="-1"></a><span class="fu">hist</span>(h2, <span class="at">breaks =</span> <span class="dv">40</span>)</span></code></pre></div>
<p><img src="hdf5_intro_files/figure-html/hist2-1.png" width="75%" height="75%" /></p>
<div class="sourceCode" id="cb59"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb59-1"><a href="#cb59-1" tabindex="-1"></a>BF <span class="ot">&lt;-</span> <span class="fu">rast</span>(h2)</span>
<span id="cb59-2"><a href="#cb59-2" tabindex="-1"></a>BF</span></code></pre></div>
<pre><code>## class       : SpatRaster 
## dimensions  : 1440, 720, 1  (nrow, ncol, nlyr)
## resolution  : 1, 1  (x, y)
## extent      : 0, 720, 0, 1440  (xmin, xmax, ymin, ymax)
## coord. ref. :  
## source(s)   : memory
## name        :       lyr.1 
## min value   : -5.09686064 
## max value   : -0.05363899</code></pre>
<p>Take a quick look:</p>
<div class="sourceCode" id="cb61"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb61-1"><a href="#cb61-1" tabindex="-1"></a><span class="co"># terra plot</span></span>
<span id="cb61-2"><a href="#cb61-2" tabindex="-1"></a><span class="fu">plot</span>((BF))</span></code></pre></div>
<p><img src="hdf5_intro_files/figure-html/image2-1.png" width="75%" height="75%" /></p>
<p>The plot, confirmed by Panoply, suggests that the raster needs to be
transposed.</p>
<div class="sourceCode" id="cb62"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb62-1"><a href="#cb62-1" tabindex="-1"></a><span class="co"># tranpose the raster</span></span>
<span id="cb62-2"><a href="#cb62-2" tabindex="-1"></a>BF <span class="ot">&lt;-</span> <span class="fu">t</span>(BF)</span>
<span id="cb62-3"><a href="#cb62-3" tabindex="-1"></a>BF</span></code></pre></div>
<pre><code>## class       : SpatRaster 
## dimensions  : 720, 1440, 1  (nrow, ncol, nlyr)
## resolution  : 1, 1  (x, y)
## extent      : 0, 1440, 0, 720  (xmin, xmax, ymin, ymax)
## coord. ref. :  
## source(s)   : memory
## name        :       lyr.1 
## min value   : -5.09686064 
## max value   : -0.05363899</code></pre>
<div class="sourceCode" id="cb64"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb64-1"><a href="#cb64-1" tabindex="-1"></a><span class="fu">plot</span>(BF)</span></code></pre></div>
<p><img src="hdf5_intro_files/figure-html/transpose%20BF-1.png" width="75%" height="75%" /></p>
<p>As was the case with the Ozone data, the rasterized input data
(<code>BF</code>) does not contain spatial entent data. These can be
gotten from the longitude and latitude data read in above using the
<code>h5read()</code> function.</p>
<div class="sourceCode" id="cb65"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb65-1"><a href="#cb65-1" tabindex="-1"></a><span class="co"># add the spatial extent</span></span>
<span id="cb65-2"><a href="#cb65-2" tabindex="-1"></a><span class="fu">ext</span>(BF) <span class="ot">&lt;-</span> <span class="fu">c</span>(lon[<span class="dv">1</span>], lon[nlon], lat[<span class="dv">1</span>], lat[nlat])</span>
<span id="cb65-3"><a href="#cb65-3" tabindex="-1"></a>BF</span></code></pre></div>
<pre><code>## class       : SpatRaster 
## dimensions  : 720, 1440, 1  (nrow, ncol, nlyr)
## resolution  : 0.2498264, 0.2496528  (x, y)
## extent      : -179.875, 179.875, -89.875, 89.875  (xmin, xmax, ymin, ymax)
## coord. ref. :  
## source(s)   : memory
## name        :       lyr.1 
## min value   : -5.09686064 
## max value   : -0.05363899</code></pre>
<div class="sourceCode" id="cb67"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb67-1"><a href="#cb67-1" tabindex="-1"></a><span class="fu">plot</span>(BF)</span></code></pre></div>
<p><img src="hdf5_intro_files/figure-html/hdf5-intro-9-1.png" width="75%" height="75%" /></p>
<div id="plot-the-gfed-burned-fraction-data" class="section level2"
number="4.1">
<h2><span class="header-section-number">4.1</span> plot the GFED burned
fraction data</h2>
<p>Plot the data:</p>
<div class="sourceCode" id="cb68"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb68-1"><a href="#cb68-1" tabindex="-1"></a>color_fun <span class="ot">&lt;-</span> <span class="fu">colorRampPalette</span>(<span class="fu">brewer.pal</span>(<span class="dv">9</span>,<span class="st">&quot;YlOrRd&quot;</span>))</span>
<span id="cb68-2"><a href="#cb68-2" tabindex="-1"></a><span class="fu">plot</span>(BF, <span class="at">y =</span> <span class="dv">1</span>, <span class="at">col =</span> <span class="fu">color_fun</span>(<span class="dv">50</span>), <span class="at">main =</span> <span class="st">&quot;log10 Burned Fraction First&quot;</span>, <span class="at">ylab =</span> <span class="st">&quot;Latitude&quot;</span>, <span class="at">xlab =</span> <span class="st">&quot;Longitude&quot;</span>)</span>
<span id="cb68-3"><a href="#cb68-3" tabindex="-1"></a><span class="fu">plot</span>(world_otl, <span class="at">add =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<p><img src="hdf5_intro_files/figure-html/rasterPlot2-1.png" width="75%" height="75%" /></p>
</div>
</div>




</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.odd').parent('tbody').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open');
  });
});
</script>

<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
