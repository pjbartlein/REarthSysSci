<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8" />
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />




<title>HDF</title>

<script src="site_libs/jquery-1.11.3/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/cosmo.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<script src="site_libs/clipboard-1.7.1/clipboard.min.js"></script>
<link href="site_libs/primer-tooltips-1.4.0/build.css" rel="stylesheet" />
<link href="site_libs/klippy-0.0.0.9500/css/klippy.min.css" rel="stylesheet" />
<script src="site_libs/klippy-0.0.0.9500/js/klippy.min.js"></script>


<style type="text/css">code{white-space: pre;}</style>
<style type="text/css" data-origin="pandoc">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; position: absolute; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; }
pre.numberSource a.sourceLine:empty
  { position: absolute; }
pre.numberSource a.sourceLine::before
  { content: attr(data-line-number);
    position: absolute; left: -5em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; } /* Alert */
code span.an { color: #008000; } /* Annotation */
code span.at { } /* Attribute */
code span.bu { } /* BuiltIn */
code span.cf { color: #0000ff; } /* ControlFlow */
code span.ch { color: #008080; } /* Char */
code span.cn { } /* Constant */
code span.co { color: #008000; } /* Comment */
code span.cv { color: #008000; } /* CommentVar */
code span.do { color: #008000; } /* Documentation */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.im { } /* Import */
code span.in { color: #008000; } /* Information */
code span.kw { color: #0000ff; } /* Keyword */
code span.op { } /* Operator */
code span.ot { color: #ff4000; } /* Other */
code span.pp { color: #ff4000; } /* Preprocessor */
code span.sc { color: #008080; } /* SpecialChar */
code span.ss { color: #008080; } /* SpecialString */
code span.st { color: #008080; } /* String */
code span.va { } /* Variable */
code span.vs { color: #008080; } /* VerbatimString */
code span.wa { color: #008000; font-weight: bold; } /* Warning */

</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    for (var j = 0; j < rules.length; j++) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") continue;
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' || rule.style.backgroundColor === '') continue;
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>


<style type="text/css">
h1 {
  font-size: 34px;
}
h1.title {
  font-size: 38px;
}
h2 {
  font-size: 30px;
}
h3 {
  font-size: 24px;
}
h4 {
  font-size: 18px;
}
h5 {
  font-size: 16px;
}
h6 {
  font-size: 12px;
}
.table th:not([align]) {
  text-align: left;
}
</style>

<link rel="stylesheet" href="html-md-01.css" type="text/css" />



<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
code {
  color: inherit;
  background-color: rgba(0, 0, 0, 0.04);
}
img {
  max-width:100%;
  height: auto;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
</style>


<style type="text/css">
/* padding for bootstrap navbar */
body {
  padding-top: 51px;
  padding-bottom: 40px;
}
/* offset scroll position for anchor links (for fixed navbar)  */
.section h1 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h2 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h3 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h4 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h5 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h6 {
  padding-top: 56px;
  margin-top: -56px;
}
.dropdown-submenu {
  position: relative;
}
.dropdown-submenu>.dropdown-menu {
  top: 0;
  left: 100%;
  margin-top: -6px;
  margin-left: -1px;
  border-radius: 0 6px 6px 6px;
}
.dropdown-submenu:hover>.dropdown-menu {
  display: block;
}
.dropdown-submenu>a:after {
  display: block;
  content: " ";
  float: right;
  width: 0;
  height: 0;
  border-color: transparent;
  border-style: solid;
  border-width: 5px 0 5px 5px;
  border-left-color: #cccccc;
  margin-top: 5px;
  margin-right: -10px;
}
.dropdown-submenu:hover>a:after {
  border-left-color: #ffffff;
}
.dropdown-submenu.pull-left {
  float: none;
}
.dropdown-submenu.pull-left>.dropdown-menu {
  left: -100%;
  margin-left: 10px;
  border-radius: 6px 0 6px 6px;
}
</style>

<script>
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark it active
  menuAnchor.parent().addClass('active');

  // if it's got a parent navbar menu mark it active as well
  menuAnchor.closest('li.dropdown').addClass('active');
});
</script>

<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  background: white;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "&#xe258;";
  border: none;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open')
  });
});
</script>

<!-- code folding -->




</head>

<body>


<div class="container-fluid main-container">




<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">R for Earth-System Science</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="overview.html">Overview</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Topics
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li class="dropdown-header">Lecture topics</li>
    <li>
      <a href="intro.html">Introduction: R, RStudio, and other infrastructure</a>
    </li>
    <li>
      <a href="usingR.html">Using R</a>
    </li>
    <li>
      <a href="ESSdata.html">Earth-system science data</a>
    </li>
    <li>
      <a href="netCDF.html">netCDF in R</a>
    </li>
    <li>
      <a href="raster_intro.html">raster and netCDF in R</a>
    </li>
    <li>
      <a href="hdf5_intro.html">HDF in R</a>
    </li>
    <li>
      <a href="geospatial.html">Geospatial analyses</a>
    </li>
    <li>
      <a href="RMaps.html">Maps in R</a>
    </li>
    <li class="dropdown-header">Visualization</li>
    <li class="dropdown-header">Multivariate analysis</li>
    <li class="dropdown-header">Prediction</li>
    <li class="dropdown-header">Clustering</li>
    <li class="dropdown-header">Other R packages</li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Tasks
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="geog495_ex01.html">Install R and RStudio</a>
    </li>
    <li>
      <a href="packages-and-data.html">Install packages and data</a>
    </li>
    <li>
      <a href="GitHub.html">Git and GitHub</a>
    </li>
    <li>
      <a href="Ex_UsingR.html">Using R exercise</a>
    </li>
    <li>
      <a href="markdown.html">Markdown and RMarkdown</a>
    </li>
    <li>
      <a href="install_netCDF.html">Install netCDF</a>
    </li>
    <li>
      <a href="install_Panoply.html">Install Panoply</a>
    </li>
    <li>
      <a href="transfer.html">File transfer</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Resources
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="readings.html">Readings</a>
    </li>
    <li>
      <a href="websites.html">Old course web pages</a>
    </li>
  </ul>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="about.html">About</a>
</li>
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div class="fluid-row" id="header">



<h1 class="title toc-ignore">HDF</h1>

</div>

<div id="TOC">
<ul>
<li><a href="#introduction"><span class="toc-section-number">1</span> Introduction</a></li>
<li><a href="#preliminary-set-up"><span class="toc-section-number">2</span> Preliminary set up</a><ul>
<li><a href="#convert-an-hdf4-file-to-hdf5"><span class="toc-section-number">2.1</span> Convert an HDF4 file to HDF5</a></li>
</ul></li>
<li><a href="#read-a-simple-hdf5-file"><span class="toc-section-number">3</span> Read a simple HDF5 file</a><ul>
<li><a href="#plot-the-uv-data"><span class="toc-section-number">3.1</span> Plot the UV data</a></li>
</ul></li>
<li><a href="#read-a-more-complicated-hdf5-file"><span class="toc-section-number">4</span> Read a more complicated HDF5 file</a><ul>
<li><a href="#plot-the-gfed-burned-fraction-data"><span class="toc-section-number">4.1</span> plot the GFED burned fraction data</a></li>
</ul></li>
</ul>
</div>

<script>
  addClassKlippyTo("pre.r, pre.markdown");
  addKlippy('right', 'top', 'auto', '1', 'Copy code', 'Copied!');
</script>
<div id="introduction" class="section level1">
<h1><span class="header-section-number">1</span> Introduction</h1>
<p>HDF (Hierarchical Data Format), see <a href="https://www.hdfgroup.org">[https://www.hdfgroup.org]</a> is another format for storing large data files and associated metadata, that is not unrealted to netCDF, because in fact netCDF-4 uses the HDF-5 “data model” to store data. There are currently two versions of HDF in use HDF4 and HDF5, and two special cases designed for handling satellite remote-sensing data (HDF-EOS and HDF-EOS5). Unlike netCDF-4, which is backward compatible with netCDF-3, the two versions are not mutually readible, but there are tools for converting between the different versions (as well as for converting HDF files to netCDF files).</p>
<p>HDF5 files can be read and written in R using the <code>rhdf5</code> package, which is part of the Bioconductor collection of packages. HDF4 files can also be handled via the <code>rgdal</code> package, but the process is more cumbersome. Consequently, the current standard approach for analyzing HDF4 data in R is to first convert it to HDF5 or netCDF, and proceed from there using <code>rhdf5</code>.</p>
<p>Compared to netCDF files, HDF files can be messy: they can contain images as well as data, and HDF5 files in particular may contain groups of datasets, which emulated in some ways the folder/directory stucture on a local machine. This will become evident below.</p>
</div>
<div id="preliminary-set-up" class="section level1">
<h1><span class="header-section-number">2</span> Preliminary set up</h1>
<p>The <code>rhdf5</code> package can be retrived from Bioconductor, and installed as follows. Generally, a lot of dependent packages will also need to be installed, as well, but the process is usually straightforward.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1-1" data-line-number="1"><span class="co"># install rhdf5</span></a>
<a class="sourceLine" id="cb1-2" data-line-number="2"><span class="cf">if</span> (<span class="op">!</span><span class="kw">requireNamespace</span>(<span class="st">&quot;rhdf5&quot;</span>, <span class="dt">quietly =</span> <span class="ot">TRUE</span>))</a>
<a class="sourceLine" id="cb1-3" data-line-number="3">  <span class="kw">install.packages</span>(<span class="st">&quot;BiocManager&quot;</span>)</a>
<a class="sourceLine" id="cb1-4" data-line-number="4">BiocManager<span class="op">::</span><span class="kw">install</span>(<span class="st">&quot;rhdf5&quot;</span>, <span class="dt">version =</span> <span class="st">&quot;3.8&quot;</span>)</a></code></pre></div>
<p>The examples below use data from TEMIS, the Tropospheric Emission Monitoring Internet Service (<a href="http://www.temis.nl/index.php">[http://www.temis.nl/index.php]</a>), and the Global Fire Emissions Database (GFED, <a href="https://www.globalfiredata.org/index.html">[https://www.globalfiredata.org/index.html]</a>). The TEMIS data are HDF4 and need to be converted, while the GFED data are HDF5. The specific data sets can be found on the ClimateLab SFTP server.</p>
<p>The various conversion tasks and tools are:</p>
<ul>
<li>HDF4 to HDF5: <code>h4toh5convert</code> from the HDFGroup <a href="https://portal.hdfgroup.org/display/support/Download+h4h5tools">[h4h5tools]</a></li>
<li>HDF4 to netCDF: <code>h4tonccf</code> (netCDF-3), and <code>h4tonccf_nc4</code> (netCDF-4), from HDF-EOS <a href="http://hdfeos.org/software/h4cflib.php">[http://hdfeos.org/software/h4cflib.php]</a></li>
<li>HDF4 and HDF5 (and other file types) to netCDF: <code>ncl_convert2nc</code> from Unidata <a href="https://www.ncl.ucar.edu/overview.shtml">[https://www.ncl.ucar.edu/]</a></li>
</ul>
<p>The first two conversion tools have installers for MacOS, Windows and Linux. On the Mac, it will usually be the case that the executable file should be moved to the /Applications folder, while on Windows the usual fooling around with paths will be required. The <code>ncl_convert2nc</code> tool is part of NCL, which can be installed on run on Windows 10 machines using the Linux subsystem for Windows.</p>
<p>There are some useful tutorials on using HDF in R from the NSF NEON program:</p>
<ul>
<li><a href="http://neonscience.github.io/neon-data-institute-2016//R/intro-hdf5-R/">[intro-hdf5-R]</a></li>
<li><a href="https://www.neonscience.org/hdf5-intro-r">[hdf5-intro-r]</a></li>
<li><a href="https://github.com/NEONScience/NEON-Data-Skills/tree/master/code/HDF5">[HDF5]</a></li>
</ul>
<p>Begin by loading the appropriate packages:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2-1" data-line-number="1"><span class="co"># load packages</span></a>
<a class="sourceLine" id="cb2-2" data-line-number="2"><span class="kw">library</span>(sf)</a>
<a class="sourceLine" id="cb2-3" data-line-number="3"><span class="kw">library</span>(rhdf5)</a>
<a class="sourceLine" id="cb2-4" data-line-number="4"><span class="kw">library</span>(raster)</a>
<a class="sourceLine" id="cb2-5" data-line-number="5"><span class="kw">library</span>(rasterVis)</a></code></pre></div>
<p>For latter plotting of the data, also read a world outline shape file:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3-1" data-line-number="1"><span class="co"># read a world shapefile</span></a>
<a class="sourceLine" id="cb3-2" data-line-number="2">shp_path &lt;-<span class="st"> &quot;/Users/bartlein/Projects/ESSD/data/shp_files/ne_110m_admin_0_countries/&quot;</span></a>
<a class="sourceLine" id="cb3-3" data-line-number="3">shp_name &lt;-<span class="st"> &quot;ne_110m_admin_0_countries.shp&quot;</span></a>
<a class="sourceLine" id="cb3-4" data-line-number="4">shp_file &lt;-<span class="st"> </span><span class="kw">paste</span>(shp_path, shp_name, <span class="dt">sep=</span><span class="st">&quot;&quot;</span>)</a>
<a class="sourceLine" id="cb3-5" data-line-number="5">world_shp &lt;-<span class="st"> </span><span class="kw">read_sf</span>(shp_file)</a>
<a class="sourceLine" id="cb3-6" data-line-number="6">world_outline &lt;-<span class="st"> </span><span class="kw">as</span>(<span class="kw">st_geometry</span>(world_shp), <span class="dt">Class=</span><span class="st">&quot;Spatial&quot;</span>)</a>
<a class="sourceLine" id="cb3-7" data-line-number="7"></a>
<a class="sourceLine" id="cb3-8" data-line-number="8"><span class="co"># plot the outline</span></a>
<a class="sourceLine" id="cb3-9" data-line-number="9"><span class="kw">plot</span>(world_outline, <span class="dt">col=</span><span class="st">&quot;blue&quot;</span>, <span class="dt">lwd=</span><span class="dv">1</span>)</a></code></pre></div>
<p><img src="hdf5_intro_files/figure-html/shapefile-1.png" width="75%" height="75%" /></p>
<div id="convert-an-hdf4-file-to-hdf5" class="section level2">
<h2><span class="header-section-number">2.1</span> Convert an HDF4 file to HDF5</h2>
<p>In this example, a data set of the “Clear-Sky UV Index”&quot; from TEMIS was downloaded (i.e. <code>uvief20190423.hdf</code> – 2019-04-23) from the website listed above. This is an HDF4 file, which can be verified in Panoply. Viewing files in Panoply is always good practice–in this case the particular layout of the data in file is rather ambiguous at first glance, and so getting a look at the contents of the file before attempting to read it is a good idea.</p>
<p>The HDF4 file can be converted by typing in a terminal or command window (for example):</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb4-1" data-line-number="1">h4toh5convert uvief20190423.hdf</a></code></pre></div>
<p>This will create the file <code>uvief20190423.h5</code>. (Note that an explicit output filename and path can be included. Not everything in the HDF4 file will be converted, and it’s likely that a number of error messages will appear, giving the impression that the operation has failed. Check to see whether in fact the HDF5 was indeed created.)</p>
</div>
</div>
<div id="read-a-simple-hdf5-file" class="section level1">
<h1><span class="header-section-number">3</span> Read a simple HDF5 file</h1>
<p>Begin by setting paths and filenames:</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb5-1" data-line-number="1"><span class="co"># set path and filename</span></a>
<a class="sourceLine" id="cb5-2" data-line-number="2">hdf_path &lt;-<span class="st"> &quot;/Users/bartlein/Dropbox/DataVis/working/geog490/data/hdf_files/&quot;</span></a>
<a class="sourceLine" id="cb5-3" data-line-number="3">hdf_name &lt;-<span class="st"> &quot;uvief20190423.h5&quot;</span></a>
<a class="sourceLine" id="cb5-4" data-line-number="4">hdf_file &lt;-<span class="st"> </span><span class="kw">paste</span>(hdf_path, hdf_name, <span class="dt">sep=</span><span class="st">&quot;&quot;</span>)</a></code></pre></div>
<p>List the contents of the file. (WARNING: This can produce a lot of output)</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb6-1" data-line-number="1"><span class="co"># list the file content</span></a>
<a class="sourceLine" id="cb6-2" data-line-number="2"><span class="kw">h5ls</span>(hdf_file)</a></code></pre></div>
<pre><code>##   group         name       otype  dclass        dim
## 0     /    Latitudes H5I_DATASET   FLOAT        720
## 1     /   Longitudes H5I_DATASET   FLOAT       1440
## 2     / Ozone_column H5I_DATASET INTEGER 1440 x 720
## 3     /    UVI_error H5I_DATASET INTEGER 1440 x 720
## 4     /    UVI_field H5I_DATASET INTEGER 1440 x 720
## 5     /     fakeDim0 H5I_DATASET INTEGER        720
## 6     /     fakeDim1 H5I_DATASET INTEGER       1440</code></pre>
<p>Read the attributes of the <code>UVI_field</code> variable, the UV index:</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb8-1" data-line-number="1"><span class="co"># read the attributes of UVI_field</span></a>
<a class="sourceLine" id="cb8-2" data-line-number="2"><span class="kw">h5readAttributes</span>(hdf_file, <span class="dt">name =</span> <span class="st">&quot;UVI_field&quot;</span>)</a></code></pre></div>
<pre><code>## Warning in H5Aread(A): Reading attribute data of type &#39;VLEN&#39; not yet implemented. Values replaced by
## NA&#39;s.</code></pre>
<pre><code>## $DIMENSION_LIST
## [1] NA NA
## 
## $No_data_value
## [1] &quot;-1.0E+03 * scale_factor&quot;
## 
## $Scale_factor
## [1] 0.001
## 
## $Title
## [1] &quot;Erythemal UV index&quot;
## 
## $Units
## [1] &quot;1  [ 1 UV index unit equals 25 mW/m2 ]&quot;</code></pre>
<p>Get the latitudes and longitudes of the grid:</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb11-1" data-line-number="1"><span class="co"># get lons and lats</span></a>
<a class="sourceLine" id="cb11-2" data-line-number="2">lon &lt;-<span class="st"> </span><span class="kw">h5read</span>(hdf_file, <span class="st">&quot;/Longitudes&quot;</span>)</a>
<a class="sourceLine" id="cb11-3" data-line-number="3">nlon &lt;-<span class="st"> </span><span class="kw">length</span>(lon)</a>
<a class="sourceLine" id="cb11-4" data-line-number="4">nlon</a></code></pre></div>
<pre><code>## [1] 1440</code></pre>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb13-1" data-line-number="1"><span class="kw">head</span>(lon); <span class="kw">tail</span>(lon)</a></code></pre></div>
<pre><code>## [1] -179.875 -179.625 -179.375 -179.125 -178.875 -178.625</code></pre>
<pre><code>## [1] 178.625 178.875 179.125 179.375 179.625 179.875</code></pre>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb16-1" data-line-number="1">lat &lt;-<span class="st"> </span><span class="kw">h5read</span>(hdf_file, <span class="st">&quot;/Latitudes&quot;</span>)</a>
<a class="sourceLine" id="cb16-2" data-line-number="2">nlat &lt;-<span class="st"> </span><span class="kw">length</span>(lat)</a>
<a class="sourceLine" id="cb16-3" data-line-number="3">nlat</a></code></pre></div>
<pre><code>## [1] 720</code></pre>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb18-1" data-line-number="1"><span class="kw">head</span>(lat); <span class="kw">tail</span>(lat)</a></code></pre></div>
<pre><code>## [1] -89.875 -89.625 -89.375 -89.125 -88.875 -88.625</code></pre>
<pre><code>## [1] 88.625 88.875 89.125 89.375 89.625 89.875</code></pre>
<p>Get the UV data, and convert it to a <code>raster</code> object, and get a short summary:</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb21-1" data-line-number="1"><span class="co"># read the UV data</span></a>
<a class="sourceLine" id="cb21-2" data-line-number="2">h1 &lt;-<span class="st"> </span><span class="kw">h5read</span>(hdf_file, <span class="st">&quot;/UVI_field&quot;</span>)</a>
<a class="sourceLine" id="cb21-3" data-line-number="3"><span class="kw">class</span>(h1); <span class="kw">str</span>(h1)</a></code></pre></div>
<pre><code>## [1] &quot;matrix&quot;</code></pre>
<pre><code>##  int [1:1440, 1:720] 0 0 0 0 0 0 0 0 0 0 ...</code></pre>
<div class="sourceCode" id="cb24"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb24-1" data-line-number="1">UVI &lt;-<span class="st"> </span><span class="kw">raster</span>(h1)</a>
<a class="sourceLine" id="cb24-2" data-line-number="2">UVI</a></code></pre></div>
<pre><code>## class       : RasterLayer 
## dimensions  : 1440, 720, 1036800  (nrow, ncol, ncell)
## resolution  : 0.001388889, 0.0006944444  (x, y)
## extent      : 0, 1, 0, 1  (xmin, xmax, ymin, ymax)
## coord. ref. : NA 
## data source : in memory
## names       : layer 
## values      : 0, 18342  (min, max)</code></pre>
<p>Get a quick look using the <code>raster</code> version of the <code>image()</code> function:</p>
<div class="sourceCode" id="cb26"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb26-1" data-line-number="1"><span class="co"># quick look</span></a>
<a class="sourceLine" id="cb26-2" data-line-number="2"><span class="kw">image</span>(UVI)</a></code></pre></div>
<p><img src="hdf5_intro_files/figure-html/image1-1.png" width="50%" height="50%" /></p>
<p>The layout of the data in the file is obviously not straightforward. First, the coordinates of the data are not longitudes and latitudes but simply values that range from 0 to 1, and the orientation of the grid is such that the <code>raster</code> object needs to be both tranposed (exchanging x and y), and flipped north to south. this can be done as follows, also adding explicit longitude and latitude dimensions:</p>
<div class="sourceCode" id="cb27"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb27-1" data-line-number="1"><span class="co"># transpose and flip the raster </span></a>
<a class="sourceLine" id="cb27-2" data-line-number="2">UVI &lt;-<span class="st"> </span><span class="kw">flip</span>(<span class="kw">raster</span>(<span class="kw">t</span>(h1), <span class="dt">xmn=</span>lon[<span class="dv">1</span>], <span class="dt">xmx=</span>lon[nlon], <span class="dt">ymn=</span>lat[<span class="dv">1</span>], <span class="dt">ymx=</span>lat[nlat]), <span class="st">&quot;y&quot;</span>)</a>
<a class="sourceLine" id="cb27-3" data-line-number="3">UVI</a></code></pre></div>
<pre><code>## class       : RasterLayer 
## dimensions  : 720, 1440, 1036800  (nrow, ncol, ncell)
## resolution  : 0.2498264, 0.2496528  (x, y)
## extent      : -179.875, 179.875, -89.875, 89.875  (xmin, xmax, ymin, ymax)
## coord. ref. : NA 
## data source : in memory
## names       : layer 
## values      : 0, 18342  (min, max)</code></pre>
<div id="plot-the-uv-data" class="section level2">
<h2><span class="header-section-number">3.1</span> Plot the UV data</h2>
<p>A <code>rasterVis</code> plot can be produced as follows:</p>
<div class="sourceCode" id="cb29"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb29-1" data-line-number="1"><span class="co"># rasterVis plot</span></a>
<a class="sourceLine" id="cb29-2" data-line-number="2">mapTheme &lt;-<span class="st"> </span><span class="kw">rasterTheme</span>(<span class="dt">region=</span><span class="kw">brewer.pal</span>(<span class="dv">8</span>,<span class="st">&quot;YlOrRd&quot;</span>))</a>
<a class="sourceLine" id="cb29-3" data-line-number="3">plt &lt;-<span class="st"> </span><span class="kw">levelplot</span>(UVI, <span class="dt">margin=</span>F, <span class="dt">par.settings=</span>mapTheme, <span class="dt">main=</span><span class="st">&quot;UV Index&quot;</span>)</a>
<a class="sourceLine" id="cb29-4" data-line-number="4">plt <span class="op">+</span><span class="st"> </span><span class="kw">layer</span>(<span class="kw">sp.lines</span>(world_outline, <span class="dt">col=</span><span class="st">&quot;black&quot;</span>, <span class="dt">lwd=</span><span class="fl">1.0</span>))</a></code></pre></div>
<p><img src="hdf5_intro_files/figure-html/rasterVis1-1.png" width="75%" height="75%" /></p>
<p>Close the open files before moving on:</p>
<div class="sourceCode" id="cb30"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb30-1" data-line-number="1"><span class="co"># close open HDF5 files</span></a>
<a class="sourceLine" id="cb30-2" data-line-number="2"><span class="kw">h5closeAll</span>()</a></code></pre></div>
</div>
</div>
<div id="read-a-more-complicated-hdf5-file" class="section level1">
<h1><span class="header-section-number">4</span> Read a more complicated HDF5 file</h1>
<p>A much more stuctured file that exploits the ability of HDF5 to store data in “groups” that mimics in some ways the directory or folder structure on a local computer is represented by the GFED4.1 fire data set. As usual, begin by setting paths and file names.</p>
<div class="sourceCode" id="cb31"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb31-1" data-line-number="1"><span class="co"># set path </span></a>
<a class="sourceLine" id="cb31-2" data-line-number="2">hdf_path &lt;-<span class="st"> &quot;/Users/bartlein/Dropbox/DataVis/working/geog490/data/hdf_files/&quot;</span></a>
<a class="sourceLine" id="cb31-3" data-line-number="3">hdf_name &lt;-<span class="st"> &quot;GFED4.1s_2016.hdf5&quot;</span></a>
<a class="sourceLine" id="cb31-4" data-line-number="4">hdf_file &lt;-<span class="st"> </span><span class="kw">paste</span>(hdf_path, hdf_name, <span class="dt">sep=</span><span class="st">&quot;&quot;</span>)</a></code></pre></div>
<p>List the file contents, DOUBLE WARNING: This really does produce a lot of output, only some is included here:</p>
<div class="sourceCode" id="cb32"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb32-1" data-line-number="1"><span class="co"># list the file contents</span></a>
<a class="sourceLine" id="cb32-2" data-line-number="2"><span class="kw">h5ls</span>(hdf_file) <span class="co"># may create a lot of output</span></a></code></pre></div>
<div class="sourceCode" id="cb33"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb33-1" data-line-number="1">##                            group                name       otype  dclass        dim</a>
<a class="sourceLine" id="cb33-2" data-line-number="2">## 0                              /              ancill   H5I_GROUP                   </a>
<a class="sourceLine" id="cb33-3" data-line-number="3">## 1                        /ancill       basis_regions H5I_DATASET INTEGER 1440 x 720</a>
<a class="sourceLine" id="cb33-4" data-line-number="4">## 2                        /ancill      grid_cell_area H5I_DATASET   FLOAT 1440 x 720</a>
<a class="sourceLine" id="cb33-5" data-line-number="5">## 3                              /           biosphere   H5I_GROUP                   </a>
<a class="sourceLine" id="cb33-6" data-line-number="6">## 4                     /biosphere                  01   H5I_GROUP                   </a>
<a class="sourceLine" id="cb33-7" data-line-number="7">## 5                  /biosphere/01                  BB H5I_DATASET   FLOAT 1440 x 720</a>
<a class="sourceLine" id="cb33-8" data-line-number="8">## 6                  /biosphere/01                 NPP H5I_DATASET   FLOAT 1440 x 720</a>
<a class="sourceLine" id="cb33-9" data-line-number="9">## 7                  /biosphere/01                  Rh H5I_DATASET   FLOAT 1440 x 720</a>
<a class="sourceLine" id="cb33-10" data-line-number="10">## 8                     /biosphere                  02   H5I_GROUP                   </a>
<a class="sourceLine" id="cb33-11" data-line-number="11">## 9                  /biosphere/02                  BB H5I_DATASET   FLOAT 1440 x 720</a>
<a class="sourceLine" id="cb33-12" data-line-number="12">## 10                 /biosphere/02                 NPP H5I_DATASET   FLOAT 1440 x 720</a>
<a class="sourceLine" id="cb33-13" data-line-number="13">## 11                 /biosphere/02                  Rh H5I_DATASET   FLOAT 1440 x 720</a>
<a class="sourceLine" id="cb33-14" data-line-number="14">...</a>
<a class="sourceLine" id="cb33-15" data-line-number="15"></a>
<a class="sourceLine" id="cb33-16" data-line-number="16">## 52                             /         burned_area   H5I_GROUP                   </a>
<a class="sourceLine" id="cb33-17" data-line-number="17">## 53                  /burned_area                  01   H5I_GROUP                   </a>
<a class="sourceLine" id="cb33-18" data-line-number="18">## 54               /burned_area/01     burned_fraction H5I_DATASET   FLOAT 1440 x 720</a>
<a class="sourceLine" id="cb33-19" data-line-number="19">## 55               /burned_area/01              source H5I_DATASET INTEGER 1440 x 720</a>
<a class="sourceLine" id="cb33-20" data-line-number="20">## 56                  /burned_area                  02   H5I_GROUP                   </a>
<a class="sourceLine" id="cb33-21" data-line-number="21">## 57               /burned_area/02     burned_fraction H5I_DATASET   FLOAT 1440 x 720</a>
<a class="sourceLine" id="cb33-22" data-line-number="22">## 58               /burned_area/02              source H5I_DATASET INTEGER 1440 x 720</a>
<a class="sourceLine" id="cb33-23" data-line-number="23">## 59                  /burned_area                  03   H5I_GROUP                   </a>
<a class="sourceLine" id="cb33-24" data-line-number="24">...</a></code></pre></div>
<p>Read the longtidues and latiudes. A preliminary look at the file in Panoply revealed that longitudes and latitudes were stored as full matices, as opposed to vectors. Consequently, after reading, only the first row (for longitude) and first column (for latitude) were stored.</p>
<div class="sourceCode" id="cb34"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb34-1" data-line-number="1"><span class="co"># read lons and lats</span></a>
<a class="sourceLine" id="cb34-2" data-line-number="2">lon_array &lt;-<span class="st"> </span><span class="kw">h5read</span>(hdf_file, <span class="st">&quot;lon&quot;</span>)</a>
<a class="sourceLine" id="cb34-3" data-line-number="3">lon &lt;-<span class="st"> </span>lon_array[,<span class="dv">1</span>]</a>
<a class="sourceLine" id="cb34-4" data-line-number="4">nlon &lt;-<span class="st"> </span><span class="kw">length</span>(lon)</a>
<a class="sourceLine" id="cb34-5" data-line-number="5">nlon</a></code></pre></div>
<pre><code>## [1] 1440</code></pre>
<div class="sourceCode" id="cb36"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb36-1" data-line-number="1"><span class="kw">head</span>(lon); <span class="kw">tail</span>(lon)</a></code></pre></div>
<pre><code>## [1] -179.875 -179.625 -179.375 -179.125 -178.875 -178.625</code></pre>
<pre><code>## [1] 178.625 178.875 179.125 179.375 179.625 179.875</code></pre>
<div class="sourceCode" id="cb39"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb39-1" data-line-number="1">lat_array &lt;-<span class="st"> </span><span class="kw">h5read</span>(hdf_file, <span class="st">&quot;lat&quot;</span>)</a>
<a class="sourceLine" id="cb39-2" data-line-number="2">lat &lt;-<span class="st"> </span>lat_array[<span class="dv">1</span>,]</a>
<a class="sourceLine" id="cb39-3" data-line-number="3">nlat &lt;-<span class="st"> </span><span class="kw">length</span>(lat)</a>
<a class="sourceLine" id="cb39-4" data-line-number="4">nlat</a></code></pre></div>
<pre><code>## [1] 720</code></pre>
<div class="sourceCode" id="cb41"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb41-1" data-line-number="1">lat &lt;-<span class="st"> </span>lat[nlat<span class="op">:</span><span class="dv">1</span>]</a>
<a class="sourceLine" id="cb41-2" data-line-number="2"><span class="kw">head</span>(lat); <span class="kw">tail</span>(lat)</a></code></pre></div>
<pre><code>## [1] -89.875 -89.625 -89.375 -89.125 -88.875 -88.625</code></pre>
<pre><code>## [1] 88.625 88.875 89.125 89.375 89.625 89.875</code></pre>
<p>Read the attributes of the <code>burned_area</code> variable:</p>
<div class="sourceCode" id="cb44"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb44-1" data-line-number="1"><span class="co"># read the attributes of the burned_area variable</span></a>
<a class="sourceLine" id="cb44-2" data-line-number="2"><span class="kw">h5readAttributes</span>(hdf_file, <span class="dt">name =</span> <span class="st">&quot;burned_area&quot;</span>)</a></code></pre></div>
<pre><code>## list()</code></pre>
<p>From the listing of the contents of the file, and the information provided in Panoply, it can be seen that, for example, the burned fraction (the proportion of a grid cell burned), for July 2016 is in the variable named <code>/burned_area/07/burned_fraction</code>. Get that variable:</p>
<div class="sourceCode" id="cb46"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb46-1" data-line-number="1"><span class="co"># read a raster slice</span></a>
<a class="sourceLine" id="cb46-2" data-line-number="2">h2 &lt;-<span class="st"> </span><span class="kw">h5read</span>(hdf_file, <span class="st">&quot;/burned_area/07/burned_fraction&quot;</span>)</a>
<a class="sourceLine" id="cb46-3" data-line-number="3"><span class="kw">class</span>(h2); <span class="kw">str</span>(h2)</a></code></pre></div>
<pre><code>## [1] &quot;matrix&quot;</code></pre>
<pre><code>##  num [1:1440, 1:720] 0 0 0 0 0 0 0 0 0 0 ...</code></pre>
<div class="sourceCode" id="cb49"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb49-1" data-line-number="1">BF &lt;-<span class="st"> </span><span class="kw">raster</span>(h2)</a>
<a class="sourceLine" id="cb49-2" data-line-number="2">BF</a></code></pre></div>
<pre><code>## class       : RasterLayer 
## dimensions  : 1440, 720, 1036800  (nrow, ncol, ncell)
## resolution  : 0.001388889, 0.0006944444  (x, y)
## extent      : 0, 1, 0, 1  (xmin, xmax, ymin, ymax)
## coord. ref. : NA 
## data source : in memory
## names       : layer 
## values      : 0, 0.8838143  (min, max)</code></pre>
<p>Take a quick look:</p>
<div class="sourceCode" id="cb51"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb51-1" data-line-number="1"><span class="co"># image plot</span></a>
<a class="sourceLine" id="cb51-2" data-line-number="2"><span class="kw">image</span>(<span class="kw">log10</span>(BF))</a></code></pre></div>
<p><img src="hdf5_intro_files/figure-html/image2-1.png" width="50%" height="50%" /></p>
<p>The image plot, confirmed by Panoply, suggests that the raster needs to be transposed.</p>
<div class="sourceCode" id="cb52"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb52-1" data-line-number="1"><span class="co"># tranpose the raster</span></a>
<a class="sourceLine" id="cb52-2" data-line-number="2">BF &lt;-<span class="st"> </span><span class="kw">raster</span>(<span class="kw">t</span>(h2), <span class="dt">xmn=</span>lon[<span class="dv">1</span>], <span class="dt">xmx=</span>lon[nlon], <span class="dt">ymn=</span>lat[<span class="dv">1</span>], <span class="dt">ymx=</span>lat[nlat])</a>
<a class="sourceLine" id="cb52-3" data-line-number="3">BF</a></code></pre></div>
<pre><code>## class       : RasterLayer 
## dimensions  : 720, 1440, 1036800  (nrow, ncol, ncell)
## resolution  : 0.2498264, 0.2496528  (x, y)
## extent      : -179.875, 179.875, -89.875, 89.875  (xmin, xmax, ymin, ymax)
## coord. ref. : NA 
## data source : in memory
## names       : layer 
## values      : 0, 0.8838143  (min, max)</code></pre>
<div id="plot-the-gfed-burned-fraction-data" class="section level2">
<h2><span class="header-section-number">4.1</span> plot the GFED burned fraction data</h2>
<p>Plot the data:</p>
<div class="sourceCode" id="cb54"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb54-1" data-line-number="1"><span class="co"># rasterVis plot</span></a>
<a class="sourceLine" id="cb54-2" data-line-number="2">mapTheme &lt;-<span class="st"> </span><span class="kw">rasterTheme</span>(<span class="dt">region=</span><span class="kw">brewer.pal</span>(<span class="dv">8</span>,<span class="st">&quot;OrRd&quot;</span>))</a>
<a class="sourceLine" id="cb54-3" data-line-number="3">plt &lt;-<span class="st"> </span><span class="kw">levelplot</span>(<span class="kw">log10</span>(BF), <span class="dt">margin=</span>F, <span class="dt">par.settings=</span>mapTheme, <span class="dt">main=</span><span class="st">&quot;log10 Burned Fraction&quot;</span>)</a>
<a class="sourceLine" id="cb54-4" data-line-number="4">plt <span class="op">+</span><span class="st"> </span><span class="kw">layer</span>(<span class="kw">sp.lines</span>(world_outline, <span class="dt">col=</span><span class="st">&quot;black&quot;</span>, <span class="dt">lwd=</span><span class="fl">1.0</span>))</a></code></pre></div>
<p><img src="hdf5_intro_files/figure-html/rasterVis2-1.png" width="75%" height="75%" /></p>
</div>
</div>




</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.header').parent('thead').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
