<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />




<title>Principal Components Analysis</title>

<script src="site_libs/header-attrs-2.25/header-attrs.js"></script>
<script src="site_libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/cosmo.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<style>h1 {font-size: 34px;}
       h1.title {font-size: 38px;}
       h2 {font-size: 30px;}
       h3 {font-size: 24px;}
       h4 {font-size: 18px;}
       h5 {font-size: 16px;}
       h6 {font-size: 12px;}
       code {color: inherit; background-color: rgba(0, 0, 0, 0.04);}
       pre:not([class]) { background-color: white }</style>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<script src="site_libs/clipboard-1.7.1/clipboard.min.js"></script>
<link href="site_libs/primer-tooltips-1.4.0/build.css" rel="stylesheet" />
<link href="site_libs/klippy-0.0.0.9500/css/klippy.min.css" rel="stylesheet" />
<script src="site_libs/klippy-0.0.0.9500/js/klippy.min.js"></script>

<style type="text/css">
  code{white-space: pre-wrap;}
  span.smallcaps{font-variant: small-caps;}
  span.underline{text-decoration: underline;}
  div.column{display: inline-block; vertical-align: top; width: 50%;}
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  ul.task-list{list-style: none;}
    </style>



<style type="text/css">
  code {
    white-space: pre;
  }
  .sourceCode {
    overflow: visible;
  }
</style>
<style type="text/css" data-origin="pandoc">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; } /* Alert */
code span.an { color: #008000; } /* Annotation */
code span.at { } /* Attribute */
code span.bu { } /* BuiltIn */
code span.cf { color: #0000ff; } /* ControlFlow */
code span.ch { color: #008080; } /* Char */
code span.cn { } /* Constant */
code span.co { color: #008000; } /* Comment */
code span.cv { color: #008000; } /* CommentVar */
code span.do { color: #008000; } /* Documentation */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.im { } /* Import */
code span.in { color: #008000; } /* Information */
code span.kw { color: #0000ff; } /* Keyword */
code span.op { } /* Operator */
code span.ot { color: #ff4000; } /* Other */
code span.pp { color: #ff4000; } /* Preprocessor */
code span.sc { color: #008080; } /* SpecialChar */
code span.ss { color: #008080; } /* SpecialString */
code span.st { color: #008080; } /* String */
code span.va { } /* Variable */
code span.vs { color: #008080; } /* VerbatimString */
code span.wa { color: #008000; font-weight: bold; } /* Warning */

</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    var j = 0;
    while (j < rules.length) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") {
        j++;
        continue;
      }
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' && rule.style.backgroundColor === '') {
        j++;
        continue;
      }
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>




<link rel="stylesheet" href="html-md-01.css" type="text/css" />



<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
img {
  max-width:100%;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
details > summary > p:only-child {
  display: inline;
}
pre code {
  padding: 0;
}
</style>


<style type="text/css">
.dropdown-submenu {
  position: relative;
}
.dropdown-submenu>.dropdown-menu {
  top: 0;
  left: 100%;
  margin-top: -6px;
  margin-left: -1px;
  border-radius: 0 6px 6px 6px;
}
.dropdown-submenu:hover>.dropdown-menu {
  display: block;
}
.dropdown-submenu>a:after {
  display: block;
  content: " ";
  float: right;
  width: 0;
  height: 0;
  border-color: transparent;
  border-style: solid;
  border-width: 5px 0 5px 5px;
  border-left-color: #cccccc;
  margin-top: 5px;
  margin-right: -10px;
}
.dropdown-submenu:hover>a:after {
  border-left-color: #adb5bd;
}
.dropdown-submenu.pull-left {
  float: none;
}
.dropdown-submenu.pull-left>.dropdown-menu {
  left: -100%;
  margin-left: 10px;
  border-radius: 6px 0 6px 6px;
}
</style>

<script type="text/javascript">
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark the anchor link active (and if it's in a dropdown, also mark that active)
  var dropdown = menuAnchor.closest('li.dropdown');
  if (window.bootstrap) { // Bootstrap 4+
    menuAnchor.addClass('active');
    dropdown.find('> .dropdown-toggle').addClass('active');
  } else { // Bootstrap 3
    menuAnchor.parent().addClass('active');
    dropdown.addClass('active');
  }

  // Navbar adjustments
  var navHeight = $(".navbar").first().height() + 15;
  var style = document.createElement('style');
  var pt = "padding-top: " + navHeight + "px; ";
  var mt = "margin-top: -" + navHeight + "px; ";
  var css = "";
  // offset scroll position for anchor links (for fixed navbar)
  for (var i = 1; i <= 6; i++) {
    css += ".section h" + i + "{ " + pt + mt + "}\n";
  }
  style.innerHTML = "body {" + pt + "padding-bottom: 40px; }\n" + css;
  document.head.appendChild(style);
});
</script>

<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before, .tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "\e259";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "\e258";
  font-family: 'Glyphicons Halflings';
  border: none;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
  background-color: transparent;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<!-- code folding -->




</head>

<body>


<div class="container-fluid main-container">




<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-bs-toggle="collapse" data-target="#navbar" data-bs-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">R for Earth-System Science</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="overview.html">Overview</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Topics
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li class="dropdown-header">Lecture topics</li>
    <li>
      <a href="intro.html">Introduction: R, RStudio, and other infrastructure</a>
    </li>
    <li>
      <a href="usingR.html">Using R</a>
    </li>
    <li>
      <a href="ESSdata.html">Earth-system science data</a>
    </li>
    <li>
      <a href="netCDF.html">netCDF in R</a>
    </li>
    <li>
      <a href="netcdf_terra.html">netCDF and terra</a>
    </li>
    <li>
      <a href="plots1.html">Plots (1)</a>
    </li>
    <li>
      <a href="plots2.html">Plots (2)</a>
    </li>
    <li>
      <a href="maps1.html">Maps (1)</a>
    </li>
    <li>
      <a href="maps2.html">Maps (2)</a>
    </li>
    <li>
      <a href="geospatial.html">Geospatial analyses</a>
    </li>
    <li>
      <a href="regression1.html">Regression 1</a>
    </li>
    <li>
      <a href="regression2.html">Regression 2</a>
    </li>
    <li>
      <a href="pca.html">PCA</a>
    </li>
    <li>
      <a href="highdim.html">High-resolution &amp; high-dimensional data</a>
    </li>
    <li>
      <a href="multivariate.html">Multivariate methods</a>
    </li>
    <li>
      <a href="timeseries.html">Time-series analysis</a>
    </li>
    <li class="dropdown-header">Other topics</li>
    <li>
      <a href="sf_stars_sftime.html">sf / stars / sftime</a>
    </li>
    <li>
      <a href="hdf5_intro.html">HDF in R</a>
    </li>
    <li>
      <a href="anomalies.html">Long-term means and anomalies</a>
    </li>
    <li>
      <a href="tsplots.html">Time-series plots</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Tasks
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li class="dropdown-header">Tasks</li>
    <li>
      <a href="installR.html">Install R and RStudio</a>
    </li>
    <li>
      <a href="Ex_UsingR.html">Using R exercise</a>
    </li>
    <li>
      <a href="install_netCDF.html">Install netCDF &amp; Panoply</a>
    </li>
    <li>
      <a href="transfer.html">File transfer</a>
    </li>
    <li>
      <a href="texteditor.html">Install a text editor</a>
    </li>
    <li>
      <a href="dataselection.html">Project data set selection</a>
    </li>
    <li>
      <a href="markdown.html">Markdown and RMarkdown</a>
    </li>
    <li>
      <a href="scripts_and_md.html">R Scripts and R Markdown</a>
    </li>
    <li>
      <a href="github.html">GitHub</a>
    </li>
    <li>
      <a href="pages.html">pages.uoregon.edu</a>
    </li>
    <li>
      <a href="localweb.html">Local websites</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Other
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="readings.html">Readings</a>
    </li>
    <li>
      <a href="websites.html">Old course web pages</a>
    </li>
  </ul>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="about.html">About</a>
</li>
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div id="header">



<h1 class="title toc-ignore">Principal Components Analysis</h1>

</div>

<div id="TOC">
<ul>
<li><a href="#introduction" id="toc-introduction"><span
class="toc-section-number">1</span> Introduction</a>
<ul>
<li><a href="#a-simple-example" id="toc-a-simple-example"><span
class="toc-section-number">1.1</span> A simple example</a></li>
<li><a href="#read-and-subset-the-data"
id="toc-read-and-subset-the-data"><span
class="toc-section-number">1.2</span> Read and subset the data</a></li>
<li><a href="#pca-of-the-two-variable-example"
id="toc-pca-of-the-two-variable-example"><span
class="toc-section-number">1.3</span> PCA of the two-variable
example</a></li>
</ul></li>
<li><a href="#derivation-of-principal-components-and-their-properties"
id="toc-derivation-of-principal-components-and-their-properties"><span
class="toc-section-number">2</span> Derivation of principal components
and their properties</a></li>
<li><a
href="#a-second-example-controls-of-mid-holocene-aridity-in-eurasia"
id="toc-a-second-example-controls-of-mid-holocene-aridity-in-eurasia"><span
class="toc-section-number">3</span> A second example: Controls of
mid-Holocene aridity in Eurasia</a>
<ul>
<li><a href="#read-and-transform-the-data"
id="toc-read-and-transform-the-data"><span
class="toc-section-number">3.1</span> Read and transform the
data</a></li>
<li><a href="#correlations-among-variables"
id="toc-correlations-among-variables"><span
class="toc-section-number">3.2</span> Correlations among
variables</a></li>
<li><a href="#pca-of-the-pmip-3-data"
id="toc-pca-of-the-pmip-3-data"><span
class="toc-section-number">3.3</span> PCA of the PMIP 3 data</a></li>
<li><a href="#qgraph-plot-of-the-principal-components"
id="toc-qgraph-plot-of-the-principal-components"><span
class="toc-section-number">3.4</span> qgraph plot of the principal
components</a></li>
<li><a href="#rotated-components" id="toc-rotated-components"><span
class="toc-section-number">3.5</span> Rotated components</a></li>
</ul></li>
<li><a href="#pca-of-high-dimensional-data"
id="toc-pca-of-high-dimensional-data"><span
class="toc-section-number">4</span> PCA of high-dimensional data</a>
<ul>
<li><a href="#read-the-netcdf-file-of-20th-century-reanalysis-data"
id="toc-read-the-netcdf-file-of-20th-century-reanalysis-data"><span
class="toc-section-number">4.1</span> Read the netCDF file of 20th
Century Reanalysis Data</a></li>
<li><a href="#set-up-for-the-analysis"
id="toc-set-up-for-the-analysis"><span
class="toc-section-number">4.2</span> Set-up for the analysis</a>
<ul>
<li><a href="#reshape-the-array" id="toc-reshape-the-array"><span
class="toc-section-number">4.2.1</span> Reshape the array</a></li>
</ul></li>
</ul></li>
<li><a href="#pca-using-the-pcamethods-package"
id="toc-pca-using-the-pcamethods-package"><span
class="toc-section-number">5</span> PCA using the pcaMethods package</a>
<ul>
<li><a href="#results" id="toc-results"><span
class="toc-section-number">5.1</span> Results</a></li>
</ul></li>
<li><a href="#write-out-the-results"
id="toc-write-out-the-results"><span class="toc-section-number">6</span>
Write out the results</a>
<ul>
<li><a href="#component-scores" id="toc-component-scores"><span
class="toc-section-number">6.1</span> Component scores</a></li>
<li><a href="#write-out-a-netcdf-file-of-component-loadings"
id="toc-write-out-a-netcdf-file-of-component-loadings"><span
class="toc-section-number">6.2</span> Write out a netCDF file of
component loadings</a></li>
</ul></li>
</ul>
</div>

<script>
  addClassKlippyTo("pre.r, pre.markdown");
  addKlippy('right', 'top', 'auto', '1', 'Copy code', 'Copied!');
</script>
<p>
<span style="color: #00cc00;">NOTE: This page has been revised for
Winter 2024, but may undergo further edits.</span>
</p>
<div id="introduction" class="section level1" number="1">
<h1><span class="header-section-number">1</span> Introduction</h1>
<p>Principal components analysis (PCA) is a widely used multivariate
analysis method, the general aim of which is to reveal systematic
covariations among a group of variables. The analysis can be motivated
in a number of different ways, including (in geographical or
Earth-system science contexts) finding groups of variables that measure
the same underlying dimensions of a data set, describing the basic
anomaly patterns that appear in spatial data sets, or producing a
general index of the common variation of a set of variables. The
analysis is also known as <em>factor analysis</em> in many contexts, or
<em>eigenvector analysis</em> or <em>EOF analysis</em> (for “empirical
orthogonal functions”) in meteorology and climatology.</p>
<div id="a-simple-example" class="section level2" number="1.1">
<h2><span class="header-section-number">1.1</span> A simple example</h2>
<p>A classic data set for illustrating PCA is one that appears in John
C. Davis’s 2002 book <em>Statistics and data analysis in geology</em>,
Wiley (UO Library, QE48.8 .D38 2002). The data consist of 25 boxes or
blocks with random dimensions (the long, intermediate and short axes of
the boxes), plus some derived variables, like the length of the longest
diagonal that can be contained within a box.</p>
<p>Here’s the data: <a
href="https://pjbartlein.github.io/REarthSysSci/data/csv/boxes.csv">[boxes.csv]</a></p>
<ul>
<li>Example: Davis’ boxes (<a
href="https://pjbartlein.github.io/REarthSysSci/images/Davis_PCA_data.png">data</a>,
<a
href="https://pjbartlein.github.io/REarthSysSci/images/Davis_PCA_boxes.png">plot</a>,
<a
href="https://pjbartlein.github.io/REarthSysSci/images/Davis_PCA_scatter.png">scatter</a>,
<a
href="https://pjbartlein.github.io/REarthSysSci/images/Davis_PCA_scores.png">components</a>),
(Davis, J.C., 2001, <em>Statistics and Data Analysis in Geology</em>,
Wiley)</li>
<li><a
href="https://pjbartlein.github.io/REarthSysSci/topics/pca_matrix.html">Derivation
of principal components</a></li>
</ul>
</div>
<div id="read-and-subset-the-data" class="section level2" number="1.2">
<h2><span class="header-section-number">1.2</span> Read and subset the
data</h2>
<p>First, only two variables will be analyzed, in order to be able to
visualize how the components are defined. Read the data:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a><span class="co"># read a .csv file of Davis&#39;s data</span></span>
<span id="cb1-2"><a href="#cb1-2" tabindex="-1"></a>boxes_path <span class="ot">&lt;-</span> <span class="st">&quot;/Users/bartlein/Projects/RESS/data/csv_files/&quot;</span></span>
<span id="cb1-3"><a href="#cb1-3" tabindex="-1"></a>boxes_name <span class="ot">&lt;-</span> <span class="st">&quot;boxes.csv&quot;</span></span>
<span id="cb1-4"><a href="#cb1-4" tabindex="-1"></a>boxes_file <span class="ot">&lt;-</span> <span class="fu">paste</span>(boxes_path, boxes_name, <span class="at">sep=</span><span class="st">&quot;&quot;</span>)</span>
<span id="cb1-5"><a href="#cb1-5" tabindex="-1"></a>boxes <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(boxes_file) </span>
<span id="cb1-6"><a href="#cb1-6" tabindex="-1"></a><span class="fu">str</span>(boxes)</span></code></pre></div>
<pre><code>## &#39;data.frame&#39;:    25 obs. of  7 variables:
##  $ long   : num  3.76 8.59 6.22 7.57 9.03 5.51 3.27 8.74 9.64 9.73 ...
##  $ inter  : num  3.66 4.99 6.14 7.28 7.08 3.98 0.62 7 9.49 1.33 ...
##  $ short  : num  0.54 1.34 4.52 7.07 2.59 1.3 0.44 3.31 1.03 1 ...
##  $ diag   : num  5.28 10.02 9.84 12.66 11.76 ...
##  $ sphere : num  9.77 7.5 2.17 1.79 4.54 ...
##  $ axis   : num  13.74 10.16 2.73 2.1 6.22 ...
##  $ areavol: num  4.782 2.13 1.089 0.822 1.276 ...</code></pre>
<p>Make a matrix of two variables <code>long</code> (long axis of each
box), and <code>diag</code> (longest diagonal that fits in a box).</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" tabindex="-1"></a>boxes_matrix <span class="ot">&lt;-</span> <span class="fu">data.matrix</span>(<span class="fu">cbind</span>(boxes[,<span class="dv">1</span>],boxes[,<span class="dv">4</span>]))</span>
<span id="cb3-2"><a href="#cb3-2" tabindex="-1"></a><span class="fu">dimnames</span>(boxes_matrix) <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="cn">NULL</span>, <span class="fu">cbind</span>(<span class="st">&quot;long&quot;</span>,<span class="st">&quot;diag&quot;</span>))</span></code></pre></div>
<p>Examine a scatter plot, and get the correlations between the
variables:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" tabindex="-1"></a><span class="fu">par</span>(<span class="at">pty=</span><span class="st">&quot;s&quot;</span>) <span class="co"># square plotting frame</span></span>
<span id="cb4-2"><a href="#cb4-2" tabindex="-1"></a><span class="fu">plot</span>(boxes_matrix)</span></code></pre></div>
<p><img src="pca_files/figure-html/pca-4-1.png" width="75%" height="75%" /></p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" tabindex="-1"></a><span class="fu">cor</span>(boxes_matrix)</span></code></pre></div>
<pre><code>##           long      diag
## long 1.0000000 0.9112586
## diag 0.9112586 1.0000000</code></pre>
<p>The two variables are obviously related, but not exactly (because the
other dimensions of the box, the short and intermediate axis length)
also influence the longest diagonal value.</p>
</div>
<div id="pca-of-the-two-variable-example" class="section level2"
number="1.3">
<h2><span class="header-section-number">1.3</span> PCA of the
two-variable example</h2>
<p>Do a PCA using the <code>princomp()</code> function from the
<code>stats</code> package. The <code>loadings()</code> function
extracts the <em>loadings</em> or the correlations between the input
variables and the new components, and the the <code>biplot()</code>
function creates a biplot – a single figure that plots the loadings as
vectors and the component <em>scores</em> (or the value of each
component) as points represented by the observation numbers.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" tabindex="-1"></a>boxes_pca <span class="ot">&lt;-</span> <span class="fu">princomp</span>(boxes_matrix, <span class="at">cor=</span>T)</span>
<span id="cb7-2"><a href="#cb7-2" tabindex="-1"></a>boxes_pca</span></code></pre></div>
<pre><code>## Call:
## princomp(x = boxes_matrix, cor = T)
## 
## Standard deviations:
##   Comp.1   Comp.2 
## 1.382483 0.297895 
## 
##  2  variables and  25 observations.</code></pre>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" tabindex="-1"></a><span class="fu">summary</span>(boxes_pca)</span></code></pre></div>
<pre><code>## Importance of components:
##                           Comp.1    Comp.2
## Standard deviation     1.3824828 0.2978950
## Proportion of Variance 0.9556293 0.0443707
## Cumulative Proportion  0.9556293 1.0000000</code></pre>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">loadings</span>(boxes_pca),<span class="at">cutoff=</span><span class="fl">0.0</span>)</span></code></pre></div>
<pre><code>## 
## Loadings:
##      Comp.1 Comp.2
## long  0.707  0.707
## diag  0.707 -0.707
## 
##                Comp.1 Comp.2
## SS loadings       1.0    1.0
## Proportion Var    0.5    0.5
## Cumulative Var    0.5    1.0</code></pre>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" tabindex="-1"></a><span class="fu">biplot</span>(boxes_pca)</span></code></pre></div>
<p><img src="pca_files/figure-html/pca-5-1.png" width="75%" height="75%" /></p>
<p>The component standard deviation values describe the importance of
each component, and the proportion of the total variance of all
variables being analyzed accounted for by each component.</p>
<p>Note the angle between the vectors on the bipolt–the correlation
between two variables is equal to the cosine of the angle between the
vectors (<em>θ</em>), or <em>r = cos(θ)</em>. Here the angle is
24.3201359, which is found by the following R code:
<code>acos(cor(boxes_matrix[,1],boxes_matrix[,2]))/((2*pi)/360)</code>.</p>
<p>The components can be drawn on the scatter plot as follows:</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" tabindex="-1"></a><span class="co"># get parameters of component lines (after Everitt &amp; Rabe-Hesketh)</span></span>
<span id="cb14-2"><a href="#cb14-2" tabindex="-1"></a>load <span class="ot">&lt;-</span> boxes_pca<span class="sc">$</span>loadings</span>
<span id="cb14-3"><a href="#cb14-3" tabindex="-1"></a>slope <span class="ot">&lt;-</span> load[<span class="dv">2</span>,]<span class="sc">/</span>load[<span class="dv">1</span>,]</span>
<span id="cb14-4"><a href="#cb14-4" tabindex="-1"></a>mn <span class="ot">&lt;-</span> <span class="fu">apply</span>(boxes_matrix,<span class="dv">2</span>,mean)</span>
<span id="cb14-5"><a href="#cb14-5" tabindex="-1"></a>intcpt <span class="ot">&lt;-</span> mn[<span class="dv">2</span>]<span class="sc">-</span>(slope<span class="sc">*</span>mn[<span class="dv">1</span>])</span>
<span id="cb14-6"><a href="#cb14-6" tabindex="-1"></a></span>
<span id="cb14-7"><a href="#cb14-7" tabindex="-1"></a><span class="co"># scatter plot with the two new axes added</span></span>
<span id="cb14-8"><a href="#cb14-8" tabindex="-1"></a><span class="fu">par</span>(<span class="at">pty=</span><span class="st">&quot;s&quot;</span>) <span class="co"># square plotting frame</span></span>
<span id="cb14-9"><a href="#cb14-9" tabindex="-1"></a>xlim <span class="ot">&lt;-</span> <span class="fu">range</span>(boxes_matrix) <span class="co"># overall min, max</span></span>
<span id="cb14-10"><a href="#cb14-10" tabindex="-1"></a><span class="fu">plot</span>(boxes_matrix, <span class="at">xlim=</span>xlim, <span class="at">ylim=</span>xlim, <span class="at">pch=</span><span class="dv">16</span>, <span class="at">cex=</span><span class="fl">0.5</span>, <span class="at">col=</span><span class="st">&quot;purple&quot;</span>) <span class="co"># both axes same length</span></span>
<span id="cb14-11"><a href="#cb14-11" tabindex="-1"></a><span class="fu">abline</span>(intcpt[<span class="dv">1</span>],slope[<span class="dv">1</span>],<span class="at">lwd=</span><span class="dv">2</span>) <span class="co"># first component solid line</span></span>
<span id="cb14-12"><a href="#cb14-12" tabindex="-1"></a><span class="fu">abline</span>(intcpt[<span class="dv">2</span>],slope[<span class="dv">2</span>],<span class="at">lwd=</span><span class="dv">2</span>,<span class="at">lty=</span><span class="dv">2</span>) <span class="co"># second component dashed</span></span>
<span id="cb14-13"><a href="#cb14-13" tabindex="-1"></a><span class="fu">legend</span>(<span class="st">&quot;right&quot;</span>, <span class="at">legend =</span> <span class="fu">c</span>(<span class="st">&quot;PC 1&quot;</span>, <span class="st">&quot;PC 2&quot;</span>), <span class="at">lty =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>), <span class="at">lwd =</span> <span class="dv">2</span>, <span class="at">cex =</span> <span class="dv">1</span>)</span>
<span id="cb14-14"><a href="#cb14-14" tabindex="-1"></a></span>
<span id="cb14-15"><a href="#cb14-15" tabindex="-1"></a><span class="co"># projections of points onto PCA 1</span></span>
<span id="cb14-16"><a href="#cb14-16" tabindex="-1"></a>y1 <span class="ot">&lt;-</span> intcpt[<span class="dv">1</span>]<span class="sc">+</span>slope[<span class="dv">1</span>]<span class="sc">*</span>boxes_matrix[,<span class="dv">1</span>]</span>
<span id="cb14-17"><a href="#cb14-17" tabindex="-1"></a>x1 <span class="ot">&lt;-</span> (boxes_matrix[,<span class="dv">2</span>]<span class="sc">-</span>intcpt[<span class="dv">1</span>])<span class="sc">/</span>slope[<span class="dv">1</span>]</span>
<span id="cb14-18"><a href="#cb14-18" tabindex="-1"></a>y2 <span class="ot">&lt;-</span> (y1<span class="sc">+</span>boxes_matrix[,<span class="dv">2</span>])<span class="sc">/</span><span class="fl">2.0</span></span>
<span id="cb14-19"><a href="#cb14-19" tabindex="-1"></a>x2 <span class="ot">&lt;-</span> (x1<span class="sc">+</span>boxes_matrix[,<span class="dv">1</span>])<span class="sc">/</span><span class="fl">2.0</span></span>
<span id="cb14-20"><a href="#cb14-20" tabindex="-1"></a><span class="fu">segments</span>(boxes_matrix[,<span class="dv">1</span>],boxes_matrix[,<span class="dv">2</span>], x2, y2, <span class="at">lwd=</span><span class="dv">2</span>,<span class="at">col=</span><span class="st">&quot;purple&quot;</span>)</span></code></pre></div>
<p><img src="pca_files/figure-html/pca-6-1.png" width="75%" height="75%" /></p>
<p>This plot illustrates the idea of the first (or “principal”
component) providing an optimal summary of the data–no other line drawn
on this scatter plot would produce a set of projected values of the data
points onto the line with greater variance. The line also appears
similar to a regression line, and in fact and PCA of two variables (as
here) is equivalent to a “reduced major-axis” regression analysis.</p>
<p><a href="pca.html">[Back to top]</a></p>
</div>
</div>
<div id="derivation-of-principal-components-and-their-properties"
class="section level1" number="2">
<h1><span class="header-section-number">2</span> Derivation of principal
components and their properties</h1>
<p>The formal derivation of principal components analysis requires the
use of matix algebra.</p>
<ul>
<li><a
href="https://pjbartlein.github.io/REarthSysSci/topics/matrix.pdf">[Matrix
algebra]</a></li>
<li><a
href="https://pjbartlein.github.io/REarthSysSci/topics/pca_matrix.html">[Derivation
of principal components]</a></li>
</ul>
<p>Because the components are derived by solving a particular
optimization problem, they naturally have some “built-in” properties
that are desirable in practice (e.g. maximum variability). In addition,
there are a number of other properties of the components that can be
derived:</p>
<ul>
<li><em>variances</em> of each component, and the <em>proportion of the
total variance</em> of the original variables are are given by the
eigenvalues;</li>
<li>component <em>scores</em> may be calculated, that illustrate the
value of each component at each observation;</li>
<li>component <em>loadings</em> that describe the correlation between
each component and each variable may also be obtained;</li>
<li>the <em>correlations among the original variables</em> can be
reproduced by the <em>p</em>-components, as can that part of the
correlations “explained” by the first q components.</li>
<li>the <em>original data can be reproduced</em> by the <em>p</em>
components, as can those parts of the original data “explained” by the
first <em>q</em> components;</li>
<li>the components can be “<em>rotated</em>” to increase the
interpretability of the components.</li>
</ul>
<p><a href="pca.html">[Back to top]</a></p>
</div>
<div id="a-second-example-controls-of-mid-holocene-aridity-in-eurasia"
class="section level1" number="3">
<h1><span class="header-section-number">3</span> A second example:
Controls of mid-Holocene aridity in Eurasia</h1>
<p>The data set here is a “stacked” data set of output from thirteen
“PMIP3” simulations of mid-Holocene climate (in particular, the
long-term mean differences between the mid-Holocene simulations and
those for the pre-industrial period) for a region in northern Eurasia.
The objective of the analysis was to examine the systematic relationship
among a number of different climate variables as part of understanding
the mismatch between the simulations and paleoenvironmental observations
(reconstructions), where the simulations were in general drier and
warmer than the climate reconstructed from the data. (See Bartlein,
P.J., S.P. Harrison and K. Izumi, 2017, Underlying causes of Eurasian
mid-continental aridity in simulations of mid-Holocene climate,
<em>Geophysical Research Letters</em> 44:1-9, <a
href="http://dx.doi.org/10.1002/2017GL074476">http://dx.doi.org/10.1002/2017GL074476</a>)</p>
<p>The variable include:</p>
<ul>
<li><code>Kext</code>: Insolation at the top of the atmosphere</li>
<li><code>Kn</code>: Net shortwave radiation</li>
<li><code>Ln</code>: Net longwave ratiation<br />
</li>
<li><code>Qn</code>: Net radiation</li>
<li><code>Qe</code>: Latent heating</li>
<li><code>Qh</code>: Sensible heating<br />
</li>
<li><code>Qg</code>: Substrate heating</li>
<li><code>bowen</code>: Bowen ratio (<code>Qh/Qn</code>)</li>
<li><code>alb</code>: Albedo</li>
<li><code>ta</code>: 850 mb temperature</li>
<li><code>tas</code>: Near-surface (2 m) air temperature</li>
<li><code>ts</code>: Surface (skin) temperature</li>
<li><code>ua</code>: Eastward wind component, 500 hpa level</li>
<li><code>va</code>: Northward wind component, 500 hPa level</li>
<li><code>omg</code>: 500 hPa vertical velocity</li>
<li><code>uas</code>: Eastward wind component, surface</li>
<li><code>vas</code>: Northward wind component, surface</li>
<li><code>slp</code>: Mean sea-level pressure</li>
<li><code>Qdv</code>: Moisture divergence</li>
<li><code>shm</code>: Specific humidity</li>
<li><code>clt</code>: Cloudiness</li>
<li><code>pre</code>: Precipitation rate</li>
<li><code>evap</code>: Evaporation rate</li>
<li><code>pme</code>: P-E rate</li>
<li><code>sm</code>: Soil moisture</li>
<li><code>ro</code>: Runoff</li>
<li><code>dS</code>: Change in moisture storage</li>
<li><code>snd</code>: Snow depth</li>
</ul>
<p>The data set was assebled by stacking the monthly long-term mean
differneces from each model on top of one another, creating a 13 x 12
row by 24 column array. This arrangement of the data will reveal the
common variations in the seasonal cycles of the long-term mean
differences.</p>
<div id="read-and-transform-the-data" class="section level2"
number="3.1">
<h2><span class="header-section-number">3.1</span> Read and transform
the data</h2>
<p>Load necessary packages.</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" tabindex="-1"></a><span class="co"># pca of multimodel means</span></span>
<span id="cb15-2"><a href="#cb15-2" tabindex="-1"></a><span class="fu">library</span>(corrplot)</span>
<span id="cb15-3"><a href="#cb15-3" tabindex="-1"></a><span class="fu">library</span>(qgraph)</span>
<span id="cb15-4"><a href="#cb15-4" tabindex="-1"></a><span class="fu">library</span>(psych)</span></code></pre></div>
<p>Read the data:</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" tabindex="-1"></a><span class="co"># read data</span></span>
<span id="cb16-2"><a href="#cb16-2" tabindex="-1"></a>datapath <span class="ot">&lt;-</span> <span class="st">&quot;/Users/bartlein/Projects/RESS/data/csv_files/&quot;</span></span>
<span id="cb16-3"><a href="#cb16-3" tabindex="-1"></a>csvfile <span class="ot">&lt;-</span> <span class="st">&quot;aavesModels_ltmdiff_NEurAsia.csv&quot;</span></span>
<span id="cb16-4"><a href="#cb16-4" tabindex="-1"></a>input_data <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="fu">paste</span>(datapath, csvfile, <span class="at">sep=</span><span class="st">&quot;&quot;</span>))</span>
<span id="cb16-5"><a href="#cb16-5" tabindex="-1"></a>mm_data_in <span class="ot">&lt;-</span> input_data[,<span class="dv">3</span><span class="sc">:</span><span class="dv">30</span>]</span>
<span id="cb16-6"><a href="#cb16-6" tabindex="-1"></a><span class="fu">names</span>(mm_data_in)</span></code></pre></div>
<pre><code>##  [1] &quot;Kext&quot;  &quot;Kn&quot;    &quot;Ln&quot;    &quot;Qn&quot;    &quot;Qe&quot;    &quot;Qh&quot;    &quot;Qg&quot;    &quot;bowen&quot; &quot;alb&quot;   &quot;ta&quot;    &quot;tas&quot;   &quot;ts&quot;   
## [13] &quot;ua&quot;    &quot;va&quot;    &quot;omg&quot;   &quot;uas&quot;   &quot;vas&quot;   &quot;slp&quot;   &quot;Qdv&quot;   &quot;shm&quot;   &quot;clt&quot;   &quot;pre&quot;   &quot;evap&quot;  &quot;pme&quot;  
## [25] &quot;sm&quot;    &quot;ro&quot;    &quot;dS&quot;    &quot;snd&quot;</code></pre>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" tabindex="-1"></a><span class="fu">summary</span>(mm_data_in)</span></code></pre></div>
<pre><code>##       Kext                Kn                 Ln                  Qn                 Qe         
##  Min.   :-13.6300   Min.   :-14.1700   Min.   :-6.001000   Min.   :-13.9000   Min.   :-8.0500  
##  1st Qu.:-10.4225   1st Qu.: -5.5927   1st Qu.:-1.111500   1st Qu.: -4.0630   1st Qu.:-1.1265  
##  Median : -6.4320   Median : -2.4285   Median : 0.299050   Median : -1.7405   Median :-0.5851  
##  Mean   :  0.3369   Mean   :  0.4261   Mean   :-0.005344   Mean   :  0.4208   Mean   :-0.1175  
##  3rd Qu.:  7.7847   3rd Qu.:  3.9592   3rd Qu.: 1.561250   3rd Qu.:  3.1260   3rd Qu.: 0.4831  
##  Max.   : 27.9600   Max.   : 18.0700   Max.   : 3.333000   Max.   : 16.1200   Max.   : 7.9230  
##                                                                                                
##        Qh                Qg              bowen                 alb                  ta         
##  Min.   :-5.1570   Min.   :-5.0070   Min.   :-9.870e+04   Min.   :-0.780800   Min.   :-2.2300  
##  1st Qu.:-1.9760   1st Qu.:-0.9643   1st Qu.: 0.000e+00   1st Qu.:-0.001757   1st Qu.:-0.7361  
##  Median :-0.8945   Median :-0.2530   Median : 0.000e+00   Median : 0.356050   Median :-0.3137  
##  Mean   : 0.3968   Mean   : 0.1404   Mean   : 2.826e+13   Mean   : 0.705529   Mean   : 0.1110  
##  3rd Qu.: 2.0897   3rd Qu.: 1.3645   3rd Qu.: 1.000e+00   3rd Qu.: 1.113250   3rd Qu.: 0.8729  
##  Max.   :12.0900   Max.   : 6.3150   Max.   : 2.650e+15   Max.   : 6.185000   Max.   : 3.1420  
##                                                                                                
##       tas                 ts                 ua                 va                 omg            
##  Min.   :-2.76900   Min.   :-2.88700   Min.   :-0.98680   Min.   :-0.495200   Min.   :-3.320e-03  
##  1st Qu.:-0.92268   1st Qu.:-0.96540   1st Qu.:-0.35147   1st Qu.:-0.134500   1st Qu.:-6.360e-04  
##  Median :-0.42775   Median :-0.43625   Median :-0.09715   Median :-0.003020   Median :-9.845e-05  
##  Mean   :-0.02964   Mean   :-0.02853   Mean   :-0.07626   Mean   : 0.002278   Mean   :-1.757e-04  
##  3rd Qu.: 0.82620   3rd Qu.: 0.82827   3rd Qu.: 0.15207   3rd Qu.: 0.126825   3rd Qu.: 2.918e-04  
##  Max.   : 3.14600   Max.   : 3.34300   Max.   : 1.22400   Max.   : 0.492300   Max.   : 1.370e-03  
##                                                                                                   
##       uas                 vas                slp               Qdv                  shm            
##  Min.   :-0.375000   Min.   :-0.13690   Min.   :-358.90   Min.   :-5.390e-10   Min.   :-5.020e-04  
##  1st Qu.:-0.104800   1st Qu.:-0.03717   1st Qu.:-114.83   1st Qu.:-5.603e-11   1st Qu.:-9.333e-05  
##  Median :-0.022700   Median : 0.02635   Median : -11.97   Median :-1.990e-11   Median :-2.340e-05  
##  Mean   :-0.008201   Mean   : 0.02238   Mean   : -48.91   Mean   :-1.825e-11   Mean   : 6.629e-05  
##  3rd Qu.: 0.092525   3rd Qu.: 0.07550   3rd Qu.:  45.24   3rd Qu.: 3.635e-11   3rd Qu.: 1.655e-04  
##  Max.   : 0.591500   Max.   : 0.22940   Max.   : 126.30   Max.   : 2.030e-10   Max.   : 9.930e-04  
##                                                                                                    
##       clt               pre                 evap                pme                 sm         
##  Min.   :-5.8260   Min.   :-0.266700   Min.   :-0.278200   Min.   :-0.26930   Min.   :-40.330  
##  1st Qu.:-0.8750   1st Qu.:-0.037850   1st Qu.:-0.037825   1st Qu.:-0.04333   1st Qu.:-11.960  
##  Median : 0.2599   Median :-0.000015   Median :-0.016950   Median : 0.00441   Median : -5.433  
##  Mean   :-0.1085   Mean   :-0.012835   Mean   :-0.001746   Mean   :-0.01109   Mean   : -9.501  
##  3rd Qu.: 1.0036   3rd Qu.: 0.023350   3rd Qu.: 0.016725   3rd Qu.: 0.03058   3rd Qu.: -3.272  
##  Max.   : 2.4320   Max.   : 0.104900   Max.   : 0.273700   Max.   : 0.10930   Max.   :  7.799  
##                                                                                                
##        ro                  dS                 snd            
##  Min.   :-0.288000   Min.   :-0.424700   Min.   :-0.0056800  
##  1st Qu.:-0.020650   1st Qu.:-0.052750   1st Qu.:-0.0000117  
##  Median :-0.006690   Median : 0.012300   Median : 0.0054200  
##  Mean   :-0.008101   Mean   :-0.006516   Mean   : 0.0094521  
##  3rd Qu.: 0.000247   3rd Qu.: 0.044000   3rd Qu.: 0.0156750  
##  Max.   : 0.439200   Max.   : 0.262900   Max.   : 0.0593000  
##                                          NA&#39;s   :2</code></pre>
<p>There are a few fix-ups to do. Recode a few missing (NA) values of
snow depth to 0.0:</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" tabindex="-1"></a><span class="co"># recode a few NA&#39;s to zero</span></span>
<span id="cb20-2"><a href="#cb20-2" tabindex="-1"></a>mm_data_in<span class="sc">$</span>snd[<span class="fu">is.na</span>(mm_data_in<span class="sc">$</span>snd)] <span class="ot">&lt;-</span> <span class="fl">0.0</span></span></code></pre></div>
<p>Remove some uncessary or redundant variable:</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" tabindex="-1"></a><span class="co"># remove uneccesary variables</span></span>
<span id="cb21-2"><a href="#cb21-2" tabindex="-1"></a>dropvars <span class="ot">&lt;-</span> <span class="fu">names</span>(mm_data_in) <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;Kext&quot;</span>,<span class="st">&quot;bowen&quot;</span>,<span class="st">&quot;sm&quot;</span>,<span class="st">&quot;evap&quot;</span>)</span>
<span id="cb21-3"><a href="#cb21-3" tabindex="-1"></a>mm_data <span class="ot">&lt;-</span> mm_data_in[<span class="sc">!</span>dropvars]</span>
<span id="cb21-4"><a href="#cb21-4" tabindex="-1"></a><span class="fu">names</span>(mm_data)</span></code></pre></div>
<pre><code>##  [1] &quot;Kn&quot;  &quot;Ln&quot;  &quot;Qn&quot;  &quot;Qe&quot;  &quot;Qh&quot;  &quot;Qg&quot;  &quot;alb&quot; &quot;ta&quot;  &quot;tas&quot; &quot;ts&quot;  &quot;ua&quot;  &quot;va&quot;  &quot;omg&quot; &quot;uas&quot; &quot;vas&quot; &quot;slp&quot;
## [17] &quot;Qdv&quot; &quot;shm&quot; &quot;clt&quot; &quot;pre&quot; &quot;pme&quot; &quot;ro&quot;  &quot;dS&quot;  &quot;snd&quot;</code></pre>
</div>
<div id="correlations-among-variables" class="section level2"
number="3.2">
<h2><span class="header-section-number">3.2</span> Correlations among
variables</h2>
<p>It’s useful to look at the correlations among the long-term mean
differences among the variables. This could be done using a matrix
scatterplot (<code>plot(mm_data, pch=16, cex=0.5</code>), but there are
enough variables (24) to make that difficult to interpret. Another
approach is to look at a <code>corrplot()</code> image:</p>
<div class="sourceCode" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" tabindex="-1"></a>cor_mm_data <span class="ot">&lt;-</span> <span class="fu">cor</span>(mm_data)</span>
<span id="cb23-2"><a href="#cb23-2" tabindex="-1"></a><span class="fu">corrplot</span>(cor_mm_data, <span class="at">method=</span><span class="st">&quot;color&quot;</span>)</span></code></pre></div>
<p><img src="pca_files/figure-html/pca-11-1.png" width="75%" height="75%" /></p>
<p>The plaid-like appearance of the plot suggests that there are several
groups of variables whose variations of long-term mean differences
throughout the year are similar.</p>
<p>The correlations can also be illustrated by plotting the correlations
as a network graph using the <code>qgraph()</code> function, with the
strength of the correlations indicated by the width of the lines (or
“edges”), and the sign by the color (green = positive and magenta =
negative).</p>
<div class="sourceCode" id="cb24"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" tabindex="-1"></a><span class="fu">qgraph</span>(cor_mm_data, <span class="at">title=</span><span class="st">&quot;Correlations, multi-model ltm differences over months&quot;</span>,</span>
<span id="cb24-2"><a href="#cb24-2" tabindex="-1"></a>  <span class="co"># layout = &quot;spring&quot;, </span></span>
<span id="cb24-3"><a href="#cb24-3" tabindex="-1"></a>  <span class="at">posCol =</span> <span class="st">&quot;darkgreen&quot;</span>, <span class="at">negCol =</span> <span class="st">&quot;darkmagenta&quot;</span>, <span class="at">arrows =</span> <span class="cn">FALSE</span>,</span>
<span id="cb24-4"><a href="#cb24-4" tabindex="-1"></a>  <span class="at">node.height=</span><span class="fl">0.5</span>, <span class="at">node.width=</span><span class="fl">0.5</span>, <span class="at">vTrans=</span><span class="dv">128</span>, <span class="at">edge.width=</span><span class="fl">0.75</span>, <span class="at">label.cex=</span><span class="fl">1.0</span>,</span>
<span id="cb24-5"><a href="#cb24-5" tabindex="-1"></a>  <span class="at">width=</span><span class="dv">7</span>, <span class="at">height=</span><span class="dv">5</span>, <span class="at">normalize=</span><span class="cn">TRUE</span>, <span class="at">edge.width=</span><span class="fl">0.75</span> ) </span></code></pre></div>
<p><img src="pca_files/figure-html/pca-12-1.png" width="75%" height="75%" /></p>
<p>A useful variant of this plot is provided by using the strength of
the correlations to arrange the nodes (i.e. the variables). This is done
by using the “Fruchterman-Reingold” algorithm that invokes the concept
of spring tension pulling the nodes of the more highly correlated
variables toward one another.</p>
<div class="sourceCode" id="cb25"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" tabindex="-1"></a><span class="fu">qgraph</span>(cor_mm_data, <span class="at">title=</span><span class="st">&quot;Correlations, multi-model ltm differences over months&quot;</span>,</span>
<span id="cb25-2"><a href="#cb25-2" tabindex="-1"></a>  <span class="at">layout =</span> <span class="st">&quot;spring&quot;</span>, <span class="at">repulsion =</span> <span class="fl">0.75</span>,</span>
<span id="cb25-3"><a href="#cb25-3" tabindex="-1"></a>  <span class="at">posCol =</span> <span class="st">&quot;darkgreen&quot;</span>, <span class="at">negCol =</span> <span class="st">&quot;darkmagenta&quot;</span>, <span class="at">arrows =</span> <span class="cn">FALSE</span>,</span>
<span id="cb25-4"><a href="#cb25-4" tabindex="-1"></a>  <span class="at">node.height=</span><span class="fl">0.5</span>, <span class="at">node.width=</span><span class="fl">0.5</span>, <span class="at">vTrans=</span><span class="dv">128</span>, <span class="at">edge.width=</span><span class="fl">0.75</span>, <span class="at">label.cex=</span><span class="fl">1.0</span>,</span>
<span id="cb25-5"><a href="#cb25-5" tabindex="-1"></a>  <span class="at">width=</span><span class="dv">7</span>, <span class="at">height=</span><span class="dv">5</span>, <span class="at">normalize=</span><span class="cn">TRUE</span>, <span class="at">edge.width=</span><span class="fl">0.75</span> ) </span></code></pre></div>
<p><img src="pca_files/figure-html/pca-13-1.png" width="75%" height="75%" /></p>
</div>
<div id="pca-of-the-pmip-3-data" class="section level2" number="3.3">
<h2><span class="header-section-number">3.3</span> PCA of the PMIP 3
data</h2>
<p>Do a principal components analysis of the long-term mean differneces
using the <code>principal()</code> function from the <code>psych</code>
package. Initiall, extract eight components:</p>
<div class="sourceCode" id="cb26"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" tabindex="-1"></a>nfactors <span class="ot">&lt;-</span> <span class="dv">8</span></span>
<span id="cb26-2"><a href="#cb26-2" tabindex="-1"></a>mm_pca_unrot <span class="ot">&lt;-</span> <span class="fu">principal</span>(mm_data, <span class="at">nfactors =</span> nfactors, <span class="at">rotate =</span> <span class="st">&quot;none&quot;</span>)</span>
<span id="cb26-3"><a href="#cb26-3" tabindex="-1"></a>mm_pca_unrot</span></code></pre></div>
<pre><code>## Principal Components Analysis
## Call: principal(r = mm_data, nfactors = nfactors, rotate = &quot;none&quot;)
## Standardized loadings (pattern matrix) based upon correlation matrix
##       PC1   PC2   PC3   PC4   PC5   PC6   PC7   PC8   h2    u2 com
## Kn   0.95 -0.09  0.02 -0.19  0.00  0.12  0.00 -0.14 0.99 0.013 1.2
## Ln  -0.79  0.36  0.16  0.09 -0.25  0.02 -0.06  0.21 0.91 0.090 2.0
## Qn   0.94  0.01  0.08 -0.21 -0.08  0.16 -0.02 -0.11 0.98 0.018 1.2
## Qe   0.68  0.44  0.02 -0.03 -0.33  0.44  0.04  0.10 0.97 0.034 3.1
## Qh   0.91 -0.18 -0.04 -0.18  0.08  0.02 -0.05 -0.18 0.94 0.060 1.3
## Qg   0.69 -0.18  0.35 -0.31 -0.04 -0.01 -0.03 -0.15 0.76 0.241 2.2
## alb -0.64 -0.30 -0.32 -0.38  0.09  0.15 -0.03  0.30 0.87 0.126 3.5
## ta   0.91  0.23 -0.13  0.12  0.07 -0.14  0.05  0.08 0.95 0.049 1.3
## tas  0.93  0.23 -0.09  0.12  0.07 -0.10  0.04  0.05 0.96 0.043 1.2
## ts   0.93  0.22 -0.09  0.11  0.08 -0.10  0.04  0.04 0.96 0.043 1.2
## ua  -0.26  0.39  0.06  0.10  0.71  0.31 -0.19  0.11 0.88 0.123 2.6
## va   0.73  0.30 -0.06  0.02  0.19 -0.30  0.00  0.07 0.75 0.250 1.9
## omg  0.27 -0.50  0.02  0.53 -0.20 -0.07  0.22  0.24 0.75 0.252 3.7
## uas -0.74  0.09  0.05 -0.06  0.15  0.36  0.42 -0.22 0.94 0.064 2.5
## vas -0.67  0.37 -0.03  0.03  0.13 -0.04  0.57 -0.05 0.93 0.072 2.7
## slp -0.89 -0.14  0.12  0.17 -0.22 -0.05 -0.01 -0.04 0.92 0.083 1.3
## Qdv  0.01 -0.39  0.00  0.70  0.11  0.37 -0.24 -0.11 0.86 0.138 2.6
## shm  0.79  0.37 -0.19  0.08 -0.08  0.06  0.07  0.30 0.92 0.083 2.0
## clt -0.65  0.30  0.44 -0.06 -0.24 -0.05 -0.18 -0.14 0.82 0.179 3.0
## pre  0.02  0.89  0.18  0.02 -0.21  0.20 -0.11  0.06 0.92 0.081 1.4
## pme -0.78  0.38  0.15  0.05  0.19 -0.30 -0.14 -0.04 0.92 0.077 2.2
## ro   0.10 -0.16  0.89 -0.04  0.21 -0.09  0.07  0.25 0.96 0.040 1.4
## dS  -0.65  0.38 -0.55  0.07 -0.04 -0.16 -0.13 -0.20 0.96 0.035 3.1
## snd -0.67 -0.28 -0.25 -0.41 -0.02  0.09 -0.10  0.30 0.86 0.141 3.0
## 
##                         PC1  PC2  PC3  PC4  PC5  PC6  PC7  PC8
## SS loadings           12.18 2.85 1.76 1.40 1.09 0.94 0.76 0.68
## Proportion Var         0.51 0.12 0.07 0.06 0.05 0.04 0.03 0.03
## Cumulative Var         0.51 0.63 0.70 0.76 0.80 0.84 0.87 0.90
## Proportion Explained   0.56 0.13 0.08 0.06 0.05 0.04 0.04 0.03
## Cumulative Proportion  0.56 0.69 0.78 0.84 0.89 0.93 0.97 1.00
## 
## Mean item complexity =  2.1
## Test of the hypothesis that 8 components are sufficient.
## 
## The root mean square of the residuals (RMSR) is  0.03 
##  with the empirical chi square  69.66  with prob &lt;  1 
## 
## Fit based upon off diagonal values = 1</code></pre>
<p>The analysis suggests that only five components are as “important” as
any of the original (standardized) variables, so repeate the analysis
extracting just five components:</p>
<div class="sourceCode" id="cb28"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" tabindex="-1"></a>nfactors <span class="ot">&lt;-</span> <span class="dv">5</span></span>
<span id="cb28-2"><a href="#cb28-2" tabindex="-1"></a>mm_pca_unrot <span class="ot">&lt;-</span> <span class="fu">principal</span>(mm_data, <span class="at">nfactors =</span> nfactors, <span class="at">rotate =</span> <span class="st">&quot;none&quot;</span>)</span>
<span id="cb28-3"><a href="#cb28-3" tabindex="-1"></a>mm_pca_unrot</span></code></pre></div>
<pre><code>## Principal Components Analysis
## Call: principal(r = mm_data, nfactors = nfactors, rotate = &quot;none&quot;)
## Standardized loadings (pattern matrix) based upon correlation matrix
##       PC1   PC2   PC3   PC4   PC5   h2    u2 com
## Kn   0.95 -0.09  0.02 -0.19  0.00 0.95 0.048 1.1
## Ln  -0.79  0.36  0.16  0.09 -0.25 0.86 0.137 1.8
## Qn   0.94  0.01  0.08 -0.21 -0.08 0.94 0.056 1.1
## Qe   0.68  0.44  0.02 -0.03 -0.33 0.76 0.237 2.2
## Qh   0.91 -0.18 -0.04 -0.18  0.08 0.91 0.094 1.2
## Qg   0.69 -0.18  0.35 -0.31 -0.04 0.73 0.266 2.1
## alb -0.64 -0.30 -0.32 -0.38  0.09 0.76 0.244 2.7
## ta   0.91  0.23 -0.13  0.12  0.07 0.92 0.077 1.2
## tas  0.93  0.23 -0.09  0.12  0.07 0.94 0.058 1.2
## ts   0.93  0.22 -0.09  0.11  0.08 0.94 0.057 1.2
## ua  -0.26  0.39  0.06  0.10  0.71 0.74 0.264 1.9
## va   0.73  0.30 -0.06  0.02  0.19 0.66 0.344 1.5
## omg  0.27 -0.50  0.02  0.53 -0.20 0.64 0.359 2.8
## uas -0.74  0.09  0.05 -0.06  0.15 0.58 0.423 1.1
## vas -0.67  0.37 -0.03  0.03  0.13 0.60 0.403 1.7
## slp -0.89 -0.14  0.12  0.17 -0.22 0.91 0.086 1.3
## Qdv  0.01 -0.39  0.00  0.70  0.11 0.65 0.348 1.6
## shm  0.79  0.37 -0.19  0.08 -0.08 0.82 0.179 1.6
## clt -0.65  0.30  0.44 -0.06 -0.24 0.77 0.234 2.6
## pre  0.02  0.89  0.18  0.02 -0.21 0.86 0.137 1.2
## pme -0.78  0.38  0.15  0.05  0.19 0.81 0.190 1.7
## ro   0.10 -0.16  0.89 -0.04  0.21 0.88 0.118 1.2
## dS  -0.65  0.38 -0.55  0.07 -0.04 0.88 0.118 2.6
## snd -0.67 -0.28 -0.25 -0.41 -0.02 0.75 0.246 2.4
## 
##                         PC1  PC2  PC3  PC4  PC5
## SS loadings           12.18 2.85 1.76 1.40 1.09
## Proportion Var         0.51 0.12 0.07 0.06 0.05
## Cumulative Var         0.51 0.63 0.70 0.76 0.80
## Proportion Explained   0.63 0.15 0.09 0.07 0.06
## Cumulative Proportion  0.63 0.78 0.87 0.94 1.00
## 
## Mean item complexity =  1.7
## Test of the hypothesis that 5 components are sufficient.
## 
## The root mean square of the residuals (RMSR) is  0.05 
##  with the empirical chi square  231.12  with prob &lt;  0.00063 
## 
## Fit based upon off diagonal values = 0.99</code></pre>
</div>
<div id="qgraph-plot-of-the-principal-components" class="section level2"
number="3.4">
<h2><span class="header-section-number">3.4</span> qgraph plot of the
principal components</h2>
<p>The first plot below shows the components as square nodes, and the
orignal variables as circular nodes. The second modifies that first plot
by applying the “spring” layout.</p>
<div class="sourceCode" id="cb30"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" tabindex="-1"></a>qg_pca <span class="ot">&lt;-</span> <span class="fu">qgraph</span>(<span class="fu">loadings</span>(mm_pca_unrot), </span>
<span id="cb30-2"><a href="#cb30-2" tabindex="-1"></a>  <span class="at">posCol =</span> <span class="st">&quot;darkgreen&quot;</span>, <span class="at">negCol =</span> <span class="st">&quot;darkmagenta&quot;</span>, <span class="at">arrows =</span> <span class="cn">FALSE</span>, </span>
<span id="cb30-3"><a href="#cb30-3" tabindex="-1"></a>  <span class="at">labels=</span><span class="fu">c</span>(<span class="fu">names</span>(mm_data),<span class="fu">as.character</span>(<span class="fu">seq</span>(<span class="dv">1</span><span class="sc">:</span>nfactors))), <span class="at">vTrans=</span><span class="dv">128</span>)</span></code></pre></div>
<p><img src="pca_files/figure-html/pca-16-1.png" width="75%" height="75%" /></p>
<div class="sourceCode" id="cb31"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" tabindex="-1"></a><span class="fu">qgraph</span>(qg_pca, <span class="at">title=</span><span class="st">&quot;Component loadings, all models over all months&quot;</span>,</span>
<span id="cb31-2"><a href="#cb31-2" tabindex="-1"></a>  <span class="at">layout =</span> <span class="st">&quot;spring&quot;</span>, </span>
<span id="cb31-3"><a href="#cb31-3" tabindex="-1"></a>  <span class="at">posCol =</span> <span class="st">&quot;darkgreen&quot;</span>, <span class="at">negCol =</span> <span class="st">&quot;darkmagenta&quot;</span>, <span class="at">arrows =</span> <span class="cn">FALSE</span>,</span>
<span id="cb31-4"><a href="#cb31-4" tabindex="-1"></a>  <span class="at">node.height=</span><span class="fl">0.5</span>, <span class="at">node.width=</span><span class="fl">0.5</span>, <span class="at">vTrans=</span><span class="dv">128</span>, <span class="at">edge.width=</span><span class="fl">0.75</span>, <span class="at">label.cex=</span><span class="fl">1.0</span>,</span>
<span id="cb31-5"><a href="#cb31-5" tabindex="-1"></a>  <span class="at">width=</span><span class="dv">7</span>, <span class="at">height=</span><span class="dv">5</span>, <span class="at">normalize=</span><span class="cn">TRUE</span>, <span class="at">edge.width=</span><span class="fl">0.75</span> )</span></code></pre></div>
<p><img src="pca_files/figure-html/pca-16-2.png" width="75%" height="75%" /></p>
</div>
<div id="rotated-components" class="section level2" number="3.5">
<h2><span class="header-section-number">3.5</span> Rotated
components</h2>
<p>The interpretability of the componets can often be improved by
“rotation” of the components, which amounts to slightly moving the PCA
axes relative to the original variable axes, while still maintaining the
orthogonality (or “uncorrelatedness”) of the components. This has the
effect of reducing the importance of the first component(s) (because the
adjusted axes are no longer optimal), but this trade-off is usually
worth it.</p>
<p>Here are the results:</p>
<div class="sourceCode" id="cb32"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" tabindex="-1"></a>nfactors <span class="ot">&lt;-</span> <span class="dv">4</span></span>
<span id="cb32-2"><a href="#cb32-2" tabindex="-1"></a>mm_pca_rot <span class="ot">&lt;-</span> <span class="fu">principal</span>(mm_data, <span class="at">nfactors =</span> nfactors, <span class="at">rotate =</span> <span class="st">&quot;varimax&quot;</span>)</span>
<span id="cb32-3"><a href="#cb32-3" tabindex="-1"></a>mm_pca_rot</span></code></pre></div>
<pre><code>## Principal Components Analysis
## Call: principal(r = mm_data, nfactors = nfactors, rotate = &quot;varimax&quot;)
## Standardized loadings (pattern matrix) based upon correlation matrix
##       RC1   RC2   RC3   RC4   h2    u2 com
## Kn   0.67 -0.67  0.22  0.10 0.95 0.048 2.2
## Ln  -0.42  0.78 -0.04  0.09 0.80 0.201 1.6
## Qn   0.71 -0.58  0.26  0.15 0.94 0.062 2.3
## Qe   0.78 -0.08  0.07  0.19 0.66 0.344 1.2
## Qh   0.59 -0.72  0.15  0.06 0.90 0.100 2.1
## Qg   0.38 -0.54  0.51  0.18 0.73 0.268 3.0
## alb -0.75 -0.05 -0.33  0.25 0.75 0.253 1.6
## ta   0.89 -0.35 -0.02 -0.05 0.92 0.082 1.3
## tas  0.90 -0.35  0.02 -0.04 0.94 0.063 1.3
## ts   0.90 -0.37  0.03 -0.04 0.94 0.062 1.3
## ua   0.02  0.47 -0.05  0.08 0.23 0.767 1.1
## va   0.75 -0.21  0.02  0.08 0.62 0.380 1.2
## omg  0.06 -0.33  0.09 -0.69 0.60 0.401 1.5
## uas -0.56  0.47 -0.08  0.11 0.56 0.445 2.1
## vas -0.32  0.64 -0.20  0.14 0.58 0.421 1.8
## slp -0.76  0.49 -0.03 -0.19 0.86 0.136 1.9
## Qdv -0.06 -0.05 -0.01 -0.80 0.64 0.360 1.0
## shm  0.87 -0.21 -0.12  0.05 0.81 0.186 1.2
## clt -0.38  0.67  0.28  0.19 0.71 0.293 2.2
## pre  0.50  0.67  0.04  0.34 0.82 0.182 2.4
## pme -0.41  0.77 -0.05  0.13 0.77 0.226 1.6
## ro  -0.05  0.03  0.91 -0.05 0.84 0.164 1.0
## dS  -0.28  0.53 -0.71  0.13 0.88 0.120 2.3
## snd -0.77 -0.01 -0.28  0.29 0.75 0.247 1.6
## 
##                        RC1  RC2  RC3  RC4
## SS loadings           8.79 5.66 2.08 1.65
## Proportion Var        0.37 0.24 0.09 0.07
## Cumulative Var        0.37 0.60 0.69 0.76
## Proportion Explained  0.48 0.31 0.11 0.09
## Cumulative Proportion 0.48 0.79 0.91 1.00
## 
## Mean item complexity =  1.7
## Test of the hypothesis that 4 components are sufficient.
## 
## The root mean square of the residuals (RMSR) is  0.06 
##  with the empirical chi square  290.26  with prob &lt;  1.5e-06 
## 
## Fit based upon off diagonal values = 0.99</code></pre>
<div class="sourceCode" id="cb34"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" tabindex="-1"></a>qg_pca <span class="ot">&lt;-</span> <span class="fu">qgraph</span>(<span class="fu">loadings</span>(mm_pca_rot), </span>
<span id="cb34-2"><a href="#cb34-2" tabindex="-1"></a>  <span class="at">posCol =</span> <span class="st">&quot;darkgreen&quot;</span>, <span class="at">negCol =</span> <span class="st">&quot;darkmagenta&quot;</span>, <span class="at">arrows =</span> <span class="cn">FALSE</span>, </span>
<span id="cb34-3"><a href="#cb34-3" tabindex="-1"></a>  <span class="at">labels=</span><span class="fu">c</span>(<span class="fu">names</span>(mm_data),<span class="fu">as.character</span>(<span class="fu">seq</span>(<span class="dv">1</span><span class="sc">:</span>nfactors))), <span class="at">vTrans=</span><span class="dv">128</span>) </span></code></pre></div>
<pre><code>## Warning in Glabels[1:n] &lt;- labels: number of items to replace is not a multiple of replacement length</code></pre>
<p><img src="pca_files/figure-html/pca-17-1.png" width="75%" height="75%" /></p>
<div class="sourceCode" id="cb36"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" tabindex="-1"></a><span class="fu">qgraph</span>(qg_pca, <span class="at">title=</span><span class="st">&quot;Rotated component loadings, all models over all months&quot;</span>,</span>
<span id="cb36-2"><a href="#cb36-2" tabindex="-1"></a>  <span class="at">layout =</span> <span class="st">&quot;spring&quot;</span>, <span class="at">arrows =</span> <span class="cn">FALSE</span>, </span>
<span id="cb36-3"><a href="#cb36-3" tabindex="-1"></a>  <span class="at">posCol =</span> <span class="st">&quot;darkgreen&quot;</span>, <span class="at">negCol =</span> <span class="st">&quot;darkmagenta&quot;</span>, </span>
<span id="cb36-4"><a href="#cb36-4" tabindex="-1"></a>  <span class="at">width=</span><span class="dv">7</span>, <span class="at">height=</span><span class="dv">5</span>, <span class="at">normalize=</span><span class="cn">TRUE</span>, <span class="at">edge.width=</span><span class="fl">0.75</span>) </span></code></pre></div>
<p><img src="pca_files/figure-html/pca-17-2.png" width="75%" height="75%" /></p>
<p><a href="pca.html">[Back to top]</a></p>
</div>
</div>
<div id="pca-of-high-dimensional-data" class="section level1"
number="4">
<h1><span class="header-section-number">4</span> PCA of high-dimensional
data</h1>
<p>This example illustrates the application of principal components
analysis (also known as EOF, emperical orthogonal functions in
meteorology, or “eigenvector analysis”) to a data set that consists of
16,380 variables (grid points) and 1680 observations (times) from a data
set called the 20th Century Reanalysis V. 2. <a
href="http://www.esrl.noaa.gov/psd/data/gridded/data.20thC_ReanV2.html">[http://www.esrl.noaa.gov/psd/data/gridded/data.20thC_ReanV2.html]</a>.</p>
<p>The paticular data set used here consists of anomalies (difference
from the long-term means) of 500mb hieghts, which describe upper level
circulation patterns, over the interval 1871-2010, and monthly time
steps. The objective is to describe the basic anomaly patterns that
occur in the data, and to look at their variation over time (and because
climate is changing, there are likely to be long-term trends in the
importance of these patterns.) The data are available in netCDF files,
and so this analysis also describes how to read and write netCDF data
sets (or *.nc files). This data set is not particularly huge, but is
large enough to illustrate the general idea, which basically involves
using the singular-value decomposition approach.</p>
<div id="read-the-netcdf-file-of-20th-century-reanalysis-data"
class="section level2" number="4.1">
<h2><span class="header-section-number">4.1</span> Read the netCDF file
of 20th Century Reanalysis Data</h2>
<div class="sourceCode" id="cb37"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" tabindex="-1"></a><span class="co"># load some libraries</span></span>
<span id="cb37-2"><a href="#cb37-2" tabindex="-1"></a><span class="fu">library</span>(ncdf4)</span>
<span id="cb37-3"><a href="#cb37-3" tabindex="-1"></a><span class="fu">library</span>(RColorBrewer)</span></code></pre></div>
<div class="sourceCode" id="cb38"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" tabindex="-1"></a><span class="co"># Read the data</span></span>
<span id="cb38-2"><a href="#cb38-2" tabindex="-1"></a>ncpath <span class="ot">&lt;-</span> <span class="st">&quot;/Users/bartlein/Projects/RESS/data/nc_files/&quot;</span></span>
<span id="cb38-3"><a href="#cb38-3" tabindex="-1"></a>ncname <span class="ot">&lt;-</span> <span class="st">&quot;R20C2_anm19812010_1871-2010_gcm_hgt500.nc&quot;</span> </span>
<span id="cb38-4"><a href="#cb38-4" tabindex="-1"></a>ncfname <span class="ot">&lt;-</span> <span class="fu">paste</span>(ncpath, ncname, <span class="at">sep=</span><span class="st">&quot;&quot;</span>)</span>
<span id="cb38-5"><a href="#cb38-5" tabindex="-1"></a>dname <span class="ot">&lt;-</span> <span class="st">&quot;hgt_anm&quot;</span></span></code></pre></div>
<p>Open the netCDF file. Printing the file object (<code>ncin</code>)
produces output similar to that of <code>ncdump</code>:</p>
<div class="sourceCode" id="cb39"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" tabindex="-1"></a><span class="co"># open a netCDF file</span></span>
<span id="cb39-2"><a href="#cb39-2" tabindex="-1"></a>ncin <span class="ot">&lt;-</span> <span class="fu">nc_open</span>(ncfname)</span>
<span id="cb39-3"><a href="#cb39-3" tabindex="-1"></a><span class="fu">print</span>(ncin)</span></code></pre></div>
<pre><code>## File /Users/bartlein/Projects/RESS/data/nc_files/R20C2_anm19812010_1871-2010_gcm_hgt500.nc (NC_FORMAT_CLASSIC):
## 
##      1 variables (excluding dimension variables):
##         float hgt_anm[lon,lat,time]   
##             name: hgt_anm
##             long_name: 500mb heights
##             units: m
##             _FillValue: -32767
## 
##      3 dimensions:
##         lon  Size:180 
##             name: lon
##             long_name: Longitude
##             units: degrees_east
##             axis: X
##             standard_name: longitude
##             coodinate_defines: point
##         lat  Size:91 
##             name: lat
##             long_name: Latitude
##             units: degrees_north
##             axis: Y
##             standard_name: latitude
##             coodinate_defines: point
##         time  Size:1680 
##             standard_name: time
##             long_name: time
##             units: hours since 1800-01-01 00:00:00
##             axis: T
##             calendar: standard
## 
##     8 global attributes:
##         title: 20th Century Renalysis v. 2 -- Monthly Averages 1871-2008
##         creator: Bartlein
##         institution: http://geography.uoregon.edu/envchange/, using data from NOAA/OAR/ESRL PSD
##         source: f:\Data\20thC_Rean_V2\hgt500.mon.mean.nc
##         history: R20C2_anomalies.f90  2012-02-25 11:24:56
##         Conventions: CF-1.4
##         references: http://www.esrl.noaa.gov/psd/data/gridded/data.20thCentReanalysis.html
##         comment: 1871-2010 anomalies relative to 1981-2010 ltm on native GCM grid</code></pre>
<p>Get the latitudes and longitudes (dimensions):</p>
<div class="sourceCode" id="cb41"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" tabindex="-1"></a><span class="co"># lons and lats</span></span>
<span id="cb41-2"><a href="#cb41-2" tabindex="-1"></a>lon <span class="ot">&lt;-</span> <span class="fu">ncvar_get</span>(ncin, <span class="st">&quot;lon&quot;</span>)</span>
<span id="cb41-3"><a href="#cb41-3" tabindex="-1"></a>nlon <span class="ot">&lt;-</span> <span class="fu">dim</span>(lon)</span>
<span id="cb41-4"><a href="#cb41-4" tabindex="-1"></a><span class="fu">head</span>(lon)</span></code></pre></div>
<pre><code>## [1] -180 -178 -176 -174 -172 -170</code></pre>
<div class="sourceCode" id="cb43"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" tabindex="-1"></a>lat <span class="ot">&lt;-</span> <span class="fu">ncvar_get</span>(ncin, <span class="st">&quot;lat&quot;</span>, <span class="at">verbose =</span> F)</span>
<span id="cb43-2"><a href="#cb43-2" tabindex="-1"></a>nlat <span class="ot">&lt;-</span> <span class="fu">dim</span>(lat)</span>
<span id="cb43-3"><a href="#cb43-3" tabindex="-1"></a><span class="fu">head</span>(lat)</span></code></pre></div>
<pre><code>## [1] -90 -88 -86 -84 -82 -80</code></pre>
<p>Get the time variable, and the “CF” “time since” units attribute:</p>
<div class="sourceCode" id="cb45"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" tabindex="-1"></a><span class="co"># time variable</span></span>
<span id="cb45-2"><a href="#cb45-2" tabindex="-1"></a>t <span class="ot">&lt;-</span> <span class="fu">ncvar_get</span>(ncin, <span class="st">&quot;time&quot;</span>)</span>
<span id="cb45-3"><a href="#cb45-3" tabindex="-1"></a><span class="fu">head</span>(t); <span class="fu">tail</span>(t)</span></code></pre></div>
<pre><code>## [1] 622368 623112 623784 624528 625248 625992</code></pre>
<pre><code>## [1] 1845168 1845912 1846656 1847376 1848120 1848840</code></pre>
<div class="sourceCode" id="cb48"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" tabindex="-1"></a>tunits <span class="ot">&lt;-</span> <span class="fu">ncatt_get</span>(ncin, <span class="st">&quot;time&quot;</span>, <span class="st">&quot;units&quot;</span>)</span>
<span id="cb48-2"><a href="#cb48-2" tabindex="-1"></a>tunits<span class="sc">$</span>value</span></code></pre></div>
<pre><code>## [1] &quot;hours since 1800-01-01 00:00:00&quot;</code></pre>
<div class="sourceCode" id="cb50"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1" tabindex="-1"></a>nt <span class="ot">&lt;-</span> <span class="fu">dim</span>(t)</span>
<span id="cb50-2"><a href="#cb50-2" tabindex="-1"></a>nt</span></code></pre></div>
<pre><code>## [1] 1680</code></pre>
<p>Next, get the data (<code>hgt500_anm</code>), and the attributes like
the “long name”, units and fill values (missing data codes):</p>
<div class="sourceCode" id="cb52"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1" tabindex="-1"></a><span class="co"># get the data array</span></span>
<span id="cb52-2"><a href="#cb52-2" tabindex="-1"></a>var_array <span class="ot">&lt;-</span> <span class="fu">ncvar_get</span>(ncin, dname)</span>
<span id="cb52-3"><a href="#cb52-3" tabindex="-1"></a>dlname <span class="ot">&lt;-</span> <span class="fu">ncatt_get</span>(ncin, dname, <span class="st">&quot;long_name&quot;</span>)</span>
<span id="cb52-4"><a href="#cb52-4" tabindex="-1"></a>dunits <span class="ot">&lt;-</span> <span class="fu">ncatt_get</span>(ncin, dname, <span class="st">&quot;units&quot;</span>)</span>
<span id="cb52-5"><a href="#cb52-5" tabindex="-1"></a>fillvalue <span class="ot">&lt;-</span> <span class="fu">ncatt_get</span>(ncin, dname, <span class="st">&quot;_FillValue&quot;</span>)</span>
<span id="cb52-6"><a href="#cb52-6" tabindex="-1"></a><span class="fu">dim</span>(var_array)</span></code></pre></div>
<pre><code>## [1]  180   91 1680</code></pre>
<p>Then get the global attributes:</p>
<div class="sourceCode" id="cb54"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1" tabindex="-1"></a><span class="co"># global attributes</span></span>
<span id="cb54-2"><a href="#cb54-2" tabindex="-1"></a>title <span class="ot">&lt;-</span> <span class="fu">ncatt_get</span>(ncin, <span class="dv">0</span>, <span class="st">&quot;title&quot;</span>)</span>
<span id="cb54-3"><a href="#cb54-3" tabindex="-1"></a>institution <span class="ot">&lt;-</span> <span class="fu">ncatt_get</span>(ncin, <span class="dv">0</span>, <span class="st">&quot;institution&quot;</span>)</span>
<span id="cb54-4"><a href="#cb54-4" tabindex="-1"></a>datasource <span class="ot">&lt;-</span> <span class="fu">ncatt_get</span>(ncin, <span class="dv">0</span>, <span class="st">&quot;source&quot;</span>)</span>
<span id="cb54-5"><a href="#cb54-5" tabindex="-1"></a>references <span class="ot">&lt;-</span> <span class="fu">ncatt_get</span>(ncin, <span class="dv">0</span>, <span class="st">&quot;references&quot;</span>)</span>
<span id="cb54-6"><a href="#cb54-6" tabindex="-1"></a>history <span class="ot">&lt;-</span> <span class="fu">ncatt_get</span>(ncin, <span class="dv">0</span>, <span class="st">&quot;history&quot;</span>)</span>
<span id="cb54-7"><a href="#cb54-7" tabindex="-1"></a>Conventions <span class="ot">&lt;-</span> <span class="fu">ncatt_get</span>(ncin, <span class="dv">0</span>, <span class="st">&quot;Conventions&quot;</span>)</span></code></pre></div>
<p>Finally, close the netCDF file:</p>
<div class="sourceCode" id="cb55"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb55-1"><a href="#cb55-1" tabindex="-1"></a><span class="fu">nc_close</span>(ncin)</span></code></pre></div>
</div>
<div id="set-up-for-the-analysis" class="section level2" number="4.2">
<h2><span class="header-section-number">4.2</span> Set-up for the
analysis</h2>
<p>Check that the data have been read correctly by displaying a map of
the first month of data. Grab a slice of the data, and plot it as an
<code>image()</code> plot. Get a world outline</p>
<div class="sourceCode" id="cb56"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb56-1"><a href="#cb56-1" tabindex="-1"></a><span class="co"># world_sf</span></span>
<span id="cb56-2"><a href="#cb56-2" tabindex="-1"></a><span class="fu">library</span>(sf)</span></code></pre></div>
<pre><code>## Linking to GEOS 3.11.0, GDAL 3.5.3, PROJ 9.1.0; sf_use_s2() is TRUE</code></pre>
<div class="sourceCode" id="cb58"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb58-1"><a href="#cb58-1" tabindex="-1"></a><span class="fu">library</span>(maps)</span>
<span id="cb58-2"><a href="#cb58-2" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span></code></pre></div>
<pre><code>## 
## Attaching package: &#39;ggplot2&#39;</code></pre>
<pre><code>## The following objects are masked from &#39;package:psych&#39;:
## 
##     %+%, alpha</code></pre>
<div class="sourceCode" id="cb61"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb61-1"><a href="#cb61-1" tabindex="-1"></a>world_sf <span class="ot">&lt;-</span> <span class="fu">st_as_sf</span>(maps<span class="sc">::</span><span class="fu">map</span>(<span class="st">&quot;world&quot;</span>, <span class="at">plot =</span> <span class="cn">FALSE</span>, <span class="at">fill =</span> <span class="cn">TRUE</span>))</span>
<span id="cb61-2"><a href="#cb61-2" tabindex="-1"></a>world_otl_sf <span class="ot">&lt;-</span> <span class="fu">st_geometry</span>(world_sf)</span>
<span id="cb61-3"><a href="#cb61-3" tabindex="-1"></a><span class="fu">plot</span>(world_otl_sf)</span></code></pre></div>
<p><img src="pca_files/figure-html/pca-26-1.png" width="75%" height="75%" /></p>
<div class="sourceCode" id="cb62"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb62-1"><a href="#cb62-1" tabindex="-1"></a><span class="co"># select the first month of data, and make a data freame</span></span>
<span id="cb62-2"><a href="#cb62-2" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb62-3"><a href="#cb62-3" tabindex="-1"></a>map_df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="fu">expand.grid</span>(lon, lat), <span class="fu">as.vector</span>(var_array[, , n]))</span>
<span id="cb62-4"><a href="#cb62-4" tabindex="-1"></a><span class="fu">names</span>(map_df) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;lon&quot;</span>, <span class="st">&quot;lat&quot;</span>, <span class="st">&quot;hgt500_anm&quot;</span>)</span>
<span id="cb62-5"><a href="#cb62-5" tabindex="-1"></a><span class="fu">head</span>(map_df)</span></code></pre></div>
<pre><code>##    lon lat hgt500_anm
## 1 -180 -90   -12.2334
## 2 -178 -90   -12.2334
## 3 -176 -90   -12.2334
## 4 -174 -90   -12.2334
## 5 -172 -90   -12.2334
## 6 -170 -90   -12.2334</code></pre>
<div class="sourceCode" id="cb64"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb64-1"><a href="#cb64-1" tabindex="-1"></a><span class="co"># plot the first month</span></span>
<span id="cb64-2"><a href="#cb64-2" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb64-3"><a href="#cb64-3" tabindex="-1"></a>  <span class="fu">geom_tile</span>(<span class="at">data =</span> map_df, <span class="fu">aes</span>(<span class="at">x =</span> lon, <span class="at">y =</span> lat, <span class="at">fill =</span> hgt500_anm)) <span class="sc">+</span></span>
<span id="cb64-4"><a href="#cb64-4" tabindex="-1"></a>  <span class="fu">scale_fill_gradient2</span>(<span class="at">low =</span> <span class="st">&quot;darkblue&quot;</span>, <span class="at">mid=</span><span class="st">&quot;white&quot;</span>, <span class="at">high =</span> <span class="st">&quot;darkorange&quot;</span>, <span class="at">midpoint =</span> <span class="fl">0.0</span>) <span class="sc">+</span></span>
<span id="cb64-5"><a href="#cb64-5" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> world_otl_sf, <span class="at">col =</span> <span class="st">&quot;black&quot;</span>, <span class="at">fill =</span> <span class="cn">NA</span>) <span class="sc">+</span></span>
<span id="cb64-6"><a href="#cb64-6" tabindex="-1"></a>  <span class="fu">coord_sf</span>(<span class="at">xlim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">180</span>, <span class="sc">+</span><span class="dv">180</span>), <span class="at">ylim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">90</span>, <span class="dv">90</span>), <span class="at">expand =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb64-7"><a href="#cb64-7" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">breaks =</span> <span class="fu">seq</span>(<span class="sc">-</span><span class="dv">180</span>, <span class="dv">180</span>, <span class="at">by =</span> <span class="dv">60</span>)) <span class="sc">+</span></span>
<span id="cb64-8"><a href="#cb64-8" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">breaks =</span> <span class="fu">seq</span>(<span class="sc">-</span><span class="dv">90</span>, <span class="dv">90</span>, <span class="at">by =</span> <span class="dv">30</span>)) <span class="sc">+</span></span>
<span id="cb64-9"><a href="#cb64-9" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;Longitude&quot;</span>, <span class="at">y =</span> <span class="st">&quot;Latitude&quot;</span>, <span class="at">title=</span><span class="st">&quot;20th Century Reanalysis 500 hPa Height Anomalies&quot;</span>, <span class="at">fill=</span><span class="st">&quot;hgt500&quot;</span>) <span class="sc">+</span></span>
<span id="cb64-10"><a href="#cb64-10" tabindex="-1"></a>  <span class="fu">theme_bw</span>()</span></code></pre></div>
<p><img src="pca_files/figure-html/pca-28-1.png" width="75%" height="75%" /></p>
<p>The map looks similar to a map of the first month’s data using
Panoply. (The artifact at 0<sup>o</sup> E is due to rotation of the
original data from 0 to 360 degrees to -180 to +180 degrees.)</p>
<p>If desired, the analysis could be confined to the Northern Hemisphere
by executing the following code (although this is not done here).</p>
<div class="sourceCode" id="cb65"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb65-1"><a href="#cb65-1" tabindex="-1"></a><span class="co"># (not run) trim data to N.H.</span></span>
<span id="cb65-2"><a href="#cb65-2" tabindex="-1"></a>lat <span class="ot">&lt;-</span> lat[<span class="dv">47</span><span class="sc">:</span><span class="dv">91</span>]</span>
<span id="cb65-3"><a href="#cb65-3" tabindex="-1"></a>nlat <span class="ot">&lt;-</span> <span class="fu">dim</span>(lat)</span>
<span id="cb65-4"><a href="#cb65-4" tabindex="-1"></a><span class="fu">min</span>(lat); <span class="fu">max</span>(lat)</span>
<span id="cb65-5"><a href="#cb65-5" tabindex="-1"></a>var_array <span class="ot">&lt;-</span> var_array[,<span class="dv">47</span><span class="sc">:</span><span class="dv">91</span>,]</span></code></pre></div>
<div id="reshape-the-array" class="section level3" number="4.2.1">
<h3><span class="header-section-number">4.2.1</span> Reshape the
array</h3>
<p>The netCDF variable <code>hgt500_anm</code> is read in as a
3-dimensional array (<code>nlon</code> x <code>nlat</code> x
<code>nt</code>), but for the PCA, it needs to be in the standard form
of a data frame, with each column representing a variable (or grid point
in this case) and each row representing an observation (or time). The
reshaping can be done by first flatting the 3-d array into a long vector
of values, and then converting that to a 2-d array with
<code>nlon</code> x <code>nlat</code> columns, and `nt’ rows.</p>
<div class="sourceCode" id="cb66"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb66-1"><a href="#cb66-1" tabindex="-1"></a><span class="co"># reshape the 3-d array</span></span>
<span id="cb66-2"><a href="#cb66-2" tabindex="-1"></a>var_vec_long <span class="ot">&lt;-</span> <span class="fu">as.vector</span>(var_array)</span>
<span id="cb66-3"><a href="#cb66-3" tabindex="-1"></a><span class="fu">length</span>(var_vec_long)</span></code></pre></div>
<pre><code>## [1] 27518400</code></pre>
<div class="sourceCode" id="cb68"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb68-1"><a href="#cb68-1" tabindex="-1"></a>var_matrix <span class="ot">&lt;-</span> <span class="fu">matrix</span>(var_vec_long, <span class="at">nrow =</span> nlon <span class="sc">*</span> nlat, <span class="at">ncol =</span> nt)</span>
<span id="cb68-2"><a href="#cb68-2" tabindex="-1"></a><span class="fu">dim</span>(var_matrix)</span></code></pre></div>
<pre><code>## [1] 16380  1680</code></pre>
<div class="sourceCode" id="cb70"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb70-1"><a href="#cb70-1" tabindex="-1"></a>var_matrix <span class="ot">&lt;-</span> <span class="fu">t</span>(var_matrix)</span>
<span id="cb70-2"><a href="#cb70-2" tabindex="-1"></a><span class="fu">dim</span>(var_matrix)</span></code></pre></div>
<pre><code>## [1]  1680 16380</code></pre>
<p>Note that this approach will only work if the netCDF file is
configured in the standard “CF Conventions” way, i.e. as a
<code>nlon</code> x <code>nlat</code> x <code>nt</code> array.</p>
<p><a href="pca.html">[Back to top]</a></p>
</div>
</div>
</div>
<div id="pca-using-the-pcamethods-package" class="section level1"
number="5">
<h1><span class="header-section-number">5</span> PCA using the
pcaMethods package</h1>
<p>The <code>pcaMethods</code> package from the Bioconductor repository
is a very flexible set of routines for doing PCA. Here the “singular
value decomposition” (SVD) approach will be used, because it can handle
cases where there are more variables than observations. The
<code>pcaMethods</code> package is described at:</p>
<ul>
<li><a
href="http://bioconductor.org/packages/release/bioc/html/pcaMethods.html">[http://bioconductor.org/packages/release/bioc/html/pcaMethods.html]</a></li>
</ul>
<p>To install the <code>pcaMethods</code> package, first install the
core Bioconductor packages, and then use the <code>biocLite()</code>
function to install <code>pcaMethods</code>. See the following link:</p>
<ul>
<li><a
href="http://bioconductor.org/install/#install-bioconductor-packages">[http://bioconductor.org/install/#install-bioconductor-packages]</a></li>
</ul>
<p>In this example, the first eight components are extracted from the
correlation matrix. Note that the analysis will take a few minutes.</p>
<div class="sourceCode" id="cb72"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb72-1"><a href="#cb72-1" tabindex="-1"></a><span class="co"># PCA using pcaMethods</span></span>
<span id="cb72-2"><a href="#cb72-2" tabindex="-1"></a><span class="fu">library</span>(pcaMethods)</span>
<span id="cb72-3"><a href="#cb72-3" tabindex="-1"></a>pcamethod<span class="ot">=</span><span class="st">&quot;svd&quot;</span></span>
<span id="cb72-4"><a href="#cb72-4" tabindex="-1"></a>ncomp <span class="ot">&lt;-</span> <span class="dv">8</span></span>
<span id="cb72-5"><a href="#cb72-5" tabindex="-1"></a>zd <span class="ot">&lt;-</span> <span class="fu">prep</span>(var_matrix, <span class="at">scale=</span><span class="st">&quot;uv&quot;</span>, <span class="at">center=</span><span class="cn">TRUE</span>)</span>
<span id="cb72-6"><a href="#cb72-6" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1</span>)</span>
<span id="cb72-7"><a href="#cb72-7" tabindex="-1"></a>ptm <span class="ot">&lt;-</span> <span class="fu">proc.time</span>() <span class="co"># time the analysis</span></span>
<span id="cb72-8"><a href="#cb72-8" tabindex="-1"></a>resPCA <span class="ot">&lt;-</span> <span class="fu">pca</span>(zd, <span class="at">method=</span>pcamethod, <span class="at">scale=</span><span class="st">&quot;uv&quot;</span>, <span class="at">center=</span><span class="cn">TRUE</span>, <span class="at">nPcs=</span>ncomp)</span>
<span id="cb72-9"><a href="#cb72-9" tabindex="-1"></a><span class="fu">proc.time</span>() <span class="sc">-</span> ptm <span class="co"># how long?</span></span></code></pre></div>
<pre><code>##    user  system elapsed 
## 150.627   1.099 152.188</code></pre>
<div id="results" class="section level2" number="5.1">
<h2><span class="header-section-number">5.1</span> Results</h2>
<p>Printing out the “results” object (<code>resPCA</code>) provides a
summary of the analysis, and the loadings and scores are extracted from
the results object.</p>
<div class="sourceCode" id="cb74"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb74-1"><a href="#cb74-1" tabindex="-1"></a><span class="co"># print a summary of the results</span></span>
<span id="cb74-2"><a href="#cb74-2" tabindex="-1"></a>resPCA</span></code></pre></div>
<pre><code>## svd calculated PCA
## Importance of component(s):
##                  PC1    PC2     PC3     PC4     PC5     PC6     PC7     PC8
## R2            0.2306 0.1106 0.07076 0.03219 0.03191 0.02925 0.02591 0.02441
## Cumulative R2 0.2306 0.3412 0.41193 0.44412 0.47603 0.50528 0.53119 0.55560
## 16380    Variables
## 1680     Samples
## 0    NAs ( 0 %)
## 8    Calculated component(s)
## Data was mean centered before running PCA 
## Data was scaled before running PCA 
## Scores structure:
## [1] 1680    8
## Loadings structure:
## [1] 16380     8</code></pre>
<div class="sourceCode" id="cb76"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb76-1"><a href="#cb76-1" tabindex="-1"></a><span class="co"># extract loadings and scores</span></span>
<span id="cb76-2"><a href="#cb76-2" tabindex="-1"></a>loadpca <span class="ot">&lt;-</span> <span class="fu">loadings</span>(resPCA)</span>
<span id="cb76-3"><a href="#cb76-3" tabindex="-1"></a>scores <span class="ot">&lt;-</span> <span class="fu">scores</span>(resPCA)<span class="sc">/</span><span class="fu">rep</span>(resPCA<span class="sc">@</span>sDev, <span class="at">each=</span><span class="fu">nrow</span>(<span class="fu">scores</span>(resPCA)))</span></code></pre></div>
<p>A quick look at the results can be gotten by mapping the loadings of
the first component and plotting the time series of the component
scores</p>
<div class="sourceCode" id="cb77"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb77-1"><a href="#cb77-1" tabindex="-1"></a><span class="co"># select the first month of data, and make a data freame</span></span>
<span id="cb77-2"><a href="#cb77-2" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb77-3"><a href="#cb77-3" tabindex="-1"></a>comp_df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="fu">expand.grid</span>(lon, lat), <span class="fu">as.vector</span>(loadpca[, n]))</span>
<span id="cb77-4"><a href="#cb77-4" tabindex="-1"></a><span class="fu">names</span>(comp_df) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;lon&quot;</span>, <span class="st">&quot;lat&quot;</span>, <span class="st">&quot;comp1&quot;</span>)</span>
<span id="cb77-5"><a href="#cb77-5" tabindex="-1"></a><span class="fu">head</span>(comp_df)</span></code></pre></div>
<pre><code>##    lon lat         comp1
## 1 -180 -90 -0.0005038535
## 2 -178 -90 -0.0005038535
## 3 -176 -90 -0.0005038535
## 4 -174 -90 -0.0005038535
## 5 -172 -90 -0.0005038535
## 6 -170 -90 -0.0005038535</code></pre>
<div class="sourceCode" id="cb79"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb79-1"><a href="#cb79-1" tabindex="-1"></a><span class="co"># map the component loadings</span></span>
<span id="cb79-2"><a href="#cb79-2" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb79-3"><a href="#cb79-3" tabindex="-1"></a>  <span class="fu">geom_tile</span>(<span class="at">data =</span> comp_df, <span class="fu">aes</span>(<span class="at">x =</span> lon, <span class="at">y =</span> lat, <span class="at">fill =</span> comp1)) <span class="sc">+</span></span>
<span id="cb79-4"><a href="#cb79-4" tabindex="-1"></a>  <span class="fu">scale_fill_gradient2</span>(<span class="at">low =</span> <span class="st">&quot;darkblue&quot;</span>, <span class="at">mid=</span><span class="st">&quot;white&quot;</span>, <span class="at">high =</span> <span class="st">&quot;darkorange&quot;</span>, <span class="at">midpoint =</span> <span class="fl">0.0</span>, </span>
<span id="cb79-5"><a href="#cb79-5" tabindex="-1"></a>                       <span class="at">limits =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="fl">0.02</span>, <span class="fl">0.02</span>)) <span class="sc">+</span></span>
<span id="cb79-6"><a href="#cb79-6" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> world_otl_sf, <span class="at">col =</span> <span class="st">&quot;black&quot;</span>, <span class="at">fill =</span> <span class="cn">NA</span>) <span class="sc">+</span></span>
<span id="cb79-7"><a href="#cb79-7" tabindex="-1"></a>  <span class="fu">coord_sf</span>(<span class="at">xlim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">180</span>, <span class="sc">+</span><span class="dv">180</span>), <span class="at">ylim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">90</span>, <span class="dv">90</span>), <span class="at">expand =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb79-8"><a href="#cb79-8" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">breaks =</span> <span class="fu">seq</span>(<span class="sc">-</span><span class="dv">180</span>, <span class="dv">180</span>, <span class="at">by =</span> <span class="dv">60</span>)) <span class="sc">+</span></span>
<span id="cb79-9"><a href="#cb79-9" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">breaks =</span> <span class="fu">seq</span>(<span class="sc">-</span><span class="dv">90</span>, <span class="dv">90</span>, <span class="at">by =</span> <span class="dv">30</span>)) <span class="sc">+</span></span>
<span id="cb79-10"><a href="#cb79-10" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;Longitude&quot;</span>, <span class="at">y =</span> <span class="st">&quot;Latitude&quot;</span>, <span class="at">title=</span><span class="st">&quot;20th CRA 500 hPa Height Anomalies PCA Loadings&quot;</span>, <span class="at">fill=</span><span class="st">&quot; &quot;</span>) <span class="sc">+</span></span>
<span id="cb79-11"><a href="#cb79-11" tabindex="-1"></a>  <span class="fu">theme_bw</span>()</span></code></pre></div>
<p><img src="pca_files/figure-html/pca-35-1.png" width="75%" height="75%" /></p>
<p>Recall that the loadings are the correlations between the time series
of 500mb heights at each grid point and the time series of the (first,
in this case) component and they describe the map pattern of the first
component, and the scores illustrate the importance of the anomaly map
pattern represented by the first component as it varies over time:</p>
<div class="sourceCode" id="cb80"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb80-1"><a href="#cb80-1" tabindex="-1"></a><span class="co"># timeseries plot of scores</span></span>
<span id="cb80-2"><a href="#cb80-2" tabindex="-1"></a>yrmn <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="fl">1871.0</span>, <span class="fl">2011.0</span><span class="sc">-</span>(<span class="fl">1.0</span><span class="sc">/</span><span class="fl">12.0</span>), <span class="at">by=</span><span class="fl">1.0</span><span class="sc">/</span><span class="fl">12.0</span>)</span>
<span id="cb80-3"><a href="#cb80-3" tabindex="-1"></a><span class="fu">plot</span>(yrmn, scores[,<span class="dv">1</span>], <span class="at">type=</span><span class="st">&quot;l&quot;</span>)</span></code></pre></div>
<p><img src="pca_files/figure-html/pca-36-1.png" width="75%" height="75%" /></p>
<p>The first six components account for half of the variance of the
original 16,380 variables, which is a pretty efficient reduction in
dimensionality. The map pattern of the first component is positive in
the tropics (and is more-or-less positive everywhere), and the time
series of scores shows that it is increasing over time. This pattern and
time series is consitent with global warming over the last century.</p>
</div>
</div>
<div id="write-out-the-results" class="section level1" number="6">
<h1><span class="header-section-number">6</span> Write out the
results</h1>
<div id="component-scores" class="section level2" number="6.1">
<h2><span class="header-section-number">6.1</span> Component scores</h2>
<p>Write out the component scores and statistics (to the working
directory):</p>
<div class="sourceCode" id="cb81"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb81-1"><a href="#cb81-1" tabindex="-1"></a><span class="co"># write scores</span></span>
<span id="cb81-2"><a href="#cb81-2" tabindex="-1"></a>scoresout <span class="ot">&lt;-</span> <span class="fu">cbind</span>(yrmn,scores)</span>
<span id="cb81-3"><a href="#cb81-3" tabindex="-1"></a>scoresfile <span class="ot">&lt;-</span> <span class="st">&quot;hgt500_scores.csv&quot;</span></span>
<span id="cb81-4"><a href="#cb81-4" tabindex="-1"></a><span class="fu">write.table</span>(scoresout, <span class="at">file=</span>scoresfile, <span class="at">row.names=</span><span class="cn">FALSE</span>, <span class="at">col.names=</span><span class="cn">TRUE</span>, <span class="at">sep=</span><span class="st">&quot;,&quot;</span>)</span></code></pre></div>
<div class="sourceCode" id="cb82"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb82-1"><a href="#cb82-1" tabindex="-1"></a><span class="co"># write statistics</span></span>
<span id="cb82-2"><a href="#cb82-2" tabindex="-1"></a>ncompchar <span class="ot">&lt;-</span> <span class="fu">paste</span> (<span class="st">&quot;0&quot;</span>, <span class="fu">as.character</span>(ncomp), <span class="at">sep=</span><span class="st">&quot;&quot;</span>)</span>
<span id="cb82-3"><a href="#cb82-3" tabindex="-1"></a><span class="cf">if</span> (ncomp <span class="sc">&gt;=</span> <span class="dv">10</span>) ncompchar <span class="ot">&lt;-</span> <span class="fu">as.character</span>(ncomp)</span>
<span id="cb82-4"><a href="#cb82-4" tabindex="-1"></a>statsout <span class="ot">&lt;-</span> <span class="fu">cbind</span>(<span class="dv">1</span><span class="sc">:</span>resPCA<span class="sc">@</span>nPcs,resPCA<span class="sc">@</span>sDev,resPCA<span class="sc">@</span>R2,resPCA<span class="sc">@</span>R2cum)</span>
<span id="cb82-5"><a href="#cb82-5" tabindex="-1"></a><span class="fu">colnames</span>(statsout) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;PC&quot;</span>, <span class="st">&quot;sDev&quot;</span>, <span class="st">&quot;R2&quot;</span>, <span class="st">&quot;R2cum&quot;</span>)</span>
<span id="cb82-6"><a href="#cb82-6" tabindex="-1"></a>statsfile <span class="ot">&lt;-</span> <span class="fu">paste</span>(<span class="st">&quot;hgt500&quot;</span>,pcamethod,<span class="st">&quot;_&quot;</span>,ncompchar,<span class="st">&quot;_stats.csv&quot;</span>,<span class="at">sep=</span><span class="st">&quot;&quot;</span>)</span>
<span id="cb82-7"><a href="#cb82-7" tabindex="-1"></a><span class="fu">write.table</span>(statsout, <span class="at">file=</span>statsfile, <span class="at">row.names=</span><span class="cn">FALSE</span>, <span class="at">col.names=</span><span class="cn">TRUE</span>, <span class="at">sep=</span><span class="st">&quot;,&quot;</span>)</span></code></pre></div>
</div>
<div id="write-out-a-netcdf-file-of-component-loadings"
class="section level2" number="6.2">
<h2><span class="header-section-number">6.2</span> Write out a netCDF
file of component loadings</h2>
<p>The loading matrix has <code>nlon</code> x <code>nlat</code> rows and
<code>ncomp</code> (eight in this case) columns, and needs to be
reshaped into an <code>nlon</code> x <code>nlat</code> x
<code>ncomp</code> array. Note that the reshaping is not automatic–it
happens that this works because the original data (from the input netCDF
file) was properly defined (as a <code>nlon</code> x <code>nlat</code> x
<code>nt</code> array).</p>
<div class="sourceCode" id="cb83"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb83-1"><a href="#cb83-1" tabindex="-1"></a><span class="co"># reshape loadings</span></span>
<span id="cb83-2"><a href="#cb83-2" tabindex="-1"></a>dim.array <span class="ot">&lt;-</span> <span class="fu">c</span>(nlon,nlat,ncomp)</span>
<span id="cb83-3"><a href="#cb83-3" tabindex="-1"></a>var_array <span class="ot">&lt;-</span> <span class="fu">array</span>(loadpca, dim.array)</span></code></pre></div>
<p>Next, the dimension (or coordinate) variables are defined, including
one <code>ncomp</code> long:</p>
<div class="sourceCode" id="cb84"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb84-1"><a href="#cb84-1" tabindex="-1"></a><span class="co"># define dimensions</span></span>
<span id="cb84-2"><a href="#cb84-2" tabindex="-1"></a>londim <span class="ot">&lt;-</span> <span class="fu">ncdim_def</span>(<span class="st">&quot;lon&quot;</span>, <span class="st">&quot;degrees_east&quot;</span>, <span class="fu">as.double</span>(lon))</span>
<span id="cb84-3"><a href="#cb84-3" tabindex="-1"></a>latdim <span class="ot">&lt;-</span> <span class="fu">ncdim_def</span>(<span class="st">&quot;lat&quot;</span>, <span class="st">&quot;degrees_north&quot;</span>, <span class="fu">as.double</span>(lat))</span>
<span id="cb84-4"><a href="#cb84-4" tabindex="-1"></a>comp <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="dv">1</span><span class="sc">:</span>ncomp)</span>
<span id="cb84-5"><a href="#cb84-5" tabindex="-1"></a>ncompdim <span class="ot">&lt;-</span> <span class="fu">ncdim_def</span>(<span class="st">&quot;comp&quot;</span>, <span class="st">&quot;SVD component&quot;</span>, <span class="fu">as.integer</span>(comp))</span></code></pre></div>
<p>Then the 3-d (lon x lat x ncomp) variable (the loadings) is
defined:</p>
<div class="sourceCode" id="cb85"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb85-1"><a href="#cb85-1" tabindex="-1"></a><span class="co"># define variable</span></span>
<span id="cb85-2"><a href="#cb85-2" tabindex="-1"></a>fillvalue <span class="ot">&lt;-</span> <span class="fl">1e+32</span></span>
<span id="cb85-3"><a href="#cb85-3" tabindex="-1"></a>dlname <span class="ot">&lt;-</span> <span class="st">&quot;hgt500 anomalies loadings&quot;</span></span>
<span id="cb85-4"><a href="#cb85-4" tabindex="-1"></a>var_def <span class="ot">&lt;-</span> <span class="fu">ncvar_def</span>(<span class="st">&quot;hgt500_loadings&quot;</span>, <span class="st">&quot;1&quot;</span>, <span class="fu">list</span>(londim, latdim, ncompdim), fillvalue, </span>
<span id="cb85-5"><a href="#cb85-5" tabindex="-1"></a>  dlname, <span class="at">prec =</span> <span class="st">&quot;single&quot;</span>)</span></code></pre></div>
<p>Then the netCDF file is created, and the loadings and additional
attributes are added:</p>
<div class="sourceCode" id="cb86"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb86-1"><a href="#cb86-1" tabindex="-1"></a><span class="co"># create netCDF file and put arrays</span></span>
<span id="cb86-2"><a href="#cb86-2" tabindex="-1"></a>ncfname <span class="ot">&lt;-</span> <span class="st">&quot;hgt500_loadings.nc&quot;</span></span>
<span id="cb86-3"><a href="#cb86-3" tabindex="-1"></a>ncout <span class="ot">&lt;-</span> <span class="fu">nc_create</span>(ncfname, <span class="fu">list</span>(var_def), <span class="at">force_v4 =</span> T)</span>
<span id="cb86-4"><a href="#cb86-4" tabindex="-1"></a></span>
<span id="cb86-5"><a href="#cb86-5" tabindex="-1"></a><span class="co"># put loadings</span></span>
<span id="cb86-6"><a href="#cb86-6" tabindex="-1"></a><span class="fu">ncvar_put</span>(ncout, var_def, var_array)</span>
<span id="cb86-7"><a href="#cb86-7" tabindex="-1"></a></span>
<span id="cb86-8"><a href="#cb86-8" tabindex="-1"></a><span class="co"># put additional attributes into dimension and data variables</span></span>
<span id="cb86-9"><a href="#cb86-9" tabindex="-1"></a><span class="fu">ncatt_put</span>(ncout, <span class="st">&quot;lon&quot;</span>, <span class="st">&quot;axis&quot;</span>, <span class="st">&quot;X&quot;</span>)  <span class="co">#,verbose=FALSE) #,definemode=FALSE)</span></span>
<span id="cb86-10"><a href="#cb86-10" tabindex="-1"></a><span class="fu">ncatt_put</span>(ncout, <span class="st">&quot;lat&quot;</span>, <span class="st">&quot;axis&quot;</span>, <span class="st">&quot;Y&quot;</span>)</span>
<span id="cb86-11"><a href="#cb86-11" tabindex="-1"></a><span class="fu">ncatt_put</span>(ncout, <span class="st">&quot;comp&quot;</span>, <span class="st">&quot;axis&quot;</span>, <span class="st">&quot;PC&quot;</span>)</span>
<span id="cb86-12"><a href="#cb86-12" tabindex="-1"></a></span>
<span id="cb86-13"><a href="#cb86-13" tabindex="-1"></a><span class="co"># add global attributes</span></span>
<span id="cb86-14"><a href="#cb86-14" tabindex="-1"></a>title2 <span class="ot">&lt;-</span> <span class="fu">paste</span>(title<span class="sc">$</span>value, <span class="st">&quot;SVD component analysis using pcaMethods&quot;</span>, <span class="at">sep=</span><span class="st">&quot;--&quot;</span>)</span>
<span id="cb86-15"><a href="#cb86-15" tabindex="-1"></a><span class="fu">ncatt_put</span>(ncout, <span class="dv">0</span>, <span class="st">&quot;title&quot;</span>, title2)</span>
<span id="cb86-16"><a href="#cb86-16" tabindex="-1"></a><span class="fu">ncatt_put</span>(ncout, <span class="dv">0</span>, <span class="st">&quot;institution&quot;</span>, institution<span class="sc">$</span>value)</span>
<span id="cb86-17"><a href="#cb86-17" tabindex="-1"></a><span class="fu">ncatt_put</span>(ncout, <span class="dv">0</span>, <span class="st">&quot;source&quot;</span>, datasource<span class="sc">$</span>value)</span>
<span id="cb86-18"><a href="#cb86-18" tabindex="-1"></a><span class="fu">ncatt_put</span>(ncout, <span class="dv">0</span>, <span class="st">&quot;references&quot;</span>, references<span class="sc">$</span>value)</span>
<span id="cb86-19"><a href="#cb86-19" tabindex="-1"></a>history <span class="ot">&lt;-</span> <span class="fu">paste</span>(<span class="st">&quot;P.J. Bartlein&quot;</span>, <span class="fu">date</span>(), <span class="at">sep =</span> <span class="st">&quot;, &quot;</span>)</span>
<span id="cb86-20"><a href="#cb86-20" tabindex="-1"></a><span class="fu">ncatt_put</span>(ncout, <span class="dv">0</span>, <span class="st">&quot;history&quot;</span>, history)</span>
<span id="cb86-21"><a href="#cb86-21" tabindex="-1"></a><span class="fu">ncatt_put</span>(ncout, <span class="dv">0</span>, <span class="st">&quot;Conventions&quot;</span>, Conventions<span class="sc">$</span>value)</span></code></pre></div>
<p>Finally, the netCDF file is closed, writing the data to disk.</p>
<div class="sourceCode" id="cb87"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb87-1"><a href="#cb87-1" tabindex="-1"></a><span class="fu">nc_close</span>(ncout)</span></code></pre></div>
<p><a href="pca.html">[Back to top]</a></p>
</div>
</div>




</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.odd').parent('tbody').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open');
  });
});
</script>

<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
