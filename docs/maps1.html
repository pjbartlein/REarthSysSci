<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />




<title>Maps (1)</title>

<script src="site_libs/header-attrs-2.25/header-attrs.js"></script>
<script src="site_libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/cosmo.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<style>h1 {font-size: 34px;}
       h1.title {font-size: 38px;}
       h2 {font-size: 30px;}
       h3 {font-size: 24px;}
       h4 {font-size: 18px;}
       h5 {font-size: 16px;}
       h6 {font-size: 12px;}
       code {color: inherit; background-color: rgba(0, 0, 0, 0.04);}
       pre:not([class]) { background-color: white }</style>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<script src="site_libs/clipboard-1.7.1/clipboard.min.js"></script>
<link href="site_libs/primer-tooltips-1.4.0/build.css" rel="stylesheet" />
<link href="site_libs/klippy-0.0.0.9500/css/klippy.min.css" rel="stylesheet" />
<script src="site_libs/klippy-0.0.0.9500/js/klippy.min.js"></script>

<style type="text/css">
  code{white-space: pre-wrap;}
  span.smallcaps{font-variant: small-caps;}
  span.underline{text-decoration: underline;}
  div.column{display: inline-block; vertical-align: top; width: 50%;}
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  ul.task-list{list-style: none;}
    </style>



<style type="text/css">
  code {
    white-space: pre;
  }
  .sourceCode {
    overflow: visible;
  }
</style>
<style type="text/css" data-origin="pandoc">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; } /* Alert */
code span.an { color: #008000; } /* Annotation */
code span.at { } /* Attribute */
code span.bu { } /* BuiltIn */
code span.cf { color: #0000ff; } /* ControlFlow */
code span.ch { color: #008080; } /* Char */
code span.cn { } /* Constant */
code span.co { color: #008000; } /* Comment */
code span.cv { color: #008000; } /* CommentVar */
code span.do { color: #008000; } /* Documentation */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.im { } /* Import */
code span.in { color: #008000; } /* Information */
code span.kw { color: #0000ff; } /* Keyword */
code span.op { } /* Operator */
code span.ot { color: #ff4000; } /* Other */
code span.pp { color: #ff4000; } /* Preprocessor */
code span.sc { color: #008080; } /* SpecialChar */
code span.ss { color: #008080; } /* SpecialString */
code span.st { color: #008080; } /* String */
code span.va { } /* Variable */
code span.vs { color: #008080; } /* VerbatimString */
code span.wa { color: #008000; font-weight: bold; } /* Warning */

</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    var j = 0;
    while (j < rules.length) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") {
        j++;
        continue;
      }
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' && rule.style.backgroundColor === '') {
        j++;
        continue;
      }
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>




<link rel="stylesheet" href="html-md-01.css" type="text/css" />



<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
img {
  max-width:100%;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
details > summary > p:only-child {
  display: inline;
}
pre code {
  padding: 0;
}
</style>


<style type="text/css">
.dropdown-submenu {
  position: relative;
}
.dropdown-submenu>.dropdown-menu {
  top: 0;
  left: 100%;
  margin-top: -6px;
  margin-left: -1px;
  border-radius: 0 6px 6px 6px;
}
.dropdown-submenu:hover>.dropdown-menu {
  display: block;
}
.dropdown-submenu>a:after {
  display: block;
  content: " ";
  float: right;
  width: 0;
  height: 0;
  border-color: transparent;
  border-style: solid;
  border-width: 5px 0 5px 5px;
  border-left-color: #cccccc;
  margin-top: 5px;
  margin-right: -10px;
}
.dropdown-submenu:hover>a:after {
  border-left-color: #adb5bd;
}
.dropdown-submenu.pull-left {
  float: none;
}
.dropdown-submenu.pull-left>.dropdown-menu {
  left: -100%;
  margin-left: 10px;
  border-radius: 6px 0 6px 6px;
}
</style>

<script type="text/javascript">
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark the anchor link active (and if it's in a dropdown, also mark that active)
  var dropdown = menuAnchor.closest('li.dropdown');
  if (window.bootstrap) { // Bootstrap 4+
    menuAnchor.addClass('active');
    dropdown.find('> .dropdown-toggle').addClass('active');
  } else { // Bootstrap 3
    menuAnchor.parent().addClass('active');
    dropdown.addClass('active');
  }

  // Navbar adjustments
  var navHeight = $(".navbar").first().height() + 15;
  var style = document.createElement('style');
  var pt = "padding-top: " + navHeight + "px; ";
  var mt = "margin-top: -" + navHeight + "px; ";
  var css = "";
  // offset scroll position for anchor links (for fixed navbar)
  for (var i = 1; i <= 6; i++) {
    css += ".section h" + i + "{ " + pt + mt + "}\n";
  }
  style.innerHTML = "body {" + pt + "padding-bottom: 40px; }\n" + css;
  document.head.appendChild(style);
});
</script>

<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before, .tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "\e259";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "\e258";
  font-family: 'Glyphicons Halflings';
  border: none;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
  background-color: transparent;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<!-- code folding -->




</head>

<body>


<div class="container-fluid main-container">




<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-bs-toggle="collapse" data-target="#navbar" data-bs-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">R for Earth-System Science</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="overview.html">Overview</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Topics
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li class="dropdown-header">Lecture topics</li>
    <li>
      <a href="intro.html">Introduction: R, RStudio, and other infrastructure</a>
    </li>
    <li>
      <a href="usingR.html">Using R</a>
    </li>
    <li>
      <a href="ESSdata.html">Earth-system science data</a>
    </li>
    <li>
      <a href="netCDF.html">netCDF in R</a>
    </li>
    <li>
      <a href="netcdf_terra.html">netCDF and terra</a>
    </li>
    <li>
      <a href="plots1.html">Plots (1)</a>
    </li>
    <li>
      <a href="plots2.html">Plots (2)</a>
    </li>
    <li>
      <a href="maps1.html">Maps (1)</a>
    </li>
    <li>
      <a href="maps2.html">Maps (2)</a>
    </li>
    <li>
      <a href="geospatial.html">Geospatial analyses</a>
    </li>
    <li>
      <a href="regression1.html">Regression 1</a>
    </li>
    <li>
      <a href="regression2.html">Regression 2</a>
    </li>
    <li>
      <a href="pca.html">PCA</a>
    </li>
    <li>
      <a href="highdim.html">High-resolution &amp; high-dimensional data</a>
    </li>
    <li>
      <a href="multivariate.html">Multivariate methods</a>
    </li>
    <li>
      <a href="timeseries.html">Time-series analysis</a>
    </li>
    <li class="dropdown-header">Other topics</li>
    <li>
      <a href="sf_stars_sftime.html">sf / stars / sftime</a>
    </li>
    <li>
      <a href="hdf5_intro.html">HDF in R</a>
    </li>
    <li>
      <a href="anomalies.html">Long-term means and anomalies</a>
    </li>
    <li>
      <a href="tsplots.html">Time-series plots</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Tasks
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li class="dropdown-header">Tasks</li>
    <li>
      <a href="installR.html">Install R and RStudio</a>
    </li>
    <li>
      <a href="Ex_UsingR.html">Using R exercise</a>
    </li>
    <li>
      <a href="install_netCDF.html">Install netCDF &amp; Panoply</a>
    </li>
    <li>
      <a href="transfer.html">File transfer</a>
    </li>
    <li>
      <a href="texteditor.html">Install a text editor</a>
    </li>
    <li>
      <a href="dataselection.html">Project data set selection</a>
    </li>
    <li>
      <a href="markdown.html">Markdown and RMarkdown</a>
    </li>
    <li>
      <a href="scripts_and_md.html">R Scripts and R Markdown</a>
    </li>
    <li>
      <a href="github.html">GitHub</a>
    </li>
    <li>
      <a href="pages.html">pages.uoregon.edu</a>
    </li>
    <li>
      <a href="localweb.html">Local websites</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Other
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="readings.html">Readings</a>
    </li>
    <li>
      <a href="classprojects.html">Class projects</a>
    </li>
    <li>
      <a href="websites.html">Old course web pages</a>
    </li>
  </ul>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="about.html">About</a>
</li>
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div id="header">



<h1 class="title toc-ignore">Maps (1)</h1>

</div>

<div id="TOC">
<ul>
<li><a href="#introduction" id="toc-introduction"><span
class="toc-section-number">1</span> Introduction</a></li>
<li><a
href="#set-up-outlines-and-polygons-for-global-robinson-projection-maps"
id="toc-set-up-outlines-and-polygons-for-global-robinson-projection-maps"><span
class="toc-section-number">2</span> Set up outlines and polygons for
global (Robinson projection) maps</a>
<ul>
<li><a href="#read-natural-earth-shapefiles"
id="toc-read-natural-earth-shapefiles"><span
class="toc-section-number">2.1</span> Read Natural Earth
shapefiles</a></li>
<li><a href="#project-the-shapefiles"
id="toc-project-the-shapefiles"><span
class="toc-section-number">2.2</span> Project the shapefiles</a></li>
<li><a href="#write-out-the-projected-shapefiles"
id="toc-write-out-the-projected-shapefiles"><span
class="toc-section-number">2.3</span> Write out the projected
shapefiles</a></li>
<li><a href="#clip-out-a-polygon-for-the-caspian"
id="toc-clip-out-a-polygon-for-the-caspian"><span
class="toc-section-number">2.4</span> Clip out a polygon for the
Caspian</a></li>
</ul></li>
<li><a href="#set-up-tree-cover-data"
id="toc-set-up-tree-cover-data"><span
class="toc-section-number">3</span> Set up tree-cover data</a>
<ul>
<li><a href="#read-the-tree-cover-data"
id="toc-read-the-tree-cover-data"><span
class="toc-section-number">3.1</span> Read the tree-cover data</a></li>
<li><a href="#project-the-treecover-points-and-polygons"
id="toc-project-the-treecover-points-and-polygons"><span
class="toc-section-number">3.2</span> Project the treecover points and
polygons</a></li>
</ul></li>
<li><a href="#map-the-gcdv3-charcoal-records"
id="toc-map-the-gcdv3-charcoal-records"><span
class="toc-section-number">4</span> Map the GCDv3 charcoal records</a>
<ul>
<li><a href="#read-the-projected-shape-files"
id="toc-read-the-projected-shape-files"><span
class="toc-section-number">4.1</span> Read the projected shape
files</a></li>
<li><a href="#read-the-gcdv3-data" id="toc-read-the-gcdv3-data"><span
class="toc-section-number">4.2</span> Read the GCDv3 data</a></li>
<li><a href="#plot-the-maps" id="toc-plot-the-maps"><span
class="toc-section-number">4.3</span> Plot the maps</a></li>
</ul></li>
</ul>
</div>

<script>
  addClassKlippyTo("pre.r, pre.markdown");
  addKlippy('right', 'top', 'auto', '1', 'Copy code', 'Copied!');
</script>
<p>
<span style="color: #00cc00;">NOTE: This page has been revised for
Winter 2024, but may undergo further edits.</span>
</p>
<div id="introduction" class="section level1" number="1">
<h1><span class="header-section-number">1</span> Introduction</h1>
<p>R has the ability through the <code>{maps}</code> package and the
base graphics to generate maps, but such “out-of-the-box” maps, like
other base graphics-generated illustrations, these may not be suitable
for immediate publication. Other options exit, for example, using
packages like <code>{ggmaps}</code>, <code>{mapview},</code> or
<code>{tmap}</code> However, the ability of the <code>{sf}</code>
package to handle the diverse kinds of spatial data, including
shapefiles, provides a facility for creating publishable maps. The
examples here use a set of shapefiles downloaded from the <em>Natural
Earth</em> web page <a
href="http://www.naturalearthdata.com">[http://www.naturalearthdata.com]</a>.</p>
<p>There are two R packages that can be used to directly download
Natural Earth data within a script: <code>{rnaturalearth}</code>, and
<code>{rnaturalearthdata}</code>, but it’s usually the case that one
visits the Natural Earth web page anyway, and it’s easy to download (and
save for reuse) files from the web page. Shapefiles and rasters are
available at three scales 1:10m (small spatial scale, large cartographic
scale), 1:50m, and 1:110m (large spatial scale, small cartographic
scale).</p>
<p>This first example recreates Figure 1 from Marlon, J.R., et al.,
2016, Reconstructions of biomass burning from sediment-charcoal records
to improve data–model comparisons. <em>Biogeosciences</em> 13:3225-3244.
<a
href="http://www.biogeosciences.net/13/3225/2016/">[http://www.biogeosciences.net/13/3225/2016/]</a>.
There are two general steps in the production of this map, the first
involves 1) projecting the <em>Natural Earth</em> shapefiles into the
Robinson projection (saving the shapefiles, which can be reused for
other applications), and the second the projection of the data and
assembly into the finished map.</p>
</div>
<div
id="set-up-outlines-and-polygons-for-global-robinson-projection-maps"
class="section level1" number="2">
<h1><span class="header-section-number">2</span> Set up outlines and
polygons for global (Robinson projection) maps</h1>
<div id="read-natural-earth-shapefiles" class="section level2"
number="2.1">
<h2><span class="header-section-number">2.1</span> Read Natural Earth
shapefiles</h2>
<p>The first step is to read a set of shapefiles downloaded from the
Natural Earth web page <a
href="http://www.naturalearthdata.com">[http://www.naturalearthdata.com]</a>,
and project these into the Robinson projection. Two CRAN packages,
<code>{rnaturalearth}</code> and <code>{rnaturalearthdata}</code> can be
used to manage and download the data within R, but the <em>Natural
Earth</em> web pages are worth looking at.</p>
<p>Begin by loading the appropriate packages:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a><span class="fu">library</span>(sf)</span>
<span id="cb1-2"><a href="#cb1-2" tabindex="-1"></a><span class="fu">library</span>(stars)</span>
<span id="cb1-3"><a href="#cb1-3" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb1-4"><a href="#cb1-4" tabindex="-1"></a><span class="fu">library</span>(RColorBrewer)</span>
<span id="cb1-5"><a href="#cb1-5" tabindex="-1"></a><span class="fu">library</span>(classInt)</span></code></pre></div>
<p>Now read the shape files, including those for global coastlines,
adminstrative units (borders), large lakes, and a graticule. Set the
filenames:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" tabindex="-1"></a><span class="co"># Natural Earth shape files -- global (Robinson) projections</span></span>
<span id="cb2-2"><a href="#cb2-2" tabindex="-1"></a><span class="co"># get shapefiles from http://www.naturalearthdata.com</span></span>
<span id="cb2-3"><a href="#cb2-3" tabindex="-1"></a>shape_path <span class="ot">&lt;-</span> <span class="st">&quot;/Users/bartlein/Projects/RESS/data/RMaps/source/&quot;</span></span>
<span id="cb2-4"><a href="#cb2-4" tabindex="-1"></a>coast_shapefile <span class="ot">&lt;-</span> <span class="fu">paste</span>(shape_path, <span class="st">&quot;ne_50m_coastline/ne_50m_coastline.shp&quot;</span>, <span class="at">sep=</span><span class="st">&quot;&quot;</span>)</span>
<span id="cb2-5"><a href="#cb2-5" tabindex="-1"></a>ocean_shapefile <span class="ot">&lt;-</span> <span class="fu">paste</span>(shape_path, <span class="st">&quot;ne_50m_ocean/ne_50m_ocean.shp&quot;</span>, <span class="at">sep=</span><span class="st">&quot;&quot;</span>)</span>
<span id="cb2-6"><a href="#cb2-6" tabindex="-1"></a>land_shapefile <span class="ot">&lt;-</span> <span class="fu">paste</span>(shape_path, <span class="st">&quot;ne_50m_land/ne_50m_land.shp&quot;</span>, <span class="at">sep=</span><span class="st">&quot;&quot;</span>)</span>
<span id="cb2-7"><a href="#cb2-7" tabindex="-1"></a>admin0_shapefile <span class="ot">&lt;-</span> <span class="fu">paste</span>(shape_path, <span class="st">&quot;ne_50m_admin_0_countries/ne_50m_admin_0_countries.shp&quot;</span>, <span class="at">sep=</span><span class="st">&quot;&quot;</span>)</span>
<span id="cb2-8"><a href="#cb2-8" tabindex="-1"></a>admin1_shapefile <span class="ot">&lt;-</span> <span class="fu">paste</span>(shape_path, </span>
<span id="cb2-9"><a href="#cb2-9" tabindex="-1"></a>      <span class="st">&quot;ne_50m_admin_1_states_provinces_lakes/ne_50m_admin_1_states_provinces_lakes.shp&quot;</span>, <span class="at">sep=</span><span class="st">&quot;&quot;</span>)</span>
<span id="cb2-10"><a href="#cb2-10" tabindex="-1"></a>lakes_shapefile <span class="ot">&lt;-</span> <span class="fu">paste</span>(shape_path, <span class="st">&quot;ne_50m_lakes/ne_50m_lakes.shp&quot;</span>, <span class="at">sep=</span><span class="st">&quot;&quot;</span>)</span>
<span id="cb2-11"><a href="#cb2-11" tabindex="-1"></a>bb_shapefile <span class="ot">&lt;-</span> <span class="fu">paste</span>(shape_path, <span class="st">&quot;ne_50m_graticules_all/ne_50m_wgs84_bounding_box.shp&quot;</span>, <span class="at">sep=</span><span class="st">&quot;&quot;</span>)</span>
<span id="cb2-12"><a href="#cb2-12" tabindex="-1"></a>grat30_shapefile <span class="ot">&lt;-</span> <span class="fu">paste</span>(shape_path, <span class="st">&quot;ne_50m_graticules_all/ne_50m_graticules_30.shp&quot;</span>, <span class="at">sep=</span><span class="st">&quot;&quot;</span>)</span></code></pre></div>
<p>Before reading each file, determine what kind it is (e.g. lines
vs. polygons). This information will be used to (manually, but it could
be coded) to name the <code>sf</code> objects. read and plot it. As an
example:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" tabindex="-1"></a><span class="co"># query geometry type</span></span>
<span id="cb3-2"><a href="#cb3-2" tabindex="-1"></a>coast_geometry <span class="ot">&lt;-</span> <span class="fu">as.character</span>(<span class="fu">st_geometry_type</span>(<span class="fu">st_read</span>(coast_shapefile), <span class="at">by_geometry =</span> <span class="cn">FALSE</span>))</span></code></pre></div>
<pre><code>## Reading layer `ne_50m_coastline&#39; from data source 
##   `/Users/bartlein/Projects/RESS/data/RMaps/source/ne_50m_coastline/ne_50m_coastline.shp&#39; 
##   using driver `ESRI Shapefile&#39;
## Simple feature collection with 1428 features and 2 fields
## Geometry type: MULTILINESTRING
## Dimension:     XY
## Bounding box:  xmin: -180 ymin: -85.19219 xmax: 180 ymax: 83.59961
## Geodetic CRS:  WGS 84</code></pre>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" tabindex="-1"></a>coast_geometry</span></code></pre></div>
<pre><code>## [1] &quot;MULTILINESTRING&quot;</code></pre>
<p>So the <code>coast_shapefile</code> has a “MULTILINESTRING” geometry
type, so we’ll call the input <code>sf</code> object
“<code>coast_lines_sf</code>”</p>
<p>In the ‘plot()’ functions below, use the <code>col</code> argument
for lines, <code>border</code> for polygon border colors. Read and plot
the shapefiles:</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" tabindex="-1"></a><span class="co"># read coastline</span></span>
<span id="cb7-2"><a href="#cb7-2" tabindex="-1"></a>coast_lines_sf <span class="ot">&lt;-</span> <span class="fu">st_read</span>(coast_shapefile) <span class="co"># note geometry type MULTILINESTRING</span></span></code></pre></div>
<pre><code>## Reading layer `ne_50m_coastline&#39; from data source 
##   `/Users/bartlein/Projects/RESS/data/RMaps/source/ne_50m_coastline/ne_50m_coastline.shp&#39; 
##   using driver `ESRI Shapefile&#39;
## Simple feature collection with 1428 features and 2 fields
## Geometry type: MULTILINESTRING
## Dimension:     XY
## Bounding box:  xmin: -180 ymin: -85.19219 xmax: 180 ymax: 83.59961
## Geodetic CRS:  WGS 84</code></pre>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">st_geometry</span>(coast_lines_sf), <span class="at">col=</span><span class="st">&quot;gray50&quot;</span>)</span></code></pre></div>
<p><img src="maps1_files/figure-html/maps1-5-1.png" width="80%" height="80%" /></p>
<p>Read and plot the other shapefiles. (Note that the summary output is
suppressed.)</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" tabindex="-1"></a><span class="co"># read and plot other shape files, noting geometry types</span></span>
<span id="cb10-2"><a href="#cb10-2" tabindex="-1"></a>ocean_poly_sf <span class="ot">&lt;-</span> <span class="fu">st_read</span>(ocean_shapefile) <span class="co"># note:  geometry type MULTIPOLYGON</span></span>
<span id="cb10-3"><a href="#cb10-3" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">st_geometry</span>(ocean_poly_sf), <span class="at">col=</span><span class="st">&quot;gray80&quot;</span>)</span></code></pre></div>
<p><img src="maps1_files/figure-html/maps1-6-1.png" width="80%" height="80%" /></p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" tabindex="-1"></a>land_poly_sf <span class="ot">&lt;-</span> <span class="fu">st_read</span>(land_shapefile) <span class="co"># note:  geometry type MULTIPOLYGON</span></span>
<span id="cb11-2"><a href="#cb11-2" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">st_geometry</span>(land_poly_sf), <span class="at">col=</span><span class="st">&quot;gray80&quot;</span>)</span></code></pre></div>
<p><img src="maps1_files/figure-html/maps1-6-2.png" width="80%" height="80%" /></p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" tabindex="-1"></a>admin0_poly_sf <span class="ot">&lt;-</span> <span class="fu">st_read</span>(admin0_shapefile) <span class="co"># note:  geometry type MULTIPOLYGON</span></span>
<span id="cb12-2"><a href="#cb12-2" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">st_geometry</span>(admin0_poly_sf), <span class="at">col=</span><span class="st">&quot;gray70&quot;</span>, <span class="at">border=</span><span class="st">&quot;red&quot;</span>)</span></code></pre></div>
<p><img src="maps1_files/figure-html/maps1-6-3.png" width="80%" height="80%" /></p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" tabindex="-1"></a>admin1_poly_sf <span class="ot">&lt;-</span> <span class="fu">st_read</span>(admin1_shapefile) <span class="co"># note:  geometry type MULTIPOLYGON</span></span>
<span id="cb13-2"><a href="#cb13-2" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">st_geometry</span>(admin1_poly_sf), <span class="at">col=</span><span class="st">&quot;gray70&quot;</span>, <span class="at">border=</span><span class="st">&quot;pink&quot;</span>)</span></code></pre></div>
<p><img src="maps1_files/figure-html/maps1-6-4.png" width="80%" height="80%" /></p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" tabindex="-1"></a>lakes_poly_sf <span class="ot">&lt;-</span> <span class="fu">st_read</span>(lakes_shapefile) <span class="co"># note:  geometry type POLYGON</span></span>
<span id="cb14-2"><a href="#cb14-2" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">st_geometry</span>(lakes_poly_sf), <span class="at">col=</span><span class="st">&quot;blue&quot;</span>)</span></code></pre></div>
<p><img src="maps1_files/figure-html/maps1-6-5.png" width="80%" height="80%" /></p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" tabindex="-1"></a>bb_poly_sf <span class="ot">&lt;-</span> <span class="fu">st_read</span>(bb_shapefile) <span class="co"># note:  geometry type POLYGON</span></span>
<span id="cb15-2"><a href="#cb15-2" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">st_geometry</span>(bb_poly_sf), <span class="at">col=</span><span class="st">&quot;gray70&quot;</span>)</span></code></pre></div>
<p><img src="maps1_files/figure-html/maps1-6-6.png" width="80%" height="80%" /></p>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" tabindex="-1"></a>grat30_lines_sf <span class="ot">&lt;-</span> <span class="fu">st_read</span>(grat30_shapefile) <span class="co"># note:  geometry type LINESTRING</span></span>
<span id="cb16-2"><a href="#cb16-2" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">st_geometry</span>(grat30_lines_sf), <span class="at">col=</span><span class="st">&quot;black&quot;</span>)</span></code></pre></div>
<p><img src="maps1_files/figure-html/maps1-6-7.png" width="80%" height="80%" /></p>
<p>Filter the <code>lakes_poly_sf</code> object to the the largest lakes
only:</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" tabindex="-1"></a><span class="co"># get large lakes only</span></span>
<span id="cb17-2"><a href="#cb17-2" tabindex="-1"></a>lrglakes_poly_sf <span class="ot">&lt;-</span> lakes_poly_sf[<span class="fu">as.numeric</span>(lakes_poly_sf<span class="sc">$</span>scalerank) <span class="sc">&lt;=</span> <span class="dv">2</span> ,]</span>
<span id="cb17-3"><a href="#cb17-3" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">st_geometry</span>(lrglakes_poly_sf), <span class="at">col=</span><span class="st">&quot;lightblue&quot;</span>)</span></code></pre></div>
<p><img src="maps1_files/figure-html/maps1-7-1.png" width="80%" height="80%" /></p>
<p>Plot everything.</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" tabindex="-1"></a><span class="co"># plot everything</span></span>
<span id="cb18-2"><a href="#cb18-2" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">st_geometry</span>(coast_lines_sf), <span class="at">col=</span><span class="st">&quot;black&quot;</span>)</span>
<span id="cb18-3"><a href="#cb18-3" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">st_geometry</span>(ocean_poly_sf), <span class="at">col=</span><span class="st">&quot;skyblue1&quot;</span>, <span class="at">add=</span><span class="cn">TRUE</span>)</span>
<span id="cb18-4"><a href="#cb18-4" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">st_geometry</span>(land_poly_sf), <span class="at">col=</span><span class="st">&quot;palegreen&quot;</span>, <span class="at">add=</span><span class="cn">TRUE</span>)</span>
<span id="cb18-5"><a href="#cb18-5" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">st_geometry</span>(admin0_poly_sf), <span class="at">border=</span><span class="st">&quot;red&quot;</span>, <span class="at">add=</span><span class="cn">TRUE</span>)</span>
<span id="cb18-6"><a href="#cb18-6" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">st_geometry</span>(admin1_poly_sf), <span class="at">border=</span><span class="st">&quot;pink&quot;</span>, <span class="at">add=</span><span class="cn">TRUE</span>)</span>
<span id="cb18-7"><a href="#cb18-7" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">st_geometry</span>(lakes_poly_sf), <span class="at">border=</span><span class="st">&quot;lightblue&quot;</span>, <span class="at">add=</span><span class="cn">TRUE</span>)</span>
<span id="cb18-8"><a href="#cb18-8" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">st_geometry</span>(lrglakes_poly_sf), <span class="at">border=</span><span class="st">&quot;blue&quot;</span>, <span class="at">add=</span><span class="cn">TRUE</span>)</span>
<span id="cb18-9"><a href="#cb18-9" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">st_geometry</span>(grat30_lines_sf), <span class="at">col=</span><span class="st">&quot;gray50&quot;</span>, <span class="at">add=</span><span class="cn">TRUE</span>)</span>
<span id="cb18-10"><a href="#cb18-10" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">st_geometry</span>(bb_poly_sf), <span class="at">border=</span><span class="st">&quot;black&quot;</span>, <span class="at">add=</span><span class="cn">TRUE</span>)</span>
<span id="cb18-11"><a href="#cb18-11" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">st_geometry</span>(coast_lines_sf), <span class="at">col=</span><span class="st">&quot;purple&quot;</span>, <span class="at">add=</span><span class="cn">TRUE</span>)</span></code></pre></div>
<p><img src="maps1_files/figure-html/maps1-8-1.png" width="80%" height="80%" /></p>
</div>
<div id="project-the-shapefiles" class="section level2" number="2.2">
<h2><span class="header-section-number">2.2</span> Project the
shapefiles</h2>
<p>Next, transform (project) the individual shapefiles into the Robinson
projection using <code>st_transform()</code>. Get the current coordinate
reference system (i.e. the <code>PROJ4</code> string).</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" tabindex="-1"></a><span class="co"># get CRS and projstring</span></span>
<span id="cb19-2"><a href="#cb19-2" tabindex="-1"></a>unproj_projstring <span class="ot">&lt;-</span> <span class="fu">st_crs</span>(coast_lines_sf)</span>
<span id="cb19-3"><a href="#cb19-3" tabindex="-1"></a>unproj_projstring</span></code></pre></div>
<pre><code>## Coordinate Reference System:
##   User input: WGS 84 
##   wkt:
## GEOGCRS[&quot;WGS 84&quot;,
##     DATUM[&quot;World Geodetic System 1984&quot;,
##         ELLIPSOID[&quot;WGS 84&quot;,6378137,298.257223563,
##             LENGTHUNIT[&quot;metre&quot;,1]]],
##     PRIMEM[&quot;Greenwich&quot;,0,
##         ANGLEUNIT[&quot;degree&quot;,0.0174532925199433]],
##     CS[ellipsoidal,2],
##         AXIS[&quot;latitude&quot;,north,
##             ORDER[1],
##             ANGLEUNIT[&quot;degree&quot;,0.0174532925199433]],
##         AXIS[&quot;longitude&quot;,east,
##             ORDER[2],
##             ANGLEUNIT[&quot;degree&quot;,0.0174532925199433]],
##     ID[&quot;EPSG&quot;,4326]]</code></pre>
<p>Set the <code>PROJ</code> string for the projected (Robinson)
<code>sf</code> objects:</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" tabindex="-1"></a><span class="co"># set new projstring</span></span>
<span id="cb21-2"><a href="#cb21-2" tabindex="-1"></a>robinson_projstring <span class="ot">&lt;-</span> <span class="st">&quot;+proj=robin +lon_0=0w&quot;</span></span>
<span id="cb21-3"><a href="#cb21-3" tabindex="-1"></a>robinson_projstring</span></code></pre></div>
<pre><code>## [1] &quot;+proj=robin +lon_0=0w&quot;</code></pre>
<p>Now do the projections.</p>
<div class="sourceCode" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" tabindex="-1"></a><span class="co"># do projections</span></span>
<span id="cb23-2"><a href="#cb23-2" tabindex="-1"></a>coast_lines_proj <span class="ot">&lt;-</span> <span class="fu">st_transform</span>(coast_lines_sf, <span class="at">crs =</span> <span class="fu">st_crs</span>(robinson_projstring))</span>
<span id="cb23-3"><a href="#cb23-3" tabindex="-1"></a>ocean_poly_proj <span class="ot">&lt;-</span> <span class="fu">st_transform</span>(ocean_poly_sf, <span class="at">crs =</span> <span class="fu">st_crs</span>(robinson_projstring))</span>
<span id="cb23-4"><a href="#cb23-4" tabindex="-1"></a>land_poly_proj <span class="ot">&lt;-</span> <span class="fu">st_transform</span>(land_poly_sf, <span class="at">crs =</span> <span class="fu">st_crs</span>(robinson_projstring))</span>
<span id="cb23-5"><a href="#cb23-5" tabindex="-1"></a>admin0_poly_proj <span class="ot">&lt;-</span> <span class="fu">st_transform</span>(admin0_poly_sf, <span class="at">crs =</span> <span class="fu">st_crs</span>(robinson_projstring))</span>
<span id="cb23-6"><a href="#cb23-6" tabindex="-1"></a>admin1_poly_proj <span class="ot">&lt;-</span> <span class="fu">st_transform</span>(admin1_poly_sf, <span class="at">crs =</span> <span class="fu">st_crs</span>(robinson_projstring))</span>
<span id="cb23-7"><a href="#cb23-7" tabindex="-1"></a>lakes_poly_proj <span class="ot">&lt;-</span> <span class="fu">st_transform</span>(lakes_poly_sf, <span class="at">crs =</span> <span class="fu">st_crs</span>(robinson_projstring))</span>
<span id="cb23-8"><a href="#cb23-8" tabindex="-1"></a>lrglakes_poly_proj <span class="ot">&lt;-</span> <span class="fu">st_transform</span>(lrglakes_poly_sf, <span class="at">crs =</span> <span class="fu">st_crs</span>(robinson_projstring))</span>
<span id="cb23-9"><a href="#cb23-9" tabindex="-1"></a>grat30_lines_proj <span class="ot">&lt;-</span> <span class="fu">st_transform</span>(grat30_lines_sf, <span class="at">crs =</span> <span class="fu">st_crs</span>(robinson_projstring))</span>
<span id="cb23-10"><a href="#cb23-10" tabindex="-1"></a>bb_poly_proj <span class="ot">&lt;-</span> <span class="fu">st_transform</span>(bb_poly_sf, <span class="at">crs =</span> <span class="fu">st_crs</span>(robinson_projstring))</span></code></pre></div>
<p>Plot the projected shapefiles.</p>
<div class="sourceCode" id="cb24"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" tabindex="-1"></a><span class="co"># plot projected files</span></span>
<span id="cb24-2"><a href="#cb24-2" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">st_geometry</span>(bb_poly_proj), <span class="at">col=</span><span class="st">&quot;gray90&quot;</span>, <span class="at">border=</span><span class="st">&quot;black&quot;</span>, <span class="at">lwd=</span><span class="dv">2</span>)</span>
<span id="cb24-3"><a href="#cb24-3" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">st_geometry</span>(coast_lines_proj), <span class="at">col=</span><span class="st">&quot;black&quot;</span>, <span class="at">add=</span><span class="cn">TRUE</span>)</span>
<span id="cb24-4"><a href="#cb24-4" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">st_geometry</span>(ocean_poly_proj), <span class="at">col=</span><span class="st">&quot;skyblue1&quot;</span>, <span class="at">add=</span><span class="cn">TRUE</span>)</span>
<span id="cb24-5"><a href="#cb24-5" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">st_geometry</span>(land_poly_proj), <span class="at">col=</span><span class="st">&quot;palegreen&quot;</span>, <span class="at">add=</span><span class="cn">TRUE</span>)</span>
<span id="cb24-6"><a href="#cb24-6" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">st_geometry</span>(admin0_poly_proj), <span class="at">border=</span><span class="st">&quot;red&quot;</span>, <span class="at">add=</span><span class="cn">TRUE</span>)</span>
<span id="cb24-7"><a href="#cb24-7" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">st_geometry</span>(admin1_poly_proj), <span class="at">border=</span><span class="st">&quot;pink&quot;</span>, <span class="at">add=</span><span class="cn">TRUE</span>)</span>
<span id="cb24-8"><a href="#cb24-8" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">st_geometry</span>(lakes_poly_proj), <span class="at">col=</span><span class="st">&quot;lightblue&quot;</span>, <span class="at">add=</span><span class="cn">TRUE</span>)</span>
<span id="cb24-9"><a href="#cb24-9" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">st_geometry</span>(lrglakes_poly_proj), <span class="at">col=</span><span class="st">&quot;blue&quot;</span>, <span class="at">add=</span><span class="cn">TRUE</span>)</span>
<span id="cb24-10"><a href="#cb24-10" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">st_geometry</span>(grat30_lines_proj), <span class="at">col=</span><span class="st">&quot;gray50&quot;</span>, <span class="at">add=</span><span class="cn">TRUE</span>)</span>
<span id="cb24-11"><a href="#cb24-11" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">st_geometry</span>(coast_lines_proj), <span class="at">col=</span><span class="st">&quot;purple&quot;</span>, <span class="at">add=</span><span class="cn">TRUE</span>)</span>
<span id="cb24-12"><a href="#cb24-12" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">st_geometry</span>(bb_poly_proj), <span class="at">border=</span><span class="st">&quot;black&quot;</span>, <span class="at">lwd=</span><span class="dv">2</span>, <span class="at">add=</span><span class="cn">TRUE</span>)</span></code></pre></div>
<p><img src="maps1_files/figure-html/maps1-12-1.png" width="80%" height="80%" /></p>
<p>Because the map we’re creating will use the borders and lakes only as
outlines (as opposed to polygons that might be filled with a specific
color), those polygons can be converted to <code>MULTILINESTRING</code>
objects.</p>
<div class="sourceCode" id="cb25"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" tabindex="-1"></a><span class="co"># convert MULTIPOLYGON to MULTILINESTRING</span></span>
<span id="cb25-2"><a href="#cb25-2" tabindex="-1"></a>admin0_lines_proj <span class="ot">&lt;-</span> <span class="fu">st_cast</span>(admin0_poly_proj, <span class="st">&quot;MULTILINESTRING&quot;</span>)</span>
<span id="cb25-3"><a href="#cb25-3" tabindex="-1"></a>admin1_lines_proj <span class="ot">&lt;-</span> <span class="fu">st_cast</span>(admin1_poly_proj, <span class="st">&quot;MULTILINESTRING&quot;</span>)</span>
<span id="cb25-4"><a href="#cb25-4" tabindex="-1"></a>lakes_lines_proj <span class="ot">&lt;-</span> <span class="fu">st_cast</span>(lakes_poly_proj, <span class="st">&quot;MULTILINESTRING&quot;</span>)</span>
<span id="cb25-5"><a href="#cb25-5" tabindex="-1"></a>lrglakes_lines_proj <span class="ot">&lt;-</span> <span class="fu">st_cast</span>(lrglakes_poly_proj, <span class="st">&quot;MULTILINESTRING&quot;</span>)</span>
<span id="cb25-6"><a href="#cb25-6" tabindex="-1"></a>bb_lines_proj <span class="ot">&lt;-</span> <span class="fu">st_cast</span>(bb_poly_proj, <span class="st">&quot;MULTILINESTRING&quot;</span>)</span></code></pre></div>
<p>Plot the new <code>MULTILINESTRING</code> objects</p>
<div class="sourceCode" id="cb26"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" tabindex="-1"></a><span class="co"># test the MULTILINESTRING objects</span></span>
<span id="cb26-2"><a href="#cb26-2" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">st_geometry</span>(bb_lines_proj), <span class="at">col=</span><span class="st">&quot;black&quot;</span>)</span>
<span id="cb26-3"><a href="#cb26-3" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">st_geometry</span>(coast_lines_proj), <span class="at">col=</span><span class="st">&quot;green&quot;</span>, <span class="at">add=</span><span class="cn">TRUE</span>)</span>
<span id="cb26-4"><a href="#cb26-4" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">st_geometry</span>(admin0_lines_proj), <span class="at">col=</span><span class="st">&quot;lightblue&quot;</span>, <span class="at">add=</span><span class="cn">TRUE</span>)</span>
<span id="cb26-5"><a href="#cb26-5" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">st_geometry</span>(admin1_lines_proj), <span class="at">col=</span><span class="st">&quot;lightblue&quot;</span>, <span class="at">add=</span><span class="cn">TRUE</span>)</span>
<span id="cb26-6"><a href="#cb26-6" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">st_geometry</span>(lakes_lines_proj), <span class="at">col=</span><span class="st">&quot;blue&quot;</span>, <span class="at">add=</span><span class="cn">TRUE</span>)</span>
<span id="cb26-7"><a href="#cb26-7" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">st_geometry</span>(lrglakes_lines_proj), <span class="at">col=</span><span class="st">&quot;purple&quot;</span>, <span class="at">add=</span><span class="cn">TRUE</span>)</span>
<span id="cb26-8"><a href="#cb26-8" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">st_geometry</span>(grat30_lines_proj), <span class="at">col=</span><span class="st">&quot;gray&quot;</span>, <span class="at">add=</span><span class="cn">TRUE</span>)</span>
<span id="cb26-9"><a href="#cb26-9" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">st_geometry</span>(coast_lines_proj), <span class="at">col=</span><span class="st">&quot;black&quot;</span>, <span class="at">add=</span><span class="cn">TRUE</span>)</span>
<span id="cb26-10"><a href="#cb26-10" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">st_geometry</span>(bb_lines_proj), <span class="at">border=</span><span class="st">&quot;black&quot;</span>, <span class="at">lwd =</span> <span class="dv">2</span>, <span class="at">add=</span><span class="cn">TRUE</span>)</span></code></pre></div>
<p><img src="maps1_files/figure-html/maps1-14-1.png" width="80%" height="80%" /></p>
</div>
<div id="write-out-the-projected-shapefiles" class="section level2"
number="2.3">
<h2><span class="header-section-number">2.3</span> Write out the
projected shapefiles</h2>
<p>Next, write out the projected shapefiles, first setting the output
path.</p>
<div class="sourceCode" id="cb27"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" tabindex="-1"></a><span class="co"># write out the various projected shapefiles </span></span>
<span id="cb27-2"><a href="#cb27-2" tabindex="-1"></a>outpath <span class="ot">&lt;-</span> <span class="st">&quot;/Users/bartlein/Projects/RESS/data/RMaps/derived/glRob_50m/&quot;</span></span></code></pre></div>
<p>Write out the projected coastlines.</p>
<div class="sourceCode" id="cb28"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" tabindex="-1"></a><span class="co"># coast lines </span></span>
<span id="cb28-2"><a href="#cb28-2" tabindex="-1"></a>outshape <span class="ot">&lt;-</span> coast_lines_proj</span>
<span id="cb28-3"><a href="#cb28-3" tabindex="-1"></a>outfile <span class="ot">&lt;-</span> <span class="st">&quot;glRob_50m_coast_lines/&quot;</span></span>
<span id="cb28-4"><a href="#cb28-4" tabindex="-1"></a>outshapefile <span class="ot">&lt;-</span> <span class="fu">paste</span>(outpath,outfile,<span class="at">sep=</span><span class="st">&quot;&quot;</span>)</span>
<span id="cb28-5"><a href="#cb28-5" tabindex="-1"></a><span class="fu">st_write</span>(coast_lines_proj, outshapefile, <span class="at">driver =</span> <span class="st">&quot;ESRI Shapefile&quot;</span>, <span class="at">append =</span> <span class="cn">FALSE</span>)</span></code></pre></div>
<pre><code>## Deleting layer `glRob_50m_coast_lines&#39; using driver `ESRI Shapefile&#39;
## Writing layer `glRob_50m_coast_lines&#39; to data source 
##   `/Users/bartlein/Projects/RESS/data/RMaps/derived/glRob_50m/glRob_50m_coast_lines/&#39; using driver `ESRI Shapefile&#39;
## Writing 1428 features with 2 fields and geometry type Multi Line String.</code></pre>
<p>It’s always good practice to test whether the shapefile has indeed
been written out correctly. Read it back in and plot it.</p>
<div class="sourceCode" id="cb30"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" tabindex="-1"></a><span class="co"># test</span></span>
<span id="cb30-2"><a href="#cb30-2" tabindex="-1"></a>test_sf <span class="ot">&lt;-</span> <span class="fu">st_read</span>(outshapefile)</span></code></pre></div>
<pre><code>## Reading layer `glRob_50m_coast_lines&#39; from data source 
##   `/Users/bartlein/Projects/RESS/data/RMaps/derived/glRob_50m/glRob_50m_coast_lines&#39; using driver `ESRI Shapefile&#39;
## Simple feature collection with 1428 features and 2 fields
## Geometry type: MULTILINESTRING
## Dimension:     XY
## Bounding box:  xmin: -16807980 ymin: -8429152 xmax: 16873230 ymax: 8340316
## Projected CRS: +proj=robin +lon_0=0 +x_0=0 +y_0=0 +datum=WGS84 +units=m +no_defs</code></pre>
<div class="sourceCode" id="cb32"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" tabindex="-1"></a>test_outline <span class="ot">&lt;-</span> <span class="fu">st_geometry</span>(test_sf)</span>
<span id="cb32-2"><a href="#cb32-2" tabindex="-1"></a><span class="fu">plot</span>(test_outline, <span class="at">col=</span><span class="st">&quot;gray&quot;</span>)</span></code></pre></div>
<p><img src="maps1_files/figure-html/maps1-17-1.png" width="80%" height="80%" /></p>
<p>Write out the other shapefiles.</p>
<div class="sourceCode" id="cb33"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" tabindex="-1"></a><span class="co"># write out the other objects as shapefiles</span></span>
<span id="cb33-2"><a href="#cb33-2" tabindex="-1"></a>outshape <span class="ot">&lt;-</span> bb_poly_proj</span>
<span id="cb33-3"><a href="#cb33-3" tabindex="-1"></a>outfile <span class="ot">&lt;-</span> <span class="st">&quot;glRob_50m_bb_poly/&quot;</span></span>
<span id="cb33-4"><a href="#cb33-4" tabindex="-1"></a>outshapefile <span class="ot">&lt;-</span> <span class="fu">paste</span>(outpath,outfile,<span class="at">sep=</span><span class="st">&quot;&quot;</span>)</span>
<span id="cb33-5"><a href="#cb33-5" tabindex="-1"></a><span class="fu">st_write</span>(outshape, outshapefile, <span class="at">driver =</span> <span class="st">&quot;ESRI Shapefile&quot;</span>, <span class="at">append =</span> <span class="cn">FALSE</span>)</span>
<span id="cb33-6"><a href="#cb33-6" tabindex="-1"></a></span>
<span id="cb33-7"><a href="#cb33-7" tabindex="-1"></a>outshape <span class="ot">&lt;-</span> bb_lines_proj</span>
<span id="cb33-8"><a href="#cb33-8" tabindex="-1"></a>outfile <span class="ot">&lt;-</span> <span class="st">&quot;glRob_50m_bb_lines/&quot;</span></span>
<span id="cb33-9"><a href="#cb33-9" tabindex="-1"></a>outshapefile <span class="ot">&lt;-</span> <span class="fu">paste</span>(outpath,outfile,<span class="at">sep=</span><span class="st">&quot;&quot;</span>)</span>
<span id="cb33-10"><a href="#cb33-10" tabindex="-1"></a><span class="fu">st_write</span>(outshape, outshapefile, <span class="at">driver =</span> <span class="st">&quot;ESRI Shapefile&quot;</span>, <span class="at">append =</span> <span class="cn">FALSE</span>)</span>
<span id="cb33-11"><a href="#cb33-11" tabindex="-1"></a></span>
<span id="cb33-12"><a href="#cb33-12" tabindex="-1"></a>outshape <span class="ot">&lt;-</span> ocean_poly_proj</span>
<span id="cb33-13"><a href="#cb33-13" tabindex="-1"></a>outfile <span class="ot">&lt;-</span> <span class="st">&quot;glRob_50m_ocean_poly/&quot;</span></span>
<span id="cb33-14"><a href="#cb33-14" tabindex="-1"></a>outshapefile <span class="ot">&lt;-</span> <span class="fu">paste</span>(outpath,outfile,<span class="at">sep=</span><span class="st">&quot;&quot;</span>)</span>
<span id="cb33-15"><a href="#cb33-15" tabindex="-1"></a><span class="fu">st_write</span>(outshape, outshapefile, <span class="at">driver =</span> <span class="st">&quot;ESRI Shapefile&quot;</span>, <span class="at">append =</span> <span class="cn">FALSE</span>)</span>
<span id="cb33-16"><a href="#cb33-16" tabindex="-1"></a></span>
<span id="cb33-17"><a href="#cb33-17" tabindex="-1"></a>outshape <span class="ot">&lt;-</span> land_poly_proj</span>
<span id="cb33-18"><a href="#cb33-18" tabindex="-1"></a>outfile <span class="ot">&lt;-</span> <span class="st">&quot;glRob_50m_land_poly/&quot;</span></span>
<span id="cb33-19"><a href="#cb33-19" tabindex="-1"></a>outshapefile <span class="ot">&lt;-</span> <span class="fu">paste</span>(outpath,outfile,<span class="at">sep=</span><span class="st">&quot;&quot;</span>)</span>
<span id="cb33-20"><a href="#cb33-20" tabindex="-1"></a><span class="fu">st_write</span>(outshape, outshapefile, <span class="at">driver =</span> <span class="st">&quot;ESRI Shapefile&quot;</span>, <span class="at">append =</span> <span class="cn">FALSE</span>)</span>
<span id="cb33-21"><a href="#cb33-21" tabindex="-1"></a></span>
<span id="cb33-22"><a href="#cb33-22" tabindex="-1"></a>outshape <span class="ot">&lt;-</span> admin0_poly_proj</span>
<span id="cb33-23"><a href="#cb33-23" tabindex="-1"></a>outfile <span class="ot">&lt;-</span> <span class="st">&quot;glRob_50m_admin0_poly/&quot;</span></span>
<span id="cb33-24"><a href="#cb33-24" tabindex="-1"></a>outshapefile <span class="ot">&lt;-</span> <span class="fu">paste</span>(outpath,outfile,<span class="at">sep=</span><span class="st">&quot;&quot;</span>)</span>
<span id="cb33-25"><a href="#cb33-25" tabindex="-1"></a><span class="fu">st_write</span>(outshape, outshapefile, <span class="at">driver =</span> <span class="st">&quot;ESRI Shapefile&quot;</span>, <span class="at">append =</span> <span class="cn">FALSE</span>)</span>
<span id="cb33-26"><a href="#cb33-26" tabindex="-1"></a></span>
<span id="cb33-27"><a href="#cb33-27" tabindex="-1"></a>outshape <span class="ot">&lt;-</span> admin0_lines_proj</span>
<span id="cb33-28"><a href="#cb33-28" tabindex="-1"></a>outfile <span class="ot">&lt;-</span> <span class="st">&quot;glRob_50m_admin0_lines/&quot;</span></span>
<span id="cb33-29"><a href="#cb33-29" tabindex="-1"></a>outshapefile <span class="ot">&lt;-</span> <span class="fu">paste</span>(outpath,outfile,<span class="at">sep=</span><span class="st">&quot;&quot;</span>)</span>
<span id="cb33-30"><a href="#cb33-30" tabindex="-1"></a><span class="fu">st_write</span>(outshape, outshapefile, <span class="at">driver =</span> <span class="st">&quot;ESRI Shapefile&quot;</span>, <span class="at">append =</span> <span class="cn">FALSE</span>)</span>
<span id="cb33-31"><a href="#cb33-31" tabindex="-1"></a></span>
<span id="cb33-32"><a href="#cb33-32" tabindex="-1"></a>outshape <span class="ot">&lt;-</span> admin1_poly_proj</span>
<span id="cb33-33"><a href="#cb33-33" tabindex="-1"></a>outfile <span class="ot">&lt;-</span> <span class="st">&quot;glRob_50m_admin1_poly/&quot;</span></span>
<span id="cb33-34"><a href="#cb33-34" tabindex="-1"></a>outshapefile <span class="ot">&lt;-</span> <span class="fu">paste</span>(outpath,outfile,<span class="at">sep=</span><span class="st">&quot;&quot;</span>)</span>
<span id="cb33-35"><a href="#cb33-35" tabindex="-1"></a><span class="fu">st_write</span>(outshape, outshapefile, <span class="at">driver =</span> <span class="st">&quot;ESRI Shapefile&quot;</span>, <span class="at">append =</span> <span class="cn">FALSE</span>)</span>
<span id="cb33-36"><a href="#cb33-36" tabindex="-1"></a></span>
<span id="cb33-37"><a href="#cb33-37" tabindex="-1"></a>outshape <span class="ot">&lt;-</span> admin1_lines_proj</span>
<span id="cb33-38"><a href="#cb33-38" tabindex="-1"></a>outfile <span class="ot">&lt;-</span> <span class="st">&quot;glRob_50m_admin1_lines/&quot;</span></span>
<span id="cb33-39"><a href="#cb33-39" tabindex="-1"></a>outshapefile <span class="ot">&lt;-</span> <span class="fu">paste</span>(outpath,outfile,<span class="at">sep=</span><span class="st">&quot;&quot;</span>)</span>
<span id="cb33-40"><a href="#cb33-40" tabindex="-1"></a><span class="fu">st_write</span>(outshape, outshapefile, <span class="at">driver =</span> <span class="st">&quot;ESRI Shapefile&quot;</span>, <span class="at">append =</span> <span class="cn">FALSE</span>)</span>
<span id="cb33-41"><a href="#cb33-41" tabindex="-1"></a></span>
<span id="cb33-42"><a href="#cb33-42" tabindex="-1"></a>outshape <span class="ot">&lt;-</span> lakes_poly_proj</span>
<span id="cb33-43"><a href="#cb33-43" tabindex="-1"></a>outfile <span class="ot">&lt;-</span> <span class="st">&quot;glRob_50m_lakes_poly/&quot;</span></span>
<span id="cb33-44"><a href="#cb33-44" tabindex="-1"></a>outshapefile <span class="ot">&lt;-</span> <span class="fu">paste</span>(outpath,outfile,<span class="at">sep=</span><span class="st">&quot;&quot;</span>)</span>
<span id="cb33-45"><a href="#cb33-45" tabindex="-1"></a><span class="fu">st_write</span>(outshape, outshapefile, <span class="at">driver =</span> <span class="st">&quot;ESRI Shapefile&quot;</span>, <span class="at">append =</span> <span class="cn">FALSE</span>)</span>
<span id="cb33-46"><a href="#cb33-46" tabindex="-1"></a></span>
<span id="cb33-47"><a href="#cb33-47" tabindex="-1"></a>outshape <span class="ot">&lt;-</span> lakes_lines_proj</span>
<span id="cb33-48"><a href="#cb33-48" tabindex="-1"></a>outfile <span class="ot">&lt;-</span> <span class="st">&quot;glRob_50m_lakes_lines/&quot;</span></span>
<span id="cb33-49"><a href="#cb33-49" tabindex="-1"></a>outshapefile <span class="ot">&lt;-</span> <span class="fu">paste</span>(outpath,outfile,<span class="at">sep=</span><span class="st">&quot;&quot;</span>)</span>
<span id="cb33-50"><a href="#cb33-50" tabindex="-1"></a><span class="fu">st_write</span>(outshape, outshapefile, <span class="at">driver =</span> <span class="st">&quot;ESRI Shapefile&quot;</span>, <span class="at">append =</span> <span class="cn">FALSE</span>)</span>
<span id="cb33-51"><a href="#cb33-51" tabindex="-1"></a></span>
<span id="cb33-52"><a href="#cb33-52" tabindex="-1"></a>outshape <span class="ot">&lt;-</span> lrglakes_poly_proj</span>
<span id="cb33-53"><a href="#cb33-53" tabindex="-1"></a>outfile <span class="ot">&lt;-</span> <span class="st">&quot;glRob_50m_lrglakes_poly/&quot;</span></span>
<span id="cb33-54"><a href="#cb33-54" tabindex="-1"></a>outshapefile <span class="ot">&lt;-</span> <span class="fu">paste</span>(outpath,outfile,<span class="at">sep=</span><span class="st">&quot;&quot;</span>)</span>
<span id="cb33-55"><a href="#cb33-55" tabindex="-1"></a><span class="fu">st_write</span>(outshape, outshapefile, <span class="at">driver =</span> <span class="st">&quot;ESRI Shapefile&quot;</span>, <span class="at">append =</span> <span class="cn">FALSE</span>)</span>
<span id="cb33-56"><a href="#cb33-56" tabindex="-1"></a></span>
<span id="cb33-57"><a href="#cb33-57" tabindex="-1"></a>outshape <span class="ot">&lt;-</span> lrglakes_lines_proj</span>
<span id="cb33-58"><a href="#cb33-58" tabindex="-1"></a>outfile <span class="ot">&lt;-</span> <span class="st">&quot;glRob_50m_lrglakes_lines/&quot;</span></span>
<span id="cb33-59"><a href="#cb33-59" tabindex="-1"></a>outshapefile <span class="ot">&lt;-</span> <span class="fu">paste</span>(outpath,outfile,<span class="at">sep=</span><span class="st">&quot;&quot;</span>)</span>
<span id="cb33-60"><a href="#cb33-60" tabindex="-1"></a><span class="fu">st_write</span>(outshape, outshapefile, <span class="at">driver =</span> <span class="st">&quot;ESRI Shapefile&quot;</span>, <span class="at">append =</span> <span class="cn">FALSE</span>)</span>
<span id="cb33-61"><a href="#cb33-61" tabindex="-1"></a></span>
<span id="cb33-62"><a href="#cb33-62" tabindex="-1"></a>outshape <span class="ot">&lt;-</span> grat30_lines_proj</span>
<span id="cb33-63"><a href="#cb33-63" tabindex="-1"></a>outfile <span class="ot">&lt;-</span> <span class="st">&quot;glRob_50m_grat30_lines/&quot;</span></span>
<span id="cb33-64"><a href="#cb33-64" tabindex="-1"></a>outshapefile <span class="ot">&lt;-</span> <span class="fu">paste</span>(outpath,outfile,<span class="at">sep=</span><span class="st">&quot;&quot;</span>)</span>
<span id="cb33-65"><a href="#cb33-65" tabindex="-1"></a><span class="fu">st_write</span>(outshape, outshapefile, <span class="at">driver =</span> <span class="st">&quot;ESRI Shapefile&quot;</span>, <span class="at">append =</span> <span class="cn">FALSE</span>)</span></code></pre></div>
</div>
<div id="clip-out-a-polygon-for-the-caspian" class="section level2"
number="2.4">
<h2><span class="header-section-number">2.4</span> Clip out a polygon
for the Caspian</h2>
<p>Another setup step, and again one that creates some reusable files,
is to make a polygon shape file for the Caspian Sea, which can be
plotted and filled with color. Some terrestrial databases, including the
treecover data that will be plotted below include non-missing data for
gridpoints that cover the Caspian Sea (or sometimes the Black Sea). It’s
useful to be able to knock out those points by plotting a filled polygon
with the same color that is used for the ocean. The steps involved
include trimming to coastlines file to the area around the Caspian, and
then turning those lines into a polygon (which can be projected)&gt;</p>
<p>The first step is to creat a “bounding box” that surrouds the
Caspian.</p>
<div class="sourceCode" id="cb34"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" tabindex="-1"></a><span class="co"># Caspian</span></span>
<span id="cb34-2"><a href="#cb34-2" tabindex="-1"></a>caspian_bb <span class="ot">&lt;-</span> <span class="fu">st_bbox</span>(<span class="fu">c</span>(<span class="at">xmin =</span> <span class="dv">45</span>, <span class="at">ymin =</span> <span class="dv">35</span>, <span class="at">xmax =</span> <span class="dv">56</span>, <span class="at">ymax =</span> <span class="dv">50</span>), <span class="at">crs =</span> unproj_projstring)</span>
<span id="cb34-3"><a href="#cb34-3" tabindex="-1"></a>caspian_bb <span class="ot">&lt;-</span> <span class="fu">st_as_sfc</span>(caspian_bb)</span></code></pre></div>
<div class="sourceCode" id="cb35"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" tabindex="-1"></a><span class="co"># get the points that define the ouline of the Caspian</span></span>
<span id="cb35-2"><a href="#cb35-2" tabindex="-1"></a><span class="co"># get the points that define the outline of the Caspian</span></span>
<span id="cb35-3"><a href="#cb35-3" tabindex="-1"></a>caspian_lines <span class="ot">&lt;-</span> <span class="fu">st_intersection</span>(coast_lines_sf, caspian_bb )</span></code></pre></div>
<pre><code>## Warning: attribute variables are assumed to be spatially constant throughout all geometries</code></pre>
<div class="sourceCode" id="cb37"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" tabindex="-1"></a>caspian_lines</span></code></pre></div>
<pre><code>## Simple feature collection with 6 features and 2 fields
## Geometry type: LINESTRING
## Dimension:     XY
## Bounding box:  xmin: 46.70723 ymin: 36.6145 xmax: 54.72324 ymax: 47.11016
## Geodetic CRS:  WGS 84
##      scalerank featurecla                       geometry
## 117          0  Coastline LINESTRING (53.05518 39.037...
## 118          0  Coastline LINESTRING (50.09531 44.830...
## 119          0  Coastline LINESTRING (50.29492 45.075...
## 186          0  Coastline LINESTRING (52.65957 45.518...
## 187          0  Coastline LINESTRING (47.98711 45.554...
## 1388         0  Coastline LINESTRING (54.71006 40.891...</code></pre>
<p>“Recast” into a polygon:</p>
<div class="sourceCode" id="cb39"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" tabindex="-1"></a>caspian_poly <span class="ot">&lt;-</span> <span class="fu">st_cast</span>(caspian_lines, <span class="st">&quot;POLYGON&quot;</span>)</span>
<span id="cb39-2"><a href="#cb39-2" tabindex="-1"></a>caspian_poly</span></code></pre></div>
<pre><code>## Simple feature collection with 6 features and 2 fields
## Geometry type: POLYGON
## Dimension:     XY
## Bounding box:  xmin: 46.70723 ymin: 36.6145 xmax: 54.72324 ymax: 47.11016
## Geodetic CRS:  WGS 84
##      scalerank featurecla                       geometry
## 117          0  Coastline POLYGON ((53.05518 39.03794...
## 118          0  Coastline POLYGON ((50.09531 44.83062...
## 119          0  Coastline POLYGON ((50.29492 45.07593...
## 186          0  Coastline POLYGON ((52.65957 45.51807...
## 187          0  Coastline POLYGON ((47.98711 45.55405...
## 1388         0  Coastline POLYGON ((54.71006 40.89111...</code></pre>
<p>Plot the Caspian polygon</p>
<div class="sourceCode" id="cb41"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">st_geometry</span>(caspian_poly), <span class="at">col =</span> <span class="st">&quot;skyblue&quot;</span>)</span></code></pre></div>
<p><img src="maps1_files/figure-html/maps1-22-1.png" width="80%" height="80%" /></p>
<p>Project and plot the Caspian polygon:</p>
<div class="sourceCode" id="cb42"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" tabindex="-1"></a><span class="co"># project the Caspian outline</span></span>
<span id="cb42-2"><a href="#cb42-2" tabindex="-1"></a>caspian_poly_proj <span class="ot">&lt;-</span> <span class="fu">st_transform</span>(caspian_poly, <span class="at">crs =</span> <span class="fu">st_crs</span>(robinson_projstring))</span>
<span id="cb42-3"><a href="#cb42-3" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">st_geometry</span>(caspian_poly_proj), <span class="at">col =</span> <span class="st">&quot;skyblue&quot;</span>)</span></code></pre></div>
<p><img src="maps1_files/figure-html/maps1-23-1.png" width="80%" height="80%" /></p>
<p>Write out the Caspian polygon.</p>
<div class="sourceCode" id="cb43"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" tabindex="-1"></a><span class="co"># save the Caspian outlines</span></span>
<span id="cb43-2"><a href="#cb43-2" tabindex="-1"></a>outshape <span class="ot">&lt;-</span> caspian_poly</span>
<span id="cb43-3"><a href="#cb43-3" tabindex="-1"></a>outfile <span class="ot">&lt;-</span> <span class="st">&quot;glRob_50m_caspian_poly/&quot;</span></span>
<span id="cb43-4"><a href="#cb43-4" tabindex="-1"></a>outshapefile <span class="ot">&lt;-</span> <span class="fu">paste</span>(outpath,outfile,<span class="at">sep=</span><span class="st">&quot;&quot;</span>)</span>
<span id="cb43-5"><a href="#cb43-5" tabindex="-1"></a><span class="fu">st_write</span>(caspian_poly, outshapefile, <span class="at">driver =</span> <span class="st">&quot;ESRI Shapefile&quot;</span>, <span class="at">append =</span> <span class="cn">FALSE</span>)</span></code></pre></div>
<pre><code>## Deleting layer `glRob_50m_caspian_poly&#39; using driver `ESRI Shapefile&#39;
## Writing layer `glRob_50m_caspian_poly&#39; to data source 
##   `/Users/bartlein/Projects/RESS/data/RMaps/derived/glRob_50m/glRob_50m_caspian_poly/&#39; using driver `ESRI Shapefile&#39;
## Writing 6 features with 2 fields and geometry type Polygon.</code></pre>
<div class="sourceCode" id="cb45"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" tabindex="-1"></a><span class="co"># projected lines</span></span>
<span id="cb45-2"><a href="#cb45-2" tabindex="-1"></a>outshape <span class="ot">&lt;-</span> caspian_poly_proj</span>
<span id="cb45-3"><a href="#cb45-3" tabindex="-1"></a>outfile <span class="ot">&lt;-</span> <span class="st">&quot;glRob_50m_caspian_poly_proj/&quot;</span></span>
<span id="cb45-4"><a href="#cb45-4" tabindex="-1"></a>outshapefile <span class="ot">&lt;-</span> <span class="fu">paste</span>(outpath,outfile,<span class="at">sep=</span><span class="st">&quot;&quot;</span>)</span>
<span id="cb45-5"><a href="#cb45-5" tabindex="-1"></a><span class="fu">st_write</span>(caspian_poly_proj, outshapefile, <span class="at">driver =</span> <span class="st">&quot;ESRI Shapefile&quot;</span>, <span class="at">append =</span> <span class="cn">FALSE</span>)</span></code></pre></div>
<pre><code>## Deleting layer `glRob_50m_caspian_poly_proj&#39; using driver `ESRI Shapefile&#39;
## Writing layer `glRob_50m_caspian_poly_proj&#39; to data source 
##   `/Users/bartlein/Projects/RESS/data/RMaps/derived/glRob_50m/glRob_50m_caspian_poly_proj/&#39; using driver `ESRI Shapefile&#39;
## Writing 6 features with 2 fields and geometry type Polygon.</code></pre>
<p><a href="Rmaps.html">[Back to top]</a></p>
</div>
</div>
<div id="set-up-tree-cover-data" class="section level1" number="3">
<h1><span class="header-section-number">3</span> Set up tree-cover
data</h1>
<p>One version of Fig. 1 in Marlon et al. (2016) includes a gray-shade
“layer” of the “UMD” tree-cover data (Defries et al., 2000, A new global
1-km dataset of percentage tree cover derived from remote sensing,
<em>Global Change Biology</em> 6:247-254) <a
href="http://glcf.umd.edu/data/treecover/data.shtml">[http://glcf.umd.edu/data/treecover/data.shtml]</a>,
used to provide a background context for the location of the GCDv3
sites. The data were converted to a netCDF file, and this is read, and
in turn converted to an <code>sf</code> POINTS and POLYGON</p>
<div id="read-the-tree-cover-data" class="section level2" number="3.1">
<h2><span class="header-section-number">3.1</span> Read the tree-cover
data</h2>
<div class="sourceCode" id="cb47"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" tabindex="-1"></a><span class="co"># read a single-variable netCDF dataset using stars to read_ncdf</span></span>
<span id="cb47-2"><a href="#cb47-2" tabindex="-1"></a>tree_path <span class="ot">&lt;-</span> <span class="st">&quot;/Users/bartlein/Projects/RESS/data/nc_files/&quot;</span></span>
<span id="cb47-3"><a href="#cb47-3" tabindex="-1"></a>tree_name <span class="ot">&lt;-</span> <span class="st">&quot;treecov.nc&quot;</span></span>
<span id="cb47-4"><a href="#cb47-4" tabindex="-1"></a>tree_file <span class="ot">&lt;-</span> <span class="fu">paste</span>(tree_path, tree_name, <span class="at">sep=</span><span class="st">&quot;&quot;</span>)</span>
<span id="cb47-5"><a href="#cb47-5" tabindex="-1"></a>tree <span class="ot">&lt;-</span> <span class="fu">read_ncdf</span>(tree_file, <span class="at">var =</span> <span class="st">&quot;treecov&quot;</span>)</span></code></pre></div>
<pre><code>## Will return stars object with 259200 cells.</code></pre>
<pre><code>## No projection information found in nc file. 
##  Coordinate variable units found to be degrees, 
##  assuming WGS84 Lat/Lon.</code></pre>
<div class="sourceCode" id="cb50"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1" tabindex="-1"></a>tree</span></code></pre></div>
<pre><code>## stars object with 2 dimensions and 1 attribute
## attribute(s):
##             Min. 1st Qu. Median    Mean 3rd Qu. Max.   NA&#39;s
## treecov [1]   -2      -1     -1 20.2204      42   80 198720
## dimension(s):
##     from  to offset delta refsys x/y
## lon    1 720   -180   0.5 WGS 84 [x]
## lat    1 360    -90   0.5 WGS 84 [y]</code></pre>
<p>Convert to points:</p>
<div class="sourceCode" id="cb52"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1" tabindex="-1"></a><span class="co"># convert stars object to sf POINTS</span></span>
<span id="cb52-2"><a href="#cb52-2" tabindex="-1"></a>treecov_pts <span class="ot">&lt;-</span> <span class="fu">st_as_sf</span>(tree, <span class="at">as_points =</span> <span class="cn">TRUE</span>)</span>
<span id="cb52-3"><a href="#cb52-3" tabindex="-1"></a><span class="fu">plot</span>(treecov_pts, <span class="at">pch =</span> <span class="dv">16</span>, <span class="at">cex =</span> <span class="fl">0.5</span>)</span></code></pre></div>
<p><img src="maps1_files/figure-html/maps1-26-1.png" width="80%" height="80%" /></p>
<div class="sourceCode" id="cb53"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1" tabindex="-1"></a><span class="co"># also plot a zoomed-in view of the western U.S.</span></span>
<span id="cb53-2"><a href="#cb53-2" tabindex="-1"></a><span class="fu">plot</span>(treecov_pts, <span class="at">xlim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">125</span>, <span class="sc">-</span><span class="dv">100</span>), <span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">30</span>, <span class="dv">50</span>), <span class="at">pch =</span> <span class="dv">16</span>, <span class="at">main =</span> <span class="st">&quot;treecov_pts&quot;</span>)</span></code></pre></div>
<p><img src="maps1_files/figure-html/maps1-26-2.png" width="80%" height="80%" /></p>
<p>Convert to polygons, and plot a zoomed-in look at the western
U.S:</p>
<div class="sourceCode" id="cb54"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1" tabindex="-1"></a><span class="co"># convert stars object to sf POLYGONS</span></span>
<span id="cb54-2"><a href="#cb54-2" tabindex="-1"></a>treecov_poly <span class="ot">&lt;-</span> <span class="fu">st_as_sf</span>(tree, <span class="at">as_points =</span> <span class="cn">FALSE</span>)</span>
<span id="cb54-3"><a href="#cb54-3" tabindex="-1"></a>treecov_poly</span></code></pre></div>
<pre><code>## Simple feature collection with 60480 features and 1 field
## Geometry type: POLYGON
## Dimension:     XY
## Bounding box:  xmin: -180 ymin: -90 xmax: 180 ymax: 90
## Geodetic CRS:  WGS 84
## First 10 features:
##    treecov                       geometry
## 1    0 [1] POLYGON ((-67.5 -56, -67 -5...
## 2   70 [1] POLYGON ((-70 -55.5, -69.5 ...
## 3   74 [1] POLYGON ((-69.5 -55.5, -69 ...
## 4   58 [1] POLYGON ((-69 -55.5, -68.5 ...
## 5    0 [1] POLYGON ((-68.5 -55.5, -68 ...
## 6   -2 [1] POLYGON ((-68 -55.5, -67.5 ...
## 7   59 [1] POLYGON ((-67.5 -55.5, -67 ...
## 8    0 [1] POLYGON ((-72 -55, -71.5 -5...
## 9   19 [1] POLYGON ((-71 -55, -70.5 -5...
## 10   0 [1] POLYGON ((-70.5 -55, -70 -5...</code></pre>
<div class="sourceCode" id="cb56"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb56-1"><a href="#cb56-1" tabindex="-1"></a><span class="co"># check western U.S.</span></span>
<span id="cb56-2"><a href="#cb56-2" tabindex="-1"></a><span class="fu">plot</span>(treecov_poly, <span class="at">xlim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">125</span>, <span class="sc">-</span><span class="dv">100</span>), <span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">30</span>, <span class="dv">50</span>), <span class="at">main =</span> <span class="st">&quot;treecov_poly&quot;</span>)</span></code></pre></div>
<p><img src="maps1_files/figure-html/maps1-27-1.png" width="80%" height="80%" /></p>
<p>Write out the shapefiles.</p>
<div class="sourceCode" id="cb57"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb57-1"><a href="#cb57-1" tabindex="-1"></a><span class="co"># write out the unprojected points</span></span>
<span id="cb57-2"><a href="#cb57-2" tabindex="-1"></a>outpath <span class="ot">&lt;-</span> <span class="st">&quot;/Users/bartlein/Projects/RESS/data/RMaps/derived/treecov/&quot;</span></span>
<span id="cb57-3"><a href="#cb57-3" tabindex="-1"></a>outfile <span class="ot">&lt;-</span> <span class="st">&quot;treecov_pts/&quot;</span></span>
<span id="cb57-4"><a href="#cb57-4" tabindex="-1"></a>outshapefile <span class="ot">&lt;-</span> <span class="fu">paste</span>(outpath,outfile,<span class="at">sep=</span><span class="st">&quot;&quot;</span>)</span>
<span id="cb57-5"><a href="#cb57-5" tabindex="-1"></a><span class="fu">st_write</span>(treecov_pts, outshapefile, <span class="at">driver =</span> <span class="st">&quot;ESRI Shapefile&quot;</span>, <span class="at">append =</span> <span class="cn">FALSE</span>)</span></code></pre></div>
<pre><code>## Deleting layer `treecov_pts&#39; using driver `ESRI Shapefile&#39;
## Writing layer `treecov_pts&#39; to data source 
##   `/Users/bartlein/Projects/RESS/data/RMaps/derived/treecov/treecov_pts/&#39; using driver `ESRI Shapefile&#39;
## Writing 60480 features with 1 fields and geometry type Point.</code></pre>
<div class="sourceCode" id="cb59"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb59-1"><a href="#cb59-1" tabindex="-1"></a><span class="co"># write out the unprojected polygons</span></span>
<span id="cb59-2"><a href="#cb59-2" tabindex="-1"></a>outshape <span class="ot">&lt;-</span> treecov_poly</span>
<span id="cb59-3"><a href="#cb59-3" tabindex="-1"></a>outfile <span class="ot">&lt;-</span> <span class="st">&quot;treecov_poly/&quot;</span></span>
<span id="cb59-4"><a href="#cb59-4" tabindex="-1"></a>outshapefile <span class="ot">&lt;-</span> <span class="fu">paste</span>(outpath,outfile,<span class="at">sep=</span><span class="st">&quot;&quot;</span>)</span>
<span id="cb59-5"><a href="#cb59-5" tabindex="-1"></a><span class="fu">st_write</span>(treecov_poly, outshapefile, <span class="at">driver =</span> <span class="st">&quot;ESRI Shapefile&quot;</span>, <span class="at">append =</span> <span class="cn">FALSE</span>)</span></code></pre></div>
<pre><code>## Deleting layer `treecov_poly&#39; using driver `ESRI Shapefile&#39;
## Writing layer `treecov_poly&#39; to data source 
##   `/Users/bartlein/Projects/RESS/data/RMaps/derived/treecov/treecov_poly/&#39; using driver `ESRI Shapefile&#39;
## Writing 60480 features with 1 fields and geometry type Polygon.</code></pre>
</div>
<div id="project-the-treecover-points-and-polygons"
class="section level2" number="3.2">
<h2><span class="header-section-number">3.2</span> Project the treecover
points and polygons</h2>
<p>Project the tree-cover data:</p>
<div class="sourceCode" id="cb61"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb61-1"><a href="#cb61-1" tabindex="-1"></a><span class="co"># project the treecover data</span></span>
<span id="cb61-2"><a href="#cb61-2" tabindex="-1"></a>treecov_pts_proj <span class="ot">&lt;-</span> <span class="fu">st_transform</span>(treecov_pts, <span class="at">crs =</span> <span class="fu">st_crs</span>(robinson_projstring))</span>
<span id="cb61-3"><a href="#cb61-3" tabindex="-1"></a>treecov_poly_proj <span class="ot">&lt;-</span> <span class="fu">st_transform</span>(treecov_poly, <span class="at">crs =</span> <span class="fu">st_crs</span>(robinson_projstring))</span></code></pre></div>
<p>Write out the projected points and polygons:</p>
<div class="sourceCode" id="cb62"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb62-1"><a href="#cb62-1" tabindex="-1"></a><span class="co"># write out the projected points</span></span>
<span id="cb62-2"><a href="#cb62-2" tabindex="-1"></a>outshape <span class="ot">&lt;-</span> treecov_pts_proj</span>
<span id="cb62-3"><a href="#cb62-3" tabindex="-1"></a>outfile <span class="ot">&lt;-</span> <span class="st">&quot;treecov_pts_proj/&quot;</span></span>
<span id="cb62-4"><a href="#cb62-4" tabindex="-1"></a>outshapefile <span class="ot">&lt;-</span> <span class="fu">paste</span>(outpath,outfile,<span class="at">sep=</span><span class="st">&quot;&quot;</span>)</span>
<span id="cb62-5"><a href="#cb62-5" tabindex="-1"></a><span class="fu">st_write</span>(treecov_pts_proj, outshapefile, <span class="at">driver =</span> <span class="st">&quot;ESRI Shapefile&quot;</span>, <span class="at">append =</span> <span class="cn">FALSE</span>)</span></code></pre></div>
<pre><code>## Deleting layer `treecov_pts_proj&#39; using driver `ESRI Shapefile&#39;
## Writing layer `treecov_pts_proj&#39; to data source 
##   `/Users/bartlein/Projects/RESS/data/RMaps/derived/treecov/treecov_pts_proj/&#39; using driver `ESRI Shapefile&#39;
## Writing 60480 features with 1 fields and geometry type Point.</code></pre>
<div class="sourceCode" id="cb64"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb64-1"><a href="#cb64-1" tabindex="-1"></a><span class="co"># write out the projected polygons</span></span>
<span id="cb64-2"><a href="#cb64-2" tabindex="-1"></a>outshape <span class="ot">&lt;-</span> treecov_poly_proj</span>
<span id="cb64-3"><a href="#cb64-3" tabindex="-1"></a>outfile <span class="ot">&lt;-</span> <span class="st">&quot;treecov_poly_proj/&quot;</span></span>
<span id="cb64-4"><a href="#cb64-4" tabindex="-1"></a>outshapefile <span class="ot">&lt;-</span> <span class="fu">paste</span>(outpath,outfile,<span class="at">sep=</span><span class="st">&quot;&quot;</span>)</span>
<span id="cb64-5"><a href="#cb64-5" tabindex="-1"></a><span class="fu">st_write</span>(treecov_poly_proj, outshapefile, <span class="at">driver =</span> <span class="st">&quot;ESRI Shapefile&quot;</span>, <span class="at">append =</span> <span class="cn">FALSE</span>)</span></code></pre></div>
<pre><code>## Deleting layer `treecov_poly_proj&#39; using driver `ESRI Shapefile&#39;
## Writing layer `treecov_poly_proj&#39; to data source 
##   `/Users/bartlein/Projects/RESS/data/RMaps/derived/treecov/treecov_poly_proj/&#39; using driver `ESRI Shapefile&#39;
## Writing 60480 features with 1 fields and geometry type Polygon.</code></pre>
<p><a href="rmaps1.html">[Back to top]</a></p>
</div>
</div>
<div id="map-the-gcdv3-charcoal-records" class="section level1"
number="4">
<h1><span class="header-section-number">4</span> Map the GCDv3 charcoal
records</h1>
<p>Figure 1 of Marlon et al. (2016) shows the distribution of charcoal
records, and additionally shows by means of symbol color the number of
samples in each record. Two versions of the figure will be produced: 1)
as published, and 2) with the tree-cover data as a gray-shaded
background.</p>
<div id="read-the-projected-shape-files" class="section level2"
number="4.1">
<h2><span class="header-section-number">4.1</span> Read the projected
shape files</h2>
<p>We’ll assume that the necessary projected map and tree cover files
are available in the current Environment. Otherwise, they could be read
in as usual here.</p>
<p>Set cutpoints and gray-scale color numbers for plotting the
tree-cover data. These were calculated to follow a “Munsell sequence” of
equally perceived class intervals.</p>
</div>
<div id="read-the-gcdv3-data" class="section level2" number="4.2">
<h2><span class="header-section-number">4.2</span> Read the GCDv3
data</h2>
<p>Read the GCDv3 charcoal site-location data.</p>
<div class="sourceCode" id="cb66"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb66-1"><a href="#cb66-1" tabindex="-1"></a><span class="co"># read the data</span></span>
<span id="cb66-2"><a href="#cb66-2" tabindex="-1"></a>csvpath <span class="ot">&lt;-</span> <span class="st">&quot;/Users/bartlein/Projects/RESS/data/csv_files/&quot;</span></span>
<span id="cb66-3"><a href="#cb66-3" tabindex="-1"></a>csvname <span class="ot">&lt;-</span> <span class="st">&quot;GCDv3_MapData_Fig1.csv&quot;</span></span>
<span id="cb66-4"><a href="#cb66-4" tabindex="-1"></a>gcdv3_csv <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="fu">paste</span>(csvpath, csvname, <span class="at">sep=</span><span class="st">&quot;&quot;</span>))</span>
<span id="cb66-5"><a href="#cb66-5" tabindex="-1"></a>gcdv3_csv <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="fu">cbind</span>(gcdv3_csv<span class="sc">$</span>Long, gcdv3_csv<span class="sc">$</span>Lat, gcdv3_csv<span class="sc">$</span>samples22k))</span>
<span id="cb66-6"><a href="#cb66-6" tabindex="-1"></a><span class="fu">names</span>(gcdv3_csv) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;lon&quot;</span>, <span class="st">&quot;lat&quot;</span>, <span class="st">&quot;samples22k&quot;</span>)</span>
<span id="cb66-7"><a href="#cb66-7" tabindex="-1"></a><span class="fu">head</span>(gcdv3_csv)</span></code></pre></div>
<pre><code>##         lon     lat samples22k
## 1 -110.6161 44.6628        668
## 2 -110.3467 44.9183        567
## 3 -114.9867 45.7044        367
## 4 -114.2619 45.8919        387
## 5 -114.6503 46.3206        435
## 6 -113.4403 45.8406        971</code></pre>
<p>Convert to POINTS:</p>
<div class="sourceCode" id="cb68"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb68-1"><a href="#cb68-1" tabindex="-1"></a><span class="co"># convert to sf POINTS</span></span>
<span id="cb68-2"><a href="#cb68-2" tabindex="-1"></a>gcdv3_pts <span class="ot">&lt;-</span> <span class="fu">st_as_sf</span>(gcdv3_csv, <span class="at">coords =</span> <span class="fu">c</span>(<span class="st">&quot;lon&quot;</span>, <span class="st">&quot;lat&quot;</span>))</span>
<span id="cb68-3"><a href="#cb68-3" tabindex="-1"></a>gcdv3_pts <span class="ot">&lt;-</span> <span class="fu">st_set_crs</span>(gcdv3_pts, unproj_projstring)</span>
<span id="cb68-4"><a href="#cb68-4" tabindex="-1"></a>gcdv3_pts</span></code></pre></div>
<pre><code>## Simple feature collection with 736 features and 1 field
## Geometry type: POINT
## Dimension:     XY
## Bounding box:  xmin: -179.56 ymin: -54.88333 xmax: 179.5 ymax: 69.3833
## Geodetic CRS:  WGS 84
## First 10 features:
##    samples22k                  geometry
## 1         668 POINT (-110.6161 44.6628)
## 2         567 POINT (-110.3467 44.9183)
## 3         367 POINT (-114.9867 45.7044)
## 4         387 POINT (-114.2619 45.8919)
## 5         435 POINT (-114.6503 46.3206)
## 6         971 POINT (-113.4403 45.8406)
## 7        1801 POINT (-114.3592 48.1658)
## 8         790     POINT (-123.46 42.02)
## 9         310 POINT (-122.5575 41.3467)
## 10        331 POINT (-122.4954 41.2075)</code></pre>
<div class="sourceCode" id="cb70"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb70-1"><a href="#cb70-1" tabindex="-1"></a><span class="co"># project the gcdv3 data</span></span>
<span id="cb70-2"><a href="#cb70-2" tabindex="-1"></a>gcdv3_pts_proj <span class="ot">&lt;-</span> <span class="fu">st_transform</span>(gcdv3_pts, <span class="at">crs =</span> <span class="fu">st_crs</span>(robinson_projstring))</span></code></pre></div>
<p>Set colors for tree cover data:</p>
<div class="sourceCode" id="cb71"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb71-1"><a href="#cb71-1" tabindex="-1"></a><span class="co"># colors for tree cover</span></span>
<span id="cb71-2"><a href="#cb71-2" tabindex="-1"></a>treecov_clr_upper <span class="ot">&lt;-</span> <span class="fu">c</span>(   <span class="dv">1</span>,    <span class="dv">15</span>,    <span class="dv">20</span>,    <span class="dv">25</span>,    <span class="dv">30</span>,    <span class="dv">35</span>,    <span class="dv">40</span>,    <span class="dv">45</span>,    <span class="dv">50</span>,    <span class="dv">55</span>,    <span class="dv">60</span>,    <span class="dv">65</span>,    <span class="dv">70</span>,    <span class="dv">75</span>,   <span class="dv">999</span>)</span>
<span id="cb71-3"><a href="#cb71-3" tabindex="-1"></a>treecov_clr_gray <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fl">1.000</span>, <span class="fl">0.979</span>, <span class="fl">0.954</span>, <span class="fl">0.926</span>, <span class="fl">0.894</span>, <span class="fl">0.859</span>, <span class="fl">0.820</span>, <span class="fl">0.778</span>, <span class="fl">0.733</span>, <span class="fl">0.684</span>, <span class="fl">0.632</span>, <span class="fl">0.576</span>, <span class="fl">0.517</span>, <span class="fl">0.455</span>, <span class="fl">0.389</span>)</span>
<span id="cb71-4"><a href="#cb71-4" tabindex="-1"></a>colnum <span class="ot">&lt;-</span> <span class="fu">findInterval</span>(treecov_poly_proj<span class="sc">$</span>treecov, treecov_clr_upper)<span class="sc">+</span><span class="dv">1</span></span>
<span id="cb71-5"><a href="#cb71-5" tabindex="-1"></a>clr <span class="ot">&lt;-</span> <span class="fu">gray</span>(treecov_clr_gray[colnum], <span class="at">alpha=</span><span class="cn">NULL</span>)</span></code></pre></div>
<p>Set colors and symbol sizes for characoal data:</p>
<div class="sourceCode" id="cb72"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb72-1"><a href="#cb72-1" tabindex="-1"></a><span class="co"># set symbol size and colors gcdv3</span></span>
<span id="cb72-2"><a href="#cb72-2" tabindex="-1"></a>nsamp_cutpts <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">10</span>,<span class="dv">100</span>,<span class="dv">1000</span>,<span class="dv">10000</span>)</span>
<span id="cb72-3"><a href="#cb72-3" tabindex="-1"></a>nsamp_colors <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;green3&quot;</span>,<span class="st">&quot;deepskyblue2&quot;</span>,<span class="st">&quot;slateblue4&quot;</span>,<span class="st">&quot;purple&quot;</span>)</span>
<span id="cb72-4"><a href="#cb72-4" tabindex="-1"></a>nsamp_cex <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fl">0.5</span>,<span class="fl">0.5</span>,<span class="fl">0.5</span>,<span class="fl">0.5</span>)</span>
<span id="cb72-5"><a href="#cb72-5" tabindex="-1"></a>nsamp_num <span class="ot">&lt;-</span> <span class="fu">findInterval</span>(gcdv3_pts<span class="sc">$</span>samples22k, nsamp_cutpts)<span class="sc">+</span><span class="dv">1</span></span></code></pre></div>
</div>
<div id="plot-the-maps" class="section level2" number="4.3">
<h2><span class="header-section-number">4.3</span> Plot the maps</h2>
<p>First, plot the sites with no background. The code below creates a
.pdf file in the working directory.</p>
<div class="sourceCode" id="cb73"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb73-1"><a href="#cb73-1" tabindex="-1"></a><span class="co"># version with no background</span></span>
<span id="cb73-2"><a href="#cb73-2" tabindex="-1"></a>pdffile <span class="ot">&lt;-</span> <span class="st">&quot;gcdv3_nsamp.pdf&quot;</span></span>
<span id="cb73-3"><a href="#cb73-3" tabindex="-1"></a><span class="fu">pdf</span>(<span class="fu">paste</span>(pdffile,<span class="at">sep=</span><span class="st">&quot;&quot;</span>), <span class="at">paper=</span><span class="st">&quot;letter&quot;</span>, <span class="at">width=</span><span class="dv">8</span>, <span class="at">height=</span><span class="dv">8</span>)</span>
<span id="cb73-4"><a href="#cb73-4" tabindex="-1"></a></span>
<span id="cb73-5"><a href="#cb73-5" tabindex="-1"></a><span class="co"># basemap -- version with no background</span></span>
<span id="cb73-6"><a href="#cb73-6" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">st_geometry</span>(bb_poly_proj), <span class="at">col=</span><span class="st">&quot;gray90&quot;</span>, <span class="at">border=</span><span class="st">&quot;black&quot;</span>, <span class="at">lwd=</span><span class="fl">0.1</span>)</span>
<span id="cb73-7"><a href="#cb73-7" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">st_geometry</span>(grat30_lines_proj), <span class="at">col=</span><span class="st">&quot;gray50&quot;</span>, <span class="at">lwd =</span> <span class="fl">0.4</span>, <span class="at">add=</span><span class="cn">TRUE</span>)</span>
<span id="cb73-8"><a href="#cb73-8" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">st_geometry</span>(admin0_poly_proj), <span class="at">border=</span><span class="st">&quot;gray50&quot;</span>, <span class="at">lwd =</span> <span class="fl">0.4</span>, <span class="at">col =</span> <span class="st">&quot;white&quot;</span>, <span class="at">add=</span><span class="cn">TRUE</span>)</span>
<span id="cb73-9"><a href="#cb73-9" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">st_geometry</span>(lrglakes_poly_proj), <span class="at">border=</span><span class="st">&quot;black&quot;</span>, <span class="at">lwd =</span> <span class="fl">0.2</span>, <span class="at">col =</span> <span class="st">&quot;gray90&quot;</span>, <span class="at">add=</span><span class="cn">TRUE</span>)</span>
<span id="cb73-10"><a href="#cb73-10" tabindex="-1"></a><span class="co"># plot(st_geometry(admin1_poly_proj), border=&quot;pink&quot;, add=TRUE)</span></span>
<span id="cb73-11"><a href="#cb73-11" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">st_geometry</span>(coast_lines_proj), <span class="at">col =</span> <span class="st">&quot;black&quot;</span>, <span class="at">lwd =</span> <span class="fl">0.4</span>, <span class="at">add =</span> <span class="cn">TRUE</span>)</span>
<span id="cb73-12"><a href="#cb73-12" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">st_geometry</span>(bb_lines_proj), <span class="at">border=</span><span class="st">&quot;black&quot;</span>, <span class="at">lwd =</span> <span class="fl">1.0</span>, <span class="at">add =</span> <span class="cn">TRUE</span>)</span>
<span id="cb73-13"><a href="#cb73-13" tabindex="-1"></a></span>
<span id="cb73-14"><a href="#cb73-14" tabindex="-1"></a><span class="fu">plot</span>(gcdv3_pts_proj, <span class="at">pch=</span><span class="dv">2</span>, <span class="at">col=</span>nsamp_colors[nsamp_num], <span class="at">cex=</span>nsamp_cex[nsamp_num], <span class="at">lwd=</span><span class="fl">0.6</span>, <span class="at">add=</span><span class="cn">TRUE</span>)</span>
<span id="cb73-15"><a href="#cb73-15" tabindex="-1"></a></span>
<span id="cb73-16"><a href="#cb73-16" tabindex="-1"></a><span class="fu">text</span>(<span class="sc">-</span><span class="dv">17000000</span>, <span class="dv">9100000</span>, <span class="at">pos=</span><span class="dv">4</span>, <span class="at">cex=</span><span class="fl">0.8</span>, <span class="st">&quot;GCDv3 -- Number of Samples (Since 22 ka)&quot;</span>)</span>
<span id="cb73-17"><a href="#cb73-17" tabindex="-1"></a><span class="fu">legend</span>(<span class="sc">-</span><span class="dv">17000000</span>, <span class="sc">-</span><span class="dv">5000000</span>, <span class="at">legend=</span><span class="fu">c</span>(<span class="st">&quot;&lt; 10&quot;</span>,<span class="st">&quot;10 - 100&quot;</span>,<span class="st">&quot;100 - 1000&quot;</span>,<span class="st">&quot;&gt; 1000&quot;</span>), <span class="at">bg=</span><span class="st">&quot;white&quot;</span>,</span>
<span id="cb73-18"><a href="#cb73-18" tabindex="-1"></a>       <span class="at">title=</span><span class="st">&quot;Number of Samples&quot;</span>, <span class="at">pch=</span><span class="dv">2</span>, <span class="at">pt.lwd=</span><span class="fl">0.6</span>, <span class="at">col=</span>nsamp_colors, <span class="at">cex=</span><span class="fl">0.6</span>)</span>
<span id="cb73-19"><a href="#cb73-19" tabindex="-1"></a></span>
<span id="cb73-20"><a href="#cb73-20" tabindex="-1"></a><span class="fu">dev.off</span>()</span></code></pre></div>
<p>The resulting plot will look like this:<br />
<img src="images/gcdv3_nsamp.png" /></p>
<p>Now plot the version with the version with the tree cover background
data:</p>
<div class="sourceCode" id="cb74"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb74-1"><a href="#cb74-1" tabindex="-1"></a><span class="co"># version with treecover background</span></span>
<span id="cb74-2"><a href="#cb74-2" tabindex="-1"></a>pdffile <span class="ot">&lt;-</span> <span class="st">&quot;gcdv3_nsamp_treecov.pdf&quot;</span></span>
<span id="cb74-3"><a href="#cb74-3" tabindex="-1"></a><span class="fu">pdf</span>(pdffile, <span class="at">paper=</span><span class="st">&quot;letter&quot;</span>, <span class="at">width=</span><span class="dv">8</span>, <span class="at">height=</span><span class="dv">8</span>)</span>
<span id="cb74-4"><a href="#cb74-4" tabindex="-1"></a></span>
<span id="cb74-5"><a href="#cb74-5" tabindex="-1"></a><span class="co"># basemap -- version with treecover background</span></span>
<span id="cb74-6"><a href="#cb74-6" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">st_geometry</span>(bb_poly_proj), <span class="at">col=</span><span class="st">&quot;aliceblue&quot;</span>, <span class="at">border=</span><span class="st">&quot;black&quot;</span>, <span class="at">lwd=</span><span class="fl">0.1</span>)</span>
<span id="cb74-7"><a href="#cb74-7" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">st_geometry</span>(grat30_lines_proj), <span class="at">col=</span><span class="st">&quot;gray50&quot;</span>, <span class="at">lwd =</span> <span class="fl">0.4</span>, <span class="at">add=</span><span class="cn">TRUE</span>)</span>
<span id="cb74-8"><a href="#cb74-8" tabindex="-1"></a><span class="fu">plot</span>(treecov_poly_proj, <span class="at">col=</span>clr, <span class="at">bor=</span>clr, <span class="at">lwd=</span><span class="fl">0.01</span>, <span class="at">ljoin=</span><span class="st">&quot;bevel&quot;</span>, <span class="at">add=</span><span class="cn">TRUE</span>)</span>
<span id="cb74-9"><a href="#cb74-9" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">st_geometry</span>(admin0_lines_proj), <span class="at">col=</span><span class="st">&quot;gray50&quot;</span>, <span class="at">lwd =</span> <span class="fl">0.4</span>, <span class="at">add=</span><span class="cn">TRUE</span>)</span>
<span id="cb74-10"><a href="#cb74-10" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">st_geometry</span>(lrglakes_lines_proj), <span class="at">col=</span><span class="st">&quot;gray50&quot;</span>, <span class="at">bor =</span> <span class="st">&quot;black&quot;</span>, <span class="at">lwd =</span> <span class="fl">0.2</span>, <span class="at">add=</span><span class="cn">TRUE</span>)</span>
<span id="cb74-11"><a href="#cb74-11" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">st_geometry</span>(caspian_poly_proj), <span class="at">col=</span><span class="st">&quot;aliceblue&quot;</span>, <span class="at">bor =</span> <span class="st">&quot;black&quot;</span>, <span class="at">lwd=</span><span class="fl">0.2</span>, <span class="at">add=</span><span class="cn">TRUE</span>)</span>
<span id="cb74-12"><a href="#cb74-12" tabindex="-1"></a><span class="co"># plot(st_geometry(admin1_poly_proj), border=&quot;pink&quot;, add=TRUE)</span></span>
<span id="cb74-13"><a href="#cb74-13" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">st_geometry</span>(coast_lines_proj), <span class="at">col =</span> <span class="st">&quot;black&quot;</span>, <span class="at">lwd =</span> <span class="fl">0.4</span>, <span class="at">add =</span> <span class="cn">TRUE</span>)</span>
<span id="cb74-14"><a href="#cb74-14" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">st_geometry</span>(bb_lines_proj), <span class="at">border=</span><span class="st">&quot;black&quot;</span>, <span class="at">lwd =</span> <span class="fl">0.5</span>, <span class="at">add =</span> <span class="cn">TRUE</span>)</span>
<span id="cb74-15"><a href="#cb74-15" tabindex="-1"></a></span>
<span id="cb74-16"><a href="#cb74-16" tabindex="-1"></a><span class="fu">plot</span>(gcdv3_pts_proj, <span class="at">pch=</span><span class="dv">2</span>, <span class="at">col=</span>nsamp_colors[nsamp_num], <span class="at">cex=</span>nsamp_cex[nsamp_num], <span class="at">lwd=</span><span class="fl">0.6</span>, <span class="at">add=</span><span class="cn">TRUE</span>)</span>
<span id="cb74-17"><a href="#cb74-17" tabindex="-1"></a></span>
<span id="cb74-18"><a href="#cb74-18" tabindex="-1"></a><span class="fu">text</span>(<span class="sc">-</span><span class="dv">17000000</span>, <span class="dv">9100000</span>, <span class="at">pos=</span><span class="dv">4</span>, <span class="at">cex=</span><span class="fl">0.8</span>, <span class="st">&quot;GCDv3 -- Number of Samples (Since 22 ka)&quot;</span>)</span>
<span id="cb74-19"><a href="#cb74-19" tabindex="-1"></a><span class="fu">legend</span>(<span class="sc">-</span><span class="dv">17000000</span>, <span class="sc">-</span><span class="dv">5000000</span>, <span class="at">legend=</span><span class="fu">c</span>(<span class="st">&quot;&lt; 10&quot;</span>,<span class="st">&quot;10 - 100&quot;</span>,<span class="st">&quot;100 - 1000&quot;</span>,<span class="st">&quot;&gt; 1000&quot;</span>), <span class="at">bg=</span><span class="st">&quot;white&quot;</span>,</span>
<span id="cb74-20"><a href="#cb74-20" tabindex="-1"></a>       <span class="at">title=</span><span class="st">&quot;Number of Samples&quot;</span>, <span class="at">pch=</span><span class="dv">2</span>, <span class="at">pt.lwd=</span><span class="fl">0.6</span>, <span class="at">col=</span>nsamp_colors, <span class="at">cex=</span><span class="fl">0.6</span>)</span>
<span id="cb74-21"><a href="#cb74-21" tabindex="-1"></a><span class="fu">dev.off</span>()</span></code></pre></div>
<p>The resulting plot will look like this:</p>
<p><img src="images/gcdv3_nsamp_treecov.png" /></p>
<p>Note the ocean-colored Caspian knockout.</p>
<p><a href="Rmaps.html">[Back to top]</a></p>
</div>
</div>




</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.odd').parent('tbody').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open');
  });
});
</script>

<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
