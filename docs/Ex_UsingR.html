<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />




<title>Using R – Exercise</title>

<script src="site_libs/header-attrs-2.25/header-attrs.js"></script>
<script src="site_libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/cosmo.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<style>h1 {font-size: 34px;}
       h1.title {font-size: 38px;}
       h2 {font-size: 30px;}
       h3 {font-size: 24px;}
       h4 {font-size: 18px;}
       h5 {font-size: 16px;}
       h6 {font-size: 12px;}
       code {color: inherit; background-color: rgba(0, 0, 0, 0.04);}
       pre:not([class]) { background-color: white }</style>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<script src="site_libs/clipboard-1.7.1/clipboard.min.js"></script>
<link href="site_libs/primer-tooltips-1.4.0/build.css" rel="stylesheet" />
<link href="site_libs/klippy-0.0.0.9500/css/klippy.min.css" rel="stylesheet" />
<script src="site_libs/klippy-0.0.0.9500/js/klippy.min.js"></script>

<style type="text/css">
  code{white-space: pre-wrap;}
  span.smallcaps{font-variant: small-caps;}
  span.underline{text-decoration: underline;}
  div.column{display: inline-block; vertical-align: top; width: 50%;}
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  ul.task-list{list-style: none;}
    </style>



<style type="text/css">
  code {
    white-space: pre;
  }
  .sourceCode {
    overflow: visible;
  }
</style>
<style type="text/css" data-origin="pandoc">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; } /* Alert */
code span.an { color: #008000; } /* Annotation */
code span.at { } /* Attribute */
code span.bu { } /* BuiltIn */
code span.cf { color: #0000ff; } /* ControlFlow */
code span.ch { color: #008080; } /* Char */
code span.cn { } /* Constant */
code span.co { color: #008000; } /* Comment */
code span.cv { color: #008000; } /* CommentVar */
code span.do { color: #008000; } /* Documentation */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.im { } /* Import */
code span.in { color: #008000; } /* Information */
code span.kw { color: #0000ff; } /* Keyword */
code span.op { } /* Operator */
code span.ot { color: #ff4000; } /* Other */
code span.pp { color: #ff4000; } /* Preprocessor */
code span.sc { color: #008080; } /* SpecialChar */
code span.ss { color: #008080; } /* SpecialString */
code span.st { color: #008080; } /* String */
code span.va { } /* Variable */
code span.vs { color: #008080; } /* VerbatimString */
code span.wa { color: #008000; font-weight: bold; } /* Warning */

</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    var j = 0;
    while (j < rules.length) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") {
        j++;
        continue;
      }
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' && rule.style.backgroundColor === '') {
        j++;
        continue;
      }
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>




<link rel="stylesheet" href="html-md-01.css" type="text/css" />



<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
img {
  max-width:100%;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
details > summary > p:only-child {
  display: inline;
}
pre code {
  padding: 0;
}
</style>


<style type="text/css">
.dropdown-submenu {
  position: relative;
}
.dropdown-submenu>.dropdown-menu {
  top: 0;
  left: 100%;
  margin-top: -6px;
  margin-left: -1px;
  border-radius: 0 6px 6px 6px;
}
.dropdown-submenu:hover>.dropdown-menu {
  display: block;
}
.dropdown-submenu>a:after {
  display: block;
  content: " ";
  float: right;
  width: 0;
  height: 0;
  border-color: transparent;
  border-style: solid;
  border-width: 5px 0 5px 5px;
  border-left-color: #cccccc;
  margin-top: 5px;
  margin-right: -10px;
}
.dropdown-submenu:hover>a:after {
  border-left-color: #adb5bd;
}
.dropdown-submenu.pull-left {
  float: none;
}
.dropdown-submenu.pull-left>.dropdown-menu {
  left: -100%;
  margin-left: 10px;
  border-radius: 6px 0 6px 6px;
}
</style>

<script type="text/javascript">
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark the anchor link active (and if it's in a dropdown, also mark that active)
  var dropdown = menuAnchor.closest('li.dropdown');
  if (window.bootstrap) { // Bootstrap 4+
    menuAnchor.addClass('active');
    dropdown.find('> .dropdown-toggle').addClass('active');
  } else { // Bootstrap 3
    menuAnchor.parent().addClass('active');
    dropdown.addClass('active');
  }

  // Navbar adjustments
  var navHeight = $(".navbar").first().height() + 15;
  var style = document.createElement('style');
  var pt = "padding-top: " + navHeight + "px; ";
  var mt = "margin-top: -" + navHeight + "px; ";
  var css = "";
  // offset scroll position for anchor links (for fixed navbar)
  for (var i = 1; i <= 6; i++) {
    css += ".section h" + i + "{ " + pt + mt + "}\n";
  }
  style.innerHTML = "body {" + pt + "padding-bottom: 40px; }\n" + css;
  document.head.appendChild(style);
});
</script>

<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before, .tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "\e259";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "\e258";
  font-family: 'Glyphicons Halflings';
  border: none;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
  background-color: transparent;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<!-- code folding -->




</head>

<body>


<div class="container-fluid main-container">




<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-bs-toggle="collapse" data-target="#navbar" data-bs-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">R for Earth-System Science</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="overview.html">Overview</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Topics
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li class="dropdown-header">Lecture topics</li>
    <li>
      <a href="intro.html">Introduction: R, RStudio, and other infrastructure</a>
    </li>
    <li>
      <a href="usingR.html">Using R</a>
    </li>
    <li>
      <a href="ESSdata.html">Earth-system science data</a>
    </li>
    <li>
      <a href="netCDF.html">netCDF in R</a>
    </li>
    <li>
      <a href="netcdf_terra.html">netCDF and terra</a>
    </li>
    <li>
      <a href="plots1.html">Plots (1)</a>
    </li>
    <li>
      <a href="plots2.html">Plots (2)</a>
    </li>
    <li>
      <a href="maps1.html">Maps (1)</a>
    </li>
    <li>
      <a href="maps2.html">Maps (2)</a>
    </li>
    <li>
      <a href="geospatial.html">Geospatial analyses</a>
    </li>
    <li>
      <a href="correlation.html">Correlation and regression</a>
    </li>
    <li>
      <a href="prediction.html">Prediction</a>
    </li>
    <li>
      <a href="pca.html">PCA</a>
    </li>
    <li>
      <a href="svd.html">Singular Value Decomposistion</a>
    </li>
    <li>
      <a href="highdim.html">High-resolution &amp; high-dimensional data</a>
    </li>
    <li>
      <a href="multivariate.html">Multivariate methods</a>
    </li>
    <li>
      <a href="timeseries.html">Time-series analysis</a>
    </li>
    <li>
      <a href="otherlang.html">Other Languages</a>
    </li>
    <li class="dropdown-header">Other topics</li>
    <li>
      <a href="sf_stars_sftime.html">sf / stars / sftime</a>
    </li>
    <li>
      <a href="hdf5_intro.html">HDF in R</a>
    </li>
    <li>
      <a href="anomalies.html">Long-term means and anomalies</a>
    </li>
    <li>
      <a href="tsplots.html">Time-series plots</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Tasks
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li class="dropdown-header">Tasks</li>
    <li>
      <a href="installR.html">Install R and RStudio</a>
    </li>
    <li>
      <a href="Ex_UsingR.html">Using R exercise</a>
    </li>
    <li>
      <a href="install_netCDF.html">Install netCDF &amp; Panoply</a>
    </li>
    <li>
      <a href="transfer.html">File transfer</a>
    </li>
    <li>
      <a href="texteditor.html">Install a text editor</a>
    </li>
    <li>
      <a href="dataselection.html">Project data set selection</a>
    </li>
    <li>
      <a href="markdown.html">Markdown and RMarkdown</a>
    </li>
    <li>
      <a href="pandoc.html">Pandoc</a>
    </li>
    <li>
      <a href="GitHub.html">GitHub and UO pages.uoregon.edu</a>
    </li>
    <li>
      <a href="localweb.html">Local websites</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Other
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="readings.html">Readings</a>
    </li>
    <li>
      <a href="websites.html">Old course web pages</a>
    </li>
  </ul>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="about.html">About</a>
</li>
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div id="header">



<h1 class="title toc-ignore">Using R – Exercise</h1>

</div>


<script>
  addClassKlippyTo("pre.r, pre.markdown");
  addKlippy('right', 'top', 'auto', '1', 'Copy code', 'Copied!');
</script>
<p><span style="color: green;"><strong>NOTE:  This page has been revised
for the 2024 version of the course, but there may be some additional
edits.</strong>   <br></p>
<p><strong>Geography 4/590: R for Earth-System Science</strong><br />
<strong>Winter 2024</strong></p>
<p><strong>Exercise Using R</strong><br />
<strong>Finish by Monday, Jan 29</strong></p>
<p><strong>1. Introduction</strong></p>
<p>The aim of this exercise is to use R for doing some simple analyses
of “typical” Earth-system science data sets (with “typical” in quotes
because the data sets aren’t as big as many). The excersize parallels
the lecture presentation, and genrally involves the simple modification
of existing code (to, say, plot a different variable) than the creating
of new code. (But modification of existing code is generally what one
does.)</p>
<p>Note that the code below can be copied using the little clipboard
links, and pasted into RStudio. For this first exercise, opening a new R
script file (<code>*.R</code>) will probably be sufficient, but you may
wish to also experiment with an RMarkdown “Notebook” file, or a full
RMarkdown file. In RStudio, a new file can be created with the File &gt;
New File menu, or from the “new” icon on the toolbar. The first thing to
do is to save the file with a sensible name, and in a sensible place
(where you can find it again).</p>
<p><strong>2. Read data sets</strong></p>
<p>The first task is usually to read a data set, and this first part of
the exercise simply repeats the lecture material. There are two basic
sources for data to be read into R: 1) data (e.g. a .csv file or netCDF)
on disk (or from the web), and 2) an existing R workspace (i.e. a
<code>*.RData</code>) file that might contain, in addition to the input
data, function or intermediate results, for example.</p>
<p><em>Read a .csv file</em></p>
<p>Although it is possible to browse to a particular file in order to
open it (i.e. using the <code>file.choose()</code> function), for
reproducibility, it’s better to explicitly specify the source
(i.e. path) of the data. The following code reads a .csv file
<code>IPCC-RF.csv</code> that contains radiative forcing values for
various controls of global climate since 1750 CE, expressed in terms of
Wm<sup>-2</sup> contributions to the Earth’s preindustrial energy
balance. The data can be downloaded from <a
href="https://pages.uoregon.edu/bartlein//RESS/csv_files/IPCC_RF.csv">[https://pages.uoregon.edu/bartlein//RESS/csv_files/IPCC_RF.csv]</a>
by right-clicking on the link, and saving to a suitable directory.</p>
<p>Here, the file is assumed to have been dowloaded to the folder
<code>/Users/bartlein/projects/geog490/data/csv_files/</code>. (Note
that this folder is not necessarly the default working directory of R,
which can found using the function <code>getwd()</code>, or set using
<code>setwd("directory_name")</code>, where
<code>"directory_name"</code> is the name of the directory you wish to
set the working directory to.)</p>
<p>This is an example of reading the radiative forcing .csv file:
<em>Don’t actually run this–the data will be read in along with a lot of
other files in the next step.</em></p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a><span class="co"># read a .csv file</span></span>
<span id="cb1-2"><a href="#cb1-2" tabindex="-1"></a>csv_path <span class="ot">&lt;-</span> <span class="st">&quot;/Users/bartlein/projects/geog490/data/csv_files/&quot;</span></span>
<span id="cb1-3"><a href="#cb1-3" tabindex="-1"></a>csv_name <span class="ot">&lt;-</span> <span class="st">&quot;IPCC-RF.csv&quot;</span></span>
<span id="cb1-4"><a href="#cb1-4" tabindex="-1"></a>csv_file <span class="ot">&lt;-</span> <span class="fu">paste</span>(csv_path, csv_name, <span class="at">sep=</span><span class="st">&quot;&quot;</span>)</span>
<span id="cb1-5"><a href="#cb1-5" tabindex="-1"></a>IPCC_RF <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(csv_file)</span></code></pre></div>
<p><em>Load a saved .RData file (from the web)</em></p>
<p>An alternative way of reading data is to read in an entire workspace
(<code>*.RData</code>) at once. The following code reads those data from
the web, by opening a “connection” to a URL, and then using the
<code>load()</code> function (which also can be used to load a workspace
file from a local folder).</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" tabindex="-1"></a><span class="co"># load data from a saved .RData file</span></span>
<span id="cb2-2"><a href="#cb2-2" tabindex="-1"></a>con <span class="ot">&lt;-</span> <span class="fu">url</span>(<span class="st">&quot;https://pjbartlein.github.io/REarthSysSci/data/RData/geog490.RData&quot;</span>)</span>
<span id="cb2-3"><a href="#cb2-3" tabindex="-1"></a><span class="fu">load</span>(<span class="at">file=</span>con) </span></code></pre></div>
<p>Note how the “Environment” tab in RStudio has become populated with
individual objects.</p>
<p><strong>3. Data set summaries</strong></p>
<p>A quick look at the data can be gotten using the <code>str()</code>
(“structure”) function, and a five number” (plus the mean) summary of
the data can be gotten using the <code>summary()</code> function. Here
the data are the “SPECMAP” oxygen-isotope data that (more-or-less)
represent the size of the ice sheets over the past 800,000 yrs, along
with the values of insolation (incoming solar radiation) at 65N.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" tabindex="-1"></a><span class="fu">summary</span>(specmap)</span></code></pre></div>
<p>Other summary functions provide other basic information on a data
set:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" tabindex="-1"></a><span class="co"># other summaries</span></span>
<span id="cb4-2"><a href="#cb4-2" tabindex="-1"></a><span class="fu">names</span>(specmap)</span>
<span id="cb4-3"><a href="#cb4-3" tabindex="-1"></a><span class="fu">head</span>(specmap)</span>
<span id="cb4-4"><a href="#cb4-4" tabindex="-1"></a><span class="fu">tail</span>(specmap)</span></code></pre></div>
<p><strong>4. Simple visualization</strong></p>
<p><em>Univariate enumerative plots – Index plots</em></p>
<p>Here is the code for generating the index plot of oxygen-isotope
values from the <code>specmap</code> data set.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" tabindex="-1"></a><span class="co"># attach SPECMAP data, index plot</span></span>
<span id="cb5-2"><a href="#cb5-2" tabindex="-1"></a><span class="fu">attach</span>(specmap)</span>
<span id="cb5-3"><a href="#cb5-3" tabindex="-1"></a><span class="fu">plot</span>(O18)</span></code></pre></div>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" tabindex="-1"></a><span class="co"># time-series plot</span></span>
<span id="cb6-2"><a href="#cb6-2" tabindex="-1"></a><span class="fu">plot</span>(Age, O18, <span class="at">ylim=</span><span class="fu">c</span>(<span class="dv">2</span>, <span class="sc">-</span><span class="dv">2</span>), <span class="at">pch=</span><span class="dv">16</span>)</span></code></pre></div>
<p>And here’s the first task/question:</p>
<blockquote>
<p>Q1: Modify the above code to plot the variable
<code>specmap$Insol</code> instead of <code>specmap$O18</code>, and
describe the pattern of variability in that plot relative to the plot of
<code>O18</code>: Is it similar? More regularly periodic? Completely
random?</p>
</blockquote>
<p> </p>
<p>The answers don’t have to be elaborate, but should be full sentences,
with capitalization, punctuation, etc.</p>
<p><em>Univariate summary plots – stripcharts, histograms and density
plots</em></p>
<p>Here is the code for producing stripcharts, histograms and density
plots of the <code>O18</code> data.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" tabindex="-1"></a><span class="co"># stacked stripchart</span></span>
<span id="cb7-2"><a href="#cb7-2" tabindex="-1"></a><span class="fu">stripchart</span>(O18, <span class="at">method=</span><span class="st">&quot;stack&quot;</span>, <span class="at">pch=</span><span class="dv">16</span>, <span class="at">cex=</span><span class="fl">0.5</span>)   <span class="co"># stack points to reduce overlap</span></span></code></pre></div>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" tabindex="-1"></a><span class="co"># histogram, more bars</span></span>
<span id="cb8-2"><a href="#cb8-2" tabindex="-1"></a><span class="fu">hist</span>(O18, <span class="at">breaks =</span> <span class="dv">20</span>)</span></code></pre></div>
<blockquote>
<p>Q2: Modify the code above to product a stripchart or histogram for
<code>Insol</code>, being sure to experiment with the number of breaks.
What is the distribution of <code>Insol</code> like relative to that of
<code>O18</code>?</p>
</blockquote>
<p> </p>
<p>Here’s the code for a density plot:</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" tabindex="-1"></a><span class="co"># density plot, different bandwidth</span></span>
<span id="cb9-2"><a href="#cb9-2" tabindex="-1"></a>O18.density <span class="ot">&lt;-</span> <span class="fu">density</span>(O18, <span class="at">bw =</span> <span class="fl">0.10</span>)</span>
<span id="cb9-3"><a href="#cb9-3" tabindex="-1"></a><span class="fu">plot</span>(O18.density)</span></code></pre></div>
<blockquote>
<p>Q3: Once again, modify the code to get a density plot for
<code>Insol</code>. Is the density plot consitent with the information
provided by the histogram?</p>
</blockquote>
<p> </p>
<p>After finishing with an attached data set, it’s good practice to
detach it using <code>detach()</code>:</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" tabindex="-1"></a><span class="co"># detach specmap</span></span>
<span id="cb10-2"><a href="#cb10-2" tabindex="-1"></a><span class="fu">detach</span>(specmap)</span></code></pre></div>
<p><em>Univariate summary plots – boxplots</em></p>
<p>Before working on the <code>cirques</code> dataframe, attach it, and
get the names of the variables:</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" tabindex="-1"></a><span class="co"># attach cirques dataframe and getnames</span></span>
<span id="cb11-2"><a href="#cb11-2" tabindex="-1"></a><span class="fu">attach</span>(cirques)</span>
<span id="cb11-3"><a href="#cb11-3" tabindex="-1"></a><span class="fu">names</span>(cirques)</span></code></pre></div>
<p>This will produce a quick-and-dirty map of the data:</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" tabindex="-1"></a><span class="co"># simple map</span></span>
<span id="cb12-2"><a href="#cb12-2" tabindex="-1"></a><span class="fu">plot</span>(Lon, Lat, <span class="at">type=</span><span class="st">&quot;n&quot;</span>)</span>
<span id="cb12-3"><a href="#cb12-3" tabindex="-1"></a><span class="fu">points</span>(Lon, Lat, <span class="at">col=</span><span class="fu">as.factor</span>(Glacier))</span></code></pre></div>
<p>Here is the code for producing boxplots of elevation, as a function
of glaciation at present:</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" tabindex="-1"></a><span class="co"># boxplot of elevations of glaciated and not-glaciated cirques</span></span>
<span id="cb13-2"><a href="#cb13-2" tabindex="-1"></a><span class="fu">boxplot</span>(Elev <span class="sc">~</span> Glacier)</span></code></pre></div>
<blockquote>
<p>Q4: Modify the code above to produce paired (not-glaciated/glaciated)
boxplots for longitude and latitude. Keeping in mind that longitude
increases (i.e. becomes less negative) to the east, describe the spatial
distribution of glaciated cirques relative to unglaciated ones.</p>
</blockquote>
<p> </p>
<p><strong>5. Bivariate plots</strong></p>
<p><em>Scatter diagrams</em></p>
<p>Here is the code for plotting cirque elevation as a function of
longitude (i.e. longitude on the x-axis, elevation on the y-axis).</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" tabindex="-1"></a><span class="co"># cirques: Elev vs. Lon</span></span>
<span id="cb14-2"><a href="#cb14-2" tabindex="-1"></a><span class="fu">plot</span>(Elev <span class="sc">~</span> Lon, <span class="at">type=</span><span class="st">&quot;n&quot;</span>)</span>
<span id="cb14-3"><a href="#cb14-3" tabindex="-1"></a><span class="fu">points</span>(Elev <span class="sc">~</span> Lon, <span class="at">pch=</span><span class="dv">16</span>, <span class="at">col=</span><span class="fu">as.factor</span>(Glacier))</span></code></pre></div>
<blockquote>
<p>Q5: Examine the relationship between cirque elevation and latitude.
Is there any kind of systematic relationship, or is the relationship
completely random?</p>
</blockquote>
<p> </p>
<p><strong>6. Enhanced (ggplot2) graphics</strong></p>
<p>First, load some packages:</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" tabindex="-1"></a><span class="fu">library</span>(sf)</span>
<span id="cb15-2"><a href="#cb15-2" tabindex="-1"></a><span class="fu">library</span>(RColorBrewer)</span>
<span id="cb15-3"><a href="#cb15-3" tabindex="-1"></a><span class="fu">library</span>(classInt)</span></code></pre></div>
<p>The first package is the <code>sf</code> package, which handles
spatial data, <code>RColorBrewer</code> implements Cindy Brewer’s color
scales, and the third, <code>classInt</code> is a untility packages that
facilitates recoding continuous numerical data into factors (or class
intervals) for mapping.</p>
<p>Before continuing, it would be efficient to calculate a new variable,
the July:January precipitation ratio for the Oregon climate-station data
set. This can be conveniently done as follows, where the
<code>names()</code> function used to verify that the variable has been
added. (Note that if at the end of the current R session the workspace
is not saved, this new variable will go away.)</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" tabindex="-1"></a><span class="co"># new variable</span></span>
<span id="cb16-2"><a href="#cb16-2" tabindex="-1"></a>orstationc<span class="sc">$</span>pjulpjan <span class="ot">&lt;-</span> orstationc<span class="sc">$</span>pjul <span class="sc">/</span> orstationc<span class="sc">$</span>pjan</span>
<span id="cb16-3"><a href="#cb16-3" tabindex="-1"></a><span class="fu">names</span>(orstationc)</span></code></pre></div>
<p>Here is some code for plotting the new variable:</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" tabindex="-1"></a><span class="co"># load the `ggplot2` package</span></span>
<span id="cb17-2"><a href="#cb17-2" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span></code></pre></div>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" tabindex="-1"></a><span class="co"># ggplot2 histogram</span></span>
<span id="cb18-2"><a href="#cb18-2" tabindex="-1"></a><span class="fu">ggplot</span>(orstationc, <span class="fu">aes</span>(<span class="at">x=</span>pjulpjan)) <span class="sc">+</span> <span class="fu">geom_histogram</span>(<span class="at">binwidth =</span> <span class="fl">0.05</span>)</span></code></pre></div>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" tabindex="-1"></a><span class="co"># ggplot2 boxplots</span></span>
<span id="cb19-2"><a href="#cb19-2" tabindex="-1"></a><span class="fu">ggplot</span>(orstationc, <span class="fu">aes</span>(<span class="at">y =</span> pjulpjan)) <span class="sc">+</span> <span class="fu">geom_boxplot</span>() </span></code></pre></div>
<blockquote>
<p>Q6: Describe the distribution of <code>orstationc$pjulpjan</code>. Is
the distribution symmetric or not? Does the distribution of the
precipitation ratio explain the particular scale cutpoints that have
been used to map the precipitation ratio variables?</p>
</blockquote>
<p> </p>
<p>Plot the precipitation-ratio data again, this time transformed by
taking the logarithms (base 10) of the data:</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" tabindex="-1"></a><span class="co"># ggplot2 boxplots</span></span>
<span id="cb20-2"><a href="#cb20-2" tabindex="-1"></a><span class="fu">ggplot</span>(orstationc, <span class="fu">aes</span>(<span class="at">y =</span> <span class="fu">log10</span>(pjulpjan))) <span class="sc">+</span> <span class="fu">geom_boxplot</span>() </span></code></pre></div>
<blockquote>
<p>Q7: What does the log tranformation do to the distribution of the
precipitation-ratio data?</p>
</blockquote>
<p> </p>
<p>Next, take a look at the relationship between the precipitation-ratio
variable and elevation.</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" tabindex="-1"></a><span class="do">## ggplot2 scatter diagram of Oregon climate-station data</span></span>
<span id="cb21-2"><a href="#cb21-2" tabindex="-1"></a><span class="fu">ggplot</span>(orstationc, <span class="fu">aes</span>(elev, pjulpjan)) <span class="sc">+</span> <span class="fu">geom_point</span>() <span class="sc">+</span> <span class="fu">geom_smooth</span>(<span class="at">color =</span> <span class="st">&quot;blue&quot;</span>) <span class="sc">+</span></span>
<span id="cb21-3"><a href="#cb21-3" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">&quot;Elevation (m)&quot;</span>) <span class="sc">+</span> <span class="fu">ylab</span>(<span class="st">&quot;July:January Precipitation Ratio&quot;</span>) <span class="sc">+</span></span>
<span id="cb21-4"><a href="#cb21-4" tabindex="-1"></a>          <span class="fu">ggtitle</span>(<span class="st">&quot;Oregon Climate Station Data&quot;</span>)</span></code></pre></div>
<blockquote>
<p>Q8: Describe the relationship. One issue that might be influencing
this relationship is that there is a strong relationship between
longitude and elevation across the state. How might that be addressed by
simple plots?</p>
</blockquote>
<p> </p>
<p><strong>7. Maps with ggplot2</strong></p>
<p>The next code chunk plots the location of the Oregon climate-station
locations:</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" tabindex="-1"></a><span class="co"># ggplot2 map of Oregon climate-station locations</span></span>
<span id="cb22-2"><a href="#cb22-2" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb22-3"><a href="#cb22-3" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> orotl_sf, <span class="at">fill=</span><span class="cn">NA</span>) <span class="sc">+</span></span>
<span id="cb22-4"><a href="#cb22-4" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(orstations_sf<span class="sc">$</span>lon, orstations_sf<span class="sc">$</span>lat, <span class="at">color =</span> plot_factor), <span class="at">size =</span> <span class="fl">5.0</span>, <span class="at">col =</span> <span class="st">&quot;gray50&quot;</span>, <span class="at">pch=</span><span class="dv">16</span>) <span class="sc">+</span></span>
<span id="cb22-5"><a href="#cb22-5" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;Longitude&quot;</span>, <span class="at">y =</span> <span class="st">&quot;Latitude&quot;</span>) <span class="sc">+</span></span>
<span id="cb22-6"><a href="#cb22-6" tabindex="-1"></a>  <span class="fu">theme_bw</span>()</span></code></pre></div>
<p>There are two components to this map. The first is the basemap
outlines of Oregon counties, which are contained in the
<code>orotl_sf</code> “simple features” object. The contents of
<code>orotl_sf</code> can be viewed by simply typing
<code>orotl_sf</code> at the command line in the Console window, or
mapped using the following:</p>
<div class="sourceCode" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" tabindex="-1"></a><span class="co"># plot st_geometry of orotl_sf</span></span>
<span id="cb23-2"><a href="#cb23-2" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">st_geometry</span>(orotl_sf), <span class="at">axes =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<p>The second component is the <code>orstations_sf</code> object, which
contains the climate data itself:</p>
<div class="sourceCode" id="cb24"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" tabindex="-1"></a><span class="co"># plot st_geometry of orstations_sf</span></span>
<span id="cb24-2"><a href="#cb24-2" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">st_geometry</span>(orstations_sf), <span class="at">axes =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<p>Here’s a map of annual precipitation
<code>orstations_sf$pann</code>:</p>
<div class="sourceCode" id="cb25"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" tabindex="-1"></a><span class="co"># recode the annual precipitation data to a factor</span></span>
<span id="cb25-2"><a href="#cb25-2" tabindex="-1"></a>cutpts <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">200</span>,<span class="dv">500</span>,<span class="dv">1000</span>,<span class="dv">2000</span>,<span class="dv">9999</span>)</span>
<span id="cb25-3"><a href="#cb25-3" tabindex="-1"></a>plot_factor <span class="ot">&lt;-</span> <span class="fu">factor</span>(<span class="fu">findInterval</span>(orstations_sf<span class="sc">$</span>pann, cutpts))</span>
<span id="cb25-4"><a href="#cb25-4" tabindex="-1"></a>nclr <span class="ot">&lt;-</span> <span class="dv">5</span></span>
<span id="cb25-5"><a href="#cb25-5" tabindex="-1"></a>plotclr <span class="ot">&lt;-</span> <span class="fu">brewer.pal</span>(nclr<span class="sc">+</span><span class="dv">1</span>,<span class="st">&quot;BuPu&quot;</span>)[<span class="dv">2</span><span class="sc">:</span>(nclr<span class="sc">+</span><span class="dv">1</span>)]</span>
<span id="cb25-6"><a href="#cb25-6" tabindex="-1"></a></span>
<span id="cb25-7"><a href="#cb25-7" tabindex="-1"></a><span class="co"># get the map</span></span>
<span id="cb25-8"><a href="#cb25-8" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb25-9"><a href="#cb25-9" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> orotl_sf, <span class="at">fill=</span><span class="cn">NA</span>) <span class="sc">+</span></span>
<span id="cb25-10"><a href="#cb25-10" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(orstations_sf<span class="sc">$</span>lon, orstations_sf<span class="sc">$</span>lat, <span class="at">color =</span> plot_factor), <span class="at">size =</span> <span class="fl">5.0</span>, <span class="at">pch=</span><span class="dv">16</span>) <span class="sc">+</span></span>
<span id="cb25-11"><a href="#cb25-11" tabindex="-1"></a>  <span class="fu">scale_colour_manual</span>(<span class="at">values=</span>plotclr, <span class="at">aesthetics =</span> <span class="st">&quot;colour&quot;</span>,</span>
<span id="cb25-12"><a href="#cb25-12" tabindex="-1"></a>                      <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">&quot;0 - 200&quot;</span>, <span class="st">&quot;200 - 500&quot;</span>, <span class="st">&quot;500 - 1000&quot;</span>, <span class="st">&quot;1000 - 2000&quot;</span>, <span class="st">&quot;&gt; 2000&quot;</span>),</span>
<span id="cb25-13"><a href="#cb25-13" tabindex="-1"></a>                      <span class="at">name =</span> <span class="st">&quot;Ann. Precip.&quot;</span>, <span class="at">drop=</span><span class="cn">TRUE</span>) <span class="sc">+</span></span>
<span id="cb25-14"><a href="#cb25-14" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;Longitude&quot;</span>, <span class="at">y =</span> <span class="st">&quot;Latitude&quot;</span>) <span class="sc">+</span></span>
<span id="cb25-15"><a href="#cb25-15" tabindex="-1"></a>  <span class="fu">theme_bw</span>()</span></code></pre></div>
<p>The following code will plot the July:January precipitation ratio
data using <code>ggplot2</code>. First, recode the data to a factor
variable indicating the particular class interval each data value falls
in. (And note the (quasi) logarithmic scale used).</p>
<div class="sourceCode" id="cb26"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" tabindex="-1"></a><span class="co"># recode pjulpjan to a factor (note: cutpoints are general for Western N.A.)</span></span>
<span id="cb26-2"><a href="#cb26-2" tabindex="-1"></a>cutpts <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fl">0.0</span>, .<span class="dv">100</span>, .<span class="dv">200</span>, .<span class="dv">500</span>, .<span class="dv">800</span>, <span class="fl">1.0</span>, <span class="fl">1.25</span>, <span class="fl">2.0</span>, <span class="fl">5.0</span>, <span class="fl">10.0</span>)</span>
<span id="cb26-3"><a href="#cb26-3" tabindex="-1"></a>pjulpjan_factor <span class="ot">&lt;-</span> <span class="fu">factor</span>(<span class="fu">findInterval</span>(orstationc<span class="sc">$</span>pjulpjan, cutpts))</span>
<span id="cb26-4"><a href="#cb26-4" tabindex="-1"></a><span class="fu">head</span>(<span class="fu">cbind</span>(orstationc<span class="sc">$</span>pjulpjan, pjulpjan_factor, cutpts[pjulpjan_factor]))</span></code></pre></div>
<p>Here is code for the map:</p>
<div class="sourceCode" id="cb27"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" tabindex="-1"></a><span class="co"># ggplot2 map of pjulpjan</span></span>
<span id="cb27-2"><a href="#cb27-2" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb27-3"><a href="#cb27-3" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> orotl_sf, <span class="at">fill=</span><span class="cn">NA</span>) <span class="sc">+</span></span>
<span id="cb27-4"><a href="#cb27-4" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(orstations_sf<span class="sc">$</span>lon, orstations_sf<span class="sc">$</span>lat, <span class="at">color =</span> pjulpjan_factor), <span class="at">size =</span> <span class="fl">5.0</span>, <span class="at">pch=</span><span class="dv">16</span>) <span class="sc">+</span></span>
<span id="cb27-5"><a href="#cb27-5" tabindex="-1"></a>  <span class="fu">scale_color_brewer</span>(<span class="at">type =</span> <span class="st">&quot;div&quot;</span>, <span class="at">palette =</span> <span class="st">&quot;PRGn&quot;</span>, <span class="at">aesthetics =</span> <span class="st">&quot;color&quot;</span>, <span class="at">direction =</span> <span class="dv">1</span>,</span>
<span id="cb27-6"><a href="#cb27-6" tabindex="-1"></a>                     <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">&quot;0.0 - 0.1&quot;</span>, <span class="st">&quot;0.1 - 0.2&quot;</span>, <span class="st">&quot;0.2 - 0.5&quot;</span>, <span class="st">&quot;0.5 - 0.8&quot;</span>, <span class="st">&quot;0.8 - 1.0&quot;</span>,</span>
<span id="cb27-7"><a href="#cb27-7" tabindex="-1"></a>                                <span class="st">&quot;1.0 - 1.25&quot;</span>, <span class="st">&quot;1.25 - 2.0&quot;</span>, <span class="st">&quot;2.0 - 5.0&quot;</span>, <span class="st">&quot;5.0 - 10.0&quot;</span>, <span class="st">&quot;&gt; 10.0&quot;</span>),</span>
<span id="cb27-8"><a href="#cb27-8" tabindex="-1"></a>                     <span class="at">name =</span> <span class="st">&quot;Jul:Jan Ppt. Ratio&quot;</span>) <span class="sc">+</span></span>
<span id="cb27-9"><a href="#cb27-9" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;Longitude&quot;</span>, <span class="at">y =</span> <span class="st">&quot;Latitude&quot;</span>) <span class="sc">+</span></span>
<span id="cb27-10"><a href="#cb27-10" tabindex="-1"></a>  <span class="fu">theme_bw</span>()</span></code></pre></div>
<p>Note that the Purple to Green color scale spans the range of
precipitation-ratio data for the state, as opposed to the whole of the
western U.S.</p>
<blockquote>
<p>Q9: Describe the pattern of July:January precipitation ratios across
the state.</p>
</blockquote>
<p> </p>
<p><strong>8. Univariate statistics</strong></p>
<p>There are actually two versions of the Oregon climate station data in
the <code>geog490.RData</code> database: <code>orstations_sf</code> is a
“simple features” spatial object (and data.frame), while
<code>orstationc</code> is a simple data frame, read in from a .csv
file. The difference can be noted using the <code>class()</code> and
<code>head()</code> functions:</p>
<div class="sourceCode" id="cb28"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" tabindex="-1"></a><span class="co"># classes of orstation_sf and orstationc</span></span>
<span id="cb28-2"><a href="#cb28-2" tabindex="-1"></a><span class="fu">class</span>(orstations_sf)</span>
<span id="cb28-3"><a href="#cb28-3" tabindex="-1"></a><span class="fu">head</span>(orstations_sf)</span>
<span id="cb28-4"><a href="#cb28-4" tabindex="-1"></a><span class="fu">class</span>(orstationc)</span>
<span id="cb28-5"><a href="#cb28-5" tabindex="-1"></a><span class="fu">head</span>(orstationc)</span></code></pre></div>
<p>Generally, if there is any mapping to be done, the <code>sf</code>
(simple features) spatial data object is the preferred way to store the
data, but if the analysis focuses only on simple analyses, the
data.frame/spreadsheet format is fine.</p>
<p>Here is code for summarizing the <code>data.frame</code> version of
the Oregon climate-station data, which has spatial information in it,
but is not a spatial object like <code>orstation_sf</code>.</p>
<div class="sourceCode" id="cb29"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" tabindex="-1"></a><span class="co"># univariate descriptive statistics</span></span>
<span id="cb29-2"><a href="#cb29-2" tabindex="-1"></a><span class="fu">summary</span>(orstationc)</span></code></pre></div>
<p><strong>9. Bivariate descriptive statistics
(correlations)</strong></p>
<p>The following code produces a correlation matrix and
<code>corrplot()</code> graphical depiction of the matrix. Note the use
of the <code>round()</code> function to reduce the number of digits in
the correlation. “Unwrap” the <code>cor()</code> function to see what
the correlation matrix looks like unrounded.</p>
<div class="sourceCode" id="cb30"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" tabindex="-1"></a><span class="co"># correlations among Oregon climate-station variables</span></span>
<span id="cb30-2"><a href="#cb30-2" tabindex="-1"></a><span class="fu">round</span>(<span class="fu">cor</span>(orstationc[<span class="dv">2</span><span class="sc">:</span><span class="dv">10</span>]), <span class="dv">3</span>)</span></code></pre></div>
<div class="sourceCode" id="cb31"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" tabindex="-1"></a><span class="co"># corrplot of correlation matrix</span></span>
<span id="cb31-2"><a href="#cb31-2" tabindex="-1"></a><span class="fu">library</span>(corrplot)</span>
<span id="cb31-3"><a href="#cb31-3" tabindex="-1"></a><span class="fu">corrplot</span>(<span class="fu">cor</span>(orstationc[<span class="dv">2</span><span class="sc">:</span><span class="dv">10</span>]), <span class="at">method =</span> <span class="st">&quot;color&quot;</span>)</span></code></pre></div>
<p><strong>10. Parallel-coordinate plots</strong></p>
<p>Next, take a look at some parallel-coordinate plots for the Oregon
climate-station data. First, create a new datafram, eliminating the
character and x- and y-coordinate variables from the data frame. The the
use of the “square-bracket” selection method to grab specific columns
from the <code>orstationc</code> dataframe.</p>
<div class="sourceCode" id="cb32"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" tabindex="-1"></a><span class="co"># create new data frame without text</span></span>
<span id="cb32-2"><a href="#cb32-2" tabindex="-1"></a>orstationc2 <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(orstationc[<span class="dv">2</span><span class="sc">:</span><span class="dv">10</span>],orstationc[<span class="dv">15</span>])</span>
<span id="cb32-3"><a href="#cb32-3" tabindex="-1"></a><span class="fu">names</span>(orstationc2)</span></code></pre></div>
<p>Parallel-coordinate plots provide an elegant way to look for
structure in multiple-variable data sets, especially spatial data. The
plots are constructed by rescaling (0 to 1) the values of the individual
variables, and then connecting the values for individual cases or
observations with a line, with each variable represented by a “column”
in the plot. If there is any pattern (spatial or otherwise) in the data
groups of observations (individual lines) will show up, but if the data
are simply random, the parallel-coordinate plot will look like a
structureless jumble of lines.</p>
<p>Here is the code for a parallel-coordinate plot of the Oregon
climate-station data:</p>
<div class="sourceCode" id="cb33"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" tabindex="-1"></a><span class="co"># load library</span></span>
<span id="cb33-2"><a href="#cb33-2" tabindex="-1"></a><span class="fu">library</span>(GGally)</span>
<span id="cb33-3"><a href="#cb33-3" tabindex="-1"></a><span class="fu">library</span>(gridExtra)</span>
<span id="cb33-4"><a href="#cb33-4" tabindex="-1"></a></span>
<span id="cb33-5"><a href="#cb33-5" tabindex="-1"></a><span class="co"># parallel coordinate plot</span></span>
<span id="cb33-6"><a href="#cb33-6" tabindex="-1"></a><span class="fu">ggparcoord</span>(<span class="at">data =</span> orstationc2,</span>
<span id="cb33-7"><a href="#cb33-7" tabindex="-1"></a>  <span class="at">scale =</span> <span class="st">&quot;uniminmax&quot;</span>, <span class="at">alphaLines =</span> <span class="fl">0.1</span>) <span class="sc">+</span> <span class="fu">ylab</span>(<span class="st">&quot;&quot;</span>) <span class="sc">+</span></span>
<span id="cb33-8"><a href="#cb33-8" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text.x  =</span> <span class="fu">element_text</span>(<span class="at">angle=</span><span class="dv">315</span>, <span class="at">vjust=</span><span class="fl">1.0</span>, <span class="at">hjust=</span><span class="fl">0.0</span>, <span class="at">size=</span><span class="dv">10</span>),</span>
<span id="cb33-9"><a href="#cb33-9" tabindex="-1"></a>        <span class="at">axis.title.x =</span> <span class="fu">element_blank</span>(), </span>
<span id="cb33-10"><a href="#cb33-10" tabindex="-1"></a>        <span class="at">axis.text.y =</span> <span class="fu">element_blank</span>(), <span class="at">axis.ticks.y =</span> <span class="fu">element_blank</span>() )</span></code></pre></div>
<p>The plot is a little messy, but a prominant “M” pattern emerges shown
by high January and annual temperatures and low July temperatures.</p>
<p>Next, explore the spatial patterns of the Oregon climate-station data
(including the July:January precipitation-ratio variable). Here’s the
code for a selection of points by latitude/longitude ranges
(i.e. identifying stations in western Oregon):</p>
<div class="sourceCode" id="cb34"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" tabindex="-1"></a><span class="co"># lon/lat window</span></span>
<span id="cb34-2"><a href="#cb34-2" tabindex="-1"></a>lonmin <span class="ot">&lt;-</span> <span class="sc">-</span><span class="fl">125.0</span>; lonmax <span class="ot">&lt;-</span> <span class="sc">-</span><span class="fl">122.0</span>; latmin <span class="ot">&lt;-</span> <span class="fl">42.0</span>; latmax <span class="ot">&lt;-</span> <span class="fl">49.0</span></span>
<span id="cb34-3"><a href="#cb34-3" tabindex="-1"></a>lon <span class="ot">&lt;-</span> orstationc2<span class="sc">$</span>lon; lat <span class="ot">&lt;-</span> orstationc2<span class="sc">$</span>lat</span>
<span id="cb34-4"><a href="#cb34-4" tabindex="-1"></a>orstationc2<span class="sc">$</span>select_pts <span class="ot">&lt;-</span> <span class="fu">factor</span>(<span class="fu">ifelse</span>(lat <span class="sc">&gt;=</span> latmin <span class="sc">&amp;</span> lat <span class="sc">&lt;=</span> latmax <span class="sc">&amp;</span> lon <span class="sc">&gt;=</span> lonmin <span class="sc">&amp;</span> lon <span class="sc">&lt;=</span> lonmax, <span class="dv">1</span>, <span class="dv">0</span>))</span>
<span id="cb34-5"><a href="#cb34-5" tabindex="-1"></a></span>
<span id="cb34-6"><a href="#cb34-6" tabindex="-1"></a><span class="co"># pcp</span></span>
<span id="cb34-7"><a href="#cb34-7" tabindex="-1"></a>a <span class="ot">&lt;-</span> <span class="fu">ggparcoord</span>(<span class="at">data =</span> orstationc2[<span class="fu">order</span>(orstationc2<span class="sc">$</span>select_pts),],</span>
<span id="cb34-8"><a href="#cb34-8" tabindex="-1"></a>                <span class="at">columns =</span> <span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>), <span class="at">groupColumn =</span> <span class="st">&quot;select_pts&quot;</span>,</span>
<span id="cb34-9"><a href="#cb34-9" tabindex="-1"></a>                <span class="at">scale =</span> <span class="st">&quot;uniminmax&quot;</span>, <span class="at">alphaLines=</span><span class="fl">0.3</span>) <span class="sc">+</span> <span class="fu">ylab</span>(<span class="st">&quot;&quot;</span>) <span class="sc">+</span></span>
<span id="cb34-10"><a href="#cb34-10" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text.x  =</span> <span class="fu">element_text</span>(<span class="at">angle=</span><span class="dv">315</span>, <span class="at">vjust=</span><span class="fl">1.0</span>, <span class="at">hjust=</span><span class="fl">0.0</span>, <span class="at">size=</span><span class="dv">8</span>),</span>
<span id="cb34-11"><a href="#cb34-11" tabindex="-1"></a>        <span class="at">axis.title.x =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb34-12"><a href="#cb34-12" tabindex="-1"></a>        <span class="at">axis.text.y =</span> <span class="fu">element_blank</span>(), <span class="at">axis.ticks.y =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb34-13"><a href="#cb34-13" tabindex="-1"></a>        <span class="at">legend.position =</span> <span class="st">&quot;none&quot;</span>) <span class="sc">+</span></span>
<span id="cb34-14"><a href="#cb34-14" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="fu">rgb</span>(<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="fl">0.3</span>), <span class="st">&quot;red&quot;</span>))</span>
<span id="cb34-15"><a href="#cb34-15" tabindex="-1"></a></span>
<span id="cb34-16"><a href="#cb34-16" tabindex="-1"></a><span class="co"># map</span></span>
<span id="cb34-17"><a href="#cb34-17" tabindex="-1"></a>b <span class="ot">&lt;-</span> <span class="fu">ggplot</span>()  <span class="sc">+</span></span>
<span id="cb34-18"><a href="#cb34-18" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> orotl_sf, <span class="at">fill=</span><span class="cn">NA</span>) <span class="sc">+</span></span>
<span id="cb34-19"><a href="#cb34-19" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(orstations_sf<span class="sc">$</span>lon, orstations_sf<span class="sc">$</span>lat, <span class="at">color =</span> orstationc2<span class="sc">$</span>select_pts), <span class="at">size =</span> <span class="fl">4.0</span>, <span class="at">pch=</span><span class="dv">16</span>) <span class="sc">+</span></span>
<span id="cb34-20"><a href="#cb34-20" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb34-21"><a href="#cb34-21" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">&quot;none&quot;</span>) <span class="sc">+</span></span>
<span id="cb34-22"><a href="#cb34-22" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">&quot;gray&quot;</span>, <span class="st">&quot;red&quot;</span>))</span>
<span id="cb34-23"><a href="#cb34-23" tabindex="-1"></a></span>
<span id="cb34-24"><a href="#cb34-24" tabindex="-1"></a><span class="fu">grid.arrange</span>(a, b, <span class="at">nrow =</span> <span class="dv">1</span>)</span></code></pre></div>
<p>And here is the code for a variable-value selection, where the
station (point) selection identifies stations with high July to January
precipitation ratios:</p>
<div class="sourceCode" id="cb35"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" tabindex="-1"></a><span class="co"># variable-value selection</span></span>
<span id="cb35-2"><a href="#cb35-2" tabindex="-1"></a>cutpoint <span class="ot">&lt;-</span> <span class="fl">0.2</span></span>
<span id="cb35-3"><a href="#cb35-3" tabindex="-1"></a>v <span class="ot">&lt;-</span> orstationc2<span class="sc">$</span>pjulpjan</span>
<span id="cb35-4"><a href="#cb35-4" tabindex="-1"></a>v <span class="ot">&lt;-</span> (v<span class="sc">-</span><span class="fu">min</span>(v))<span class="sc">/</span>(<span class="fu">max</span>(v)<span class="sc">-</span><span class="fu">min</span>(v))</span>
<span id="cb35-5"><a href="#cb35-5" tabindex="-1"></a>select_pts <span class="ot">&lt;-</span> <span class="fu">factor</span>(<span class="fu">ifelse</span>(v <span class="sc">&gt;=</span> cutpoint, <span class="dv">1</span>, <span class="dv">0</span>))</span>
<span id="cb35-6"><a href="#cb35-6" tabindex="-1"></a></span>
<span id="cb35-7"><a href="#cb35-7" tabindex="-1"></a><span class="co"># pcp</span></span>
<span id="cb35-8"><a href="#cb35-8" tabindex="-1"></a>a <span class="ot">&lt;-</span> <span class="fu">ggparcoord</span>(<span class="at">data =</span> orstationc2[<span class="fu">order</span>(orstationc2<span class="sc">$</span>select_pts),],</span>
<span id="cb35-9"><a href="#cb35-9" tabindex="-1"></a>                <span class="at">columns =</span> <span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>), <span class="at">groupColumn =</span> <span class="st">&quot;select_pts&quot;</span>,</span>
<span id="cb35-10"><a href="#cb35-10" tabindex="-1"></a>                <span class="at">scale =</span> <span class="st">&quot;uniminmax&quot;</span>, <span class="at">alphaLines=</span><span class="fl">0.3</span>) <span class="sc">+</span> <span class="fu">ylab</span>(<span class="st">&quot;&quot;</span>) <span class="sc">+</span></span>
<span id="cb35-11"><a href="#cb35-11" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text.x  =</span> <span class="fu">element_text</span>(<span class="at">angle=</span><span class="dv">315</span>, <span class="at">vjust=</span><span class="fl">1.0</span>, <span class="at">hjust=</span><span class="fl">0.0</span>, <span class="at">size=</span><span class="dv">8</span>),</span>
<span id="cb35-12"><a href="#cb35-12" tabindex="-1"></a>        <span class="at">axis.title.x =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb35-13"><a href="#cb35-13" tabindex="-1"></a>        <span class="at">axis.text.y =</span> <span class="fu">element_blank</span>(), <span class="at">axis.ticks.y =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb35-14"><a href="#cb35-14" tabindex="-1"></a>        <span class="at">legend.position =</span> <span class="st">&quot;none&quot;</span>) <span class="sc">+</span></span>
<span id="cb35-15"><a href="#cb35-15" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="fu">rgb</span>(<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="fl">0.3</span>), <span class="st">&quot;red&quot;</span>))</span>
<span id="cb35-16"><a href="#cb35-16" tabindex="-1"></a></span>
<span id="cb35-17"><a href="#cb35-17" tabindex="-1"></a><span class="co"># map</span></span>
<span id="cb35-18"><a href="#cb35-18" tabindex="-1"></a>b <span class="ot">&lt;-</span> <span class="fu">ggplot</span>()  <span class="sc">+</span></span>
<span id="cb35-19"><a href="#cb35-19" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> orotl_sf, <span class="at">fill=</span><span class="cn">NA</span>) <span class="sc">+</span></span>
<span id="cb35-20"><a href="#cb35-20" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(orstations_sf<span class="sc">$</span>lon, orstations_sf<span class="sc">$</span>lat, <span class="at">color =</span> select_pts), <span class="at">size =</span> <span class="fl">4.0</span>, <span class="at">pch=</span><span class="dv">16</span>) <span class="sc">+</span></span>
<span id="cb35-21"><a href="#cb35-21" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb35-22"><a href="#cb35-22" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">&quot;none&quot;</span>) <span class="sc">+</span></span>
<span id="cb35-23"><a href="#cb35-23" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">&quot;gray&quot;</span>, <span class="st">&quot;red&quot;</span>))</span>
<span id="cb35-24"><a href="#cb35-24" tabindex="-1"></a></span>
<span id="cb35-25"><a href="#cb35-25" tabindex="-1"></a><span class="fu">grid.arrange</span>(a, b, <span class="at">nrow =</span> <span class="dv">1</span>, <span class="at">ncol =</span> <span class="dv">2</span>)</span></code></pre></div>
<p>Experiment with the longitudinal cutoff, as well as different
variables for selecting points.</p>
<blockquote>
<p>Q10: Describe the seasonality of precipitation and temperature across
the state. Don’t worry if that’s hard to put into words–data-analytical
visualizations are possibly the best instance of the “One picture is
worth a thousand words.” maxim.</p>
</blockquote>




</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.odd').parent('tbody').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open');
  });
});
</script>

<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
