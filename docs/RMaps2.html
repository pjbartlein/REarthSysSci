<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />




<title>Maps in R (2)</title>

<script src="site_libs/header-attrs-2.25/header-attrs.js"></script>
<script src="site_libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/cosmo.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<style>h1 {font-size: 34px;}
       h1.title {font-size: 38px;}
       h2 {font-size: 30px;}
       h3 {font-size: 24px;}
       h4 {font-size: 18px;}
       h5 {font-size: 16px;}
       h6 {font-size: 12px;}
       code {color: inherit; background-color: rgba(0, 0, 0, 0.04);}
       pre:not([class]) { background-color: white }</style>
<script src="site_libs/navigation-1.1/tabsets.js"></script>

<style type="text/css">
  code{white-space: pre-wrap;}
  span.smallcaps{font-variant: small-caps;}
  span.underline{text-decoration: underline;}
  div.column{display: inline-block; vertical-align: top; width: 50%;}
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  ul.task-list{list-style: none;}
    </style>



<style type="text/css">
  code {
    white-space: pre;
  }
  .sourceCode {
    overflow: visible;
  }
</style>
<style type="text/css" data-origin="pandoc">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; } /* Alert */
code span.an { color: #008000; } /* Annotation */
code span.at { } /* Attribute */
code span.bu { } /* BuiltIn */
code span.cf { color: #0000ff; } /* ControlFlow */
code span.ch { color: #008080; } /* Char */
code span.cn { } /* Constant */
code span.co { color: #008000; } /* Comment */
code span.cv { color: #008000; } /* CommentVar */
code span.do { color: #008000; } /* Documentation */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.im { } /* Import */
code span.in { color: #008000; } /* Information */
code span.kw { color: #0000ff; } /* Keyword */
code span.op { } /* Operator */
code span.ot { color: #ff4000; } /* Other */
code span.pp { color: #ff4000; } /* Preprocessor */
code span.sc { color: #008080; } /* SpecialChar */
code span.ss { color: #008080; } /* SpecialString */
code span.st { color: #008080; } /* String */
code span.va { } /* Variable */
code span.vs { color: #008080; } /* VerbatimString */
code span.wa { color: #008000; font-weight: bold; } /* Warning */

</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    var j = 0;
    while (j < rules.length) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") {
        j++;
        continue;
      }
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' && rule.style.backgroundColor === '') {
        j++;
        continue;
      }
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>




<link rel="stylesheet" href="html-md-01.css" type="text/css" />



<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
img {
  max-width:100%;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
details > summary > p:only-child {
  display: inline;
}
pre code {
  padding: 0;
}
</style>


<style type="text/css">
.dropdown-submenu {
  position: relative;
}
.dropdown-submenu>.dropdown-menu {
  top: 0;
  left: 100%;
  margin-top: -6px;
  margin-left: -1px;
  border-radius: 0 6px 6px 6px;
}
.dropdown-submenu:hover>.dropdown-menu {
  display: block;
}
.dropdown-submenu>a:after {
  display: block;
  content: " ";
  float: right;
  width: 0;
  height: 0;
  border-color: transparent;
  border-style: solid;
  border-width: 5px 0 5px 5px;
  border-left-color: #cccccc;
  margin-top: 5px;
  margin-right: -10px;
}
.dropdown-submenu:hover>a:after {
  border-left-color: #adb5bd;
}
.dropdown-submenu.pull-left {
  float: none;
}
.dropdown-submenu.pull-left>.dropdown-menu {
  left: -100%;
  margin-left: 10px;
  border-radius: 6px 0 6px 6px;
}
</style>

<script type="text/javascript">
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark the anchor link active (and if it's in a dropdown, also mark that active)
  var dropdown = menuAnchor.closest('li.dropdown');
  if (window.bootstrap) { // Bootstrap 4+
    menuAnchor.addClass('active');
    dropdown.find('> .dropdown-toggle').addClass('active');
  } else { // Bootstrap 3
    menuAnchor.parent().addClass('active');
    dropdown.addClass('active');
  }

  // Navbar adjustments
  var navHeight = $(".navbar").first().height() + 15;
  var style = document.createElement('style');
  var pt = "padding-top: " + navHeight + "px; ";
  var mt = "margin-top: -" + navHeight + "px; ";
  var css = "";
  // offset scroll position for anchor links (for fixed navbar)
  for (var i = 1; i <= 6; i++) {
    css += ".section h" + i + "{ " + pt + mt + "}\n";
  }
  style.innerHTML = "body {" + pt + "padding-bottom: 40px; }\n" + css;
  document.head.appendChild(style);
});
</script>

<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before, .tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "\e259";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "\e258";
  font-family: 'Glyphicons Halflings';
  border: none;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
  background-color: transparent;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<!-- code folding -->




</head>

<body>


<div class="container-fluid main-container">




<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-bs-toggle="collapse" data-target="#navbar" data-bs-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">R for Earth-System Science</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="overview.html">Overview</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Topics
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li class="dropdown-header">Lecture topics</li>
    <li>
      <a href="intro.html">Introduction: R, RStudio, and other infrastructure</a>
    </li>
    <li>
      <a href="usingR.html">Using R</a>
    </li>
    <li>
      <a href="ESSdata.html">Earth-system science data</a>
    </li>
    <li>
      <a href="netCDF.html">netCDF in R</a>
    </li>
    <li>
      <a href="raster_intro.html">raster and netCDF in R</a>
    </li>
    <li>
      <a href="hdf5_intro.html">HDF in R</a>
    </li>
    <li>
      <a href="geospatial.html">Geospatial analyses</a>
    </li>
    <li>
      <a href="RMaps.html">Maps in R</a>
    </li>
    <li>
      <a href="RMaps2.html">Maps in R (2)</a>
    </li>
    <li>
      <a href="rasterVis01.html">Visualization:  raster and rasterVis</a>
    </li>
    <li>
      <a href="vis_ggplot01.html">Visualization for explanation</a>
    </li>
    <li>
      <a href="highdim.html">Visualization of high-dimensional data</a>
    </li>
    <li>
      <a href="PCA.html">Principal components analysis</a>
    </li>
    <li>
      <a href="multivariate.html">Other multivariate analyses</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Tasks
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="geog495_ex01.html">Install R and RStudio</a>
    </li>
    <li>
      <a href="packages-and-data.html">Install packages and data</a>
    </li>
    <li>
      <a href="GitHub.html">Git and GitHub</a>
    </li>
    <li>
      <a href="Ex_UsingR.html">Using R exercise</a>
    </li>
    <li>
      <a href="markdown.html">Markdown and RMarkdown</a>
    </li>
    <li>
      <a href="install_netCDF.html">Install netCDF</a>
    </li>
    <li>
      <a href="install_Panoply.html">Install Panoply</a>
    </li>
    <li>
      <a href="transfer.html">File transfer</a>
    </li>
    <li>
      <a href="project.html">GitHub project repository and web page</a>
    </li>
    <li>
      <a href="ltms-and-anomalies.html">Long-term means and anomalies</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Resources
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="readings.html">Readings</a>
    </li>
    <li>
      <a href="websites.html">Old course web pages</a>
    </li>
  </ul>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="about.html">About</a>
</li>
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div id="header">



<h1 class="title toc-ignore">Maps in R (2)</h1>

</div>

<div id="TOC">
<ul>
<li><a href="#a-second-example" id="toc-a-second-example"><span
class="toc-section-number">1</span> A second example</a>
<ul>
<li><a href="#read-the-natural-earth-shapefiles"
id="toc-read-the-natural-earth-shapefiles"><span
class="toc-section-number">1.1</span> Read the Natural Earth
shapefiles</a></li>
<li><a href="#project-the-shape-files"
id="toc-project-the-shape-files"><span
class="toc-section-number">1.2</span> Project the shape files</a></li>
<li><a href="#write-out-the-projected-and-trimmed-shape-files"
id="toc-write-out-the-projected-and-trimmed-shape-files"><span
class="toc-section-number">1.3</span> Write out the projected and
trimmed shape files</a></li>
</ul></li>
<li><a href="#map-of-north-american-shaded-relief"
id="toc-map-of-north-american-shaded-relief"><span
class="toc-section-number">2</span> Map of North American shaded
relief</a>
<ul>
<li><a href="#read-the-read-the-projected-and-trimmed-shapefiles"
id="toc-read-the-read-the-projected-and-trimmed-shapefiles"><span
class="toc-section-number">2.1</span> Read the read the projected and
trimmed shapefiles</a></li>
<li><a href="#read-a-shaded-relief-file"
id="toc-read-a-shaded-relief-file"><span
class="toc-section-number">2.2</span> Read a shaded relief file</a></li>
<li><a href="#make-the-map" id="toc-make-the-map"><span
class="toc-section-number">2.3</span> Make the map</a></li>
</ul></li>
</ul>
</div>

<div id="a-second-example" class="section level1" number="1">
<h1><span class="header-section-number">1</span> A second example</h1>
<p>This second example illustrates the creating of a base map for North
America that conforms to the projection used for the
<code>na10km_v2</code> data. As before, <em>Natural Earth</em>
shapefiles are read and projected, this time using a Lambert Azimuthal
Equal-Area projection, and trimmed to the appropriate region.</p>
<div id="read-the-natural-earth-shapefiles" class="section level2"
number="1.1">
<h2><span class="header-section-number">1.1</span> Read the Natural
Earth shapefiles</h2>
<p>Load the appropriate packages.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a><span class="fu">library</span>(maptools)</span>
<span id="cb1-2"><a href="#cb1-2" tabindex="-1"></a><span class="fu">library</span>(sp)</span>
<span id="cb1-3"><a href="#cb1-3" tabindex="-1"></a><span class="fu">library</span>(rgdal)</span>
<span id="cb1-4"><a href="#cb1-4" tabindex="-1"></a><span class="fu">library</span>(raster)</span>
<span id="cb1-5"><a href="#cb1-5" tabindex="-1"></a><span class="fu">library</span>(rgeos)</span>
<span id="cb1-6"><a href="#cb1-6" tabindex="-1"></a><span class="fu">library</span>(lattice)</span></code></pre></div>
<p>Set the shapefile names, including those for global coastlines,
adminstrative units (borders). Set the filenames:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" tabindex="-1"></a><span class="co"># Natural Earth shape files -- global (Robinson) projections</span></span>
<span id="cb2-2"><a href="#cb2-2" tabindex="-1"></a><span class="co"># get shapefiles from http://www.naturalearthdata.com</span></span>
<span id="cb2-3"><a href="#cb2-3" tabindex="-1"></a>shape_path <span class="ot">&lt;-</span> <span class="st">&quot;/Users/bartlein/Projects/ESSD/data/RMaps/source/&quot;</span></span>
<span id="cb2-4"><a href="#cb2-4" tabindex="-1"></a>coast_shapefile <span class="ot">&lt;-</span> <span class="fu">paste</span>(shape_path, <span class="st">&quot;ne_10m_coastline/ne_10m_coastline.shp&quot;</span>, <span class="at">sep=</span><span class="st">&quot;&quot;</span>)</span>
<span id="cb2-5"><a href="#cb2-5" tabindex="-1"></a>admin0_shapefile <span class="ot">&lt;-</span> <span class="fu">paste</span>(shape_path, <span class="st">&quot;ne_10m_admin_0_countries/ne_10m_admin_0_countries.shp&quot;</span>, <span class="at">sep=</span><span class="st">&quot;&quot;</span>)</span>
<span id="cb2-6"><a href="#cb2-6" tabindex="-1"></a>admin1_shapefile <span class="ot">&lt;-</span> <span class="fu">paste</span>(shape_path, <span class="st">&quot;ne_10m_admin_1_states_provinces_lakes/ne_10m_admin_1_states_provinces_lakes.shp&quot;</span>, <span class="at">sep=</span><span class="st">&quot;&quot;</span>)</span>
<span id="cb2-7"><a href="#cb2-7" tabindex="-1"></a>lakes_shapefile <span class="ot">&lt;-</span> <span class="fu">paste</span>(shape_path, <span class="st">&quot;ne_10m_lakes/ne_10m_lakes.shp&quot;</span>, <span class="at">sep=</span><span class="st">&quot;&quot;</span>)</span></code></pre></div>
<p>Read and plot the shapefiles (note: summary output is suppressed)</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" tabindex="-1"></a>layer <span class="ot">&lt;-</span> <span class="fu">ogrListLayers</span>(coast_shapefile)</span>
<span id="cb3-2"><a href="#cb3-2" tabindex="-1"></a><span class="fu">ogrInfo</span>(coast_shapefile, <span class="at">layer=</span>layer)</span>
<span id="cb3-3"><a href="#cb3-3" tabindex="-1"></a>coast_lines <span class="ot">&lt;-</span> <span class="fu">readOGR</span>(coast_shapefile, <span class="at">layer=</span>layer)</span>
<span id="cb3-4"><a href="#cb3-4" tabindex="-1"></a><span class="fu">summary</span>(coast_lines)  </span>
<span id="cb3-5"><a href="#cb3-5" tabindex="-1"></a><span class="fu">plot</span>(coast_lines)</span>
<span id="cb3-6"><a href="#cb3-6" tabindex="-1"></a></span>
<span id="cb3-7"><a href="#cb3-7" tabindex="-1"></a>layer <span class="ot">&lt;-</span> <span class="fu">ogrListLayers</span>(admin0_shapefile)</span>
<span id="cb3-8"><a href="#cb3-8" tabindex="-1"></a><span class="fu">ogrInfo</span>(admin0_shapefile, <span class="at">layer=</span>layer)</span>
<span id="cb3-9"><a href="#cb3-9" tabindex="-1"></a>admin0_poly <span class="ot">&lt;-</span> <span class="fu">readOGR</span>(admin0_shapefile, <span class="at">layer=</span>layer)</span>
<span id="cb3-10"><a href="#cb3-10" tabindex="-1"></a><span class="fu">summary</span>(admin0_poly)  </span>
<span id="cb3-11"><a href="#cb3-11" tabindex="-1"></a><span class="fu">plot</span>(admin0_poly, <span class="at">bor=</span><span class="st">&quot;gray&quot;</span>, <span class="at">add=</span><span class="cn">TRUE</span>)</span>
<span id="cb3-12"><a href="#cb3-12" tabindex="-1"></a></span>
<span id="cb3-13"><a href="#cb3-13" tabindex="-1"></a>layer <span class="ot">&lt;-</span> <span class="fu">ogrListLayers</span>(admin1_shapefile)</span>
<span id="cb3-14"><a href="#cb3-14" tabindex="-1"></a><span class="fu">ogrInfo</span>(admin1_shapefile, <span class="at">layer=</span>layer)</span>
<span id="cb3-15"><a href="#cb3-15" tabindex="-1"></a>admin1_poly <span class="ot">&lt;-</span> <span class="fu">readOGR</span>(admin1_shapefile, <span class="at">layer=</span>layer)</span>
<span id="cb3-16"><a href="#cb3-16" tabindex="-1"></a><span class="fu">summary</span>(admin1_poly)  </span>
<span id="cb3-17"><a href="#cb3-17" tabindex="-1"></a><span class="fu">plot</span>(admin1_poly, <span class="at">bor=</span><span class="st">&quot;lightgreen&quot;</span>, <span class="at">add=</span><span class="cn">TRUE</span>)</span>
<span id="cb3-18"><a href="#cb3-18" tabindex="-1"></a></span>
<span id="cb3-19"><a href="#cb3-19" tabindex="-1"></a>layer <span class="ot">&lt;-</span> <span class="fu">ogrListLayers</span>(lakes_shapefile)</span>
<span id="cb3-20"><a href="#cb3-20" tabindex="-1"></a><span class="fu">ogrInfo</span>(lakes_shapefile, <span class="at">layer=</span>layer)</span>
<span id="cb3-21"><a href="#cb3-21" tabindex="-1"></a>lakes_poly <span class="ot">&lt;-</span> <span class="fu">readOGR</span>(lakes_shapefile, <span class="at">layer=</span>layer)</span>
<span id="cb3-22"><a href="#cb3-22" tabindex="-1"></a><span class="fu">summary</span>(lakes_poly)  </span>
<span id="cb3-23"><a href="#cb3-23" tabindex="-1"></a><span class="fu">plot</span>(lakes_poly, <span class="at">bor=</span><span class="st">&quot;lightblue&quot;</span>, <span class="at">add=</span><span class="cn">TRUE</span>)</span>
<span id="cb3-24"><a href="#cb3-24" tabindex="-1"></a></span>
<span id="cb3-25"><a href="#cb3-25" tabindex="-1"></a>lrglakes_poly <span class="ot">&lt;-</span> lakes_poly[<span class="fu">as.numeric</span>(lakes_poly<span class="sc">$</span>scalerank) <span class="sc">&lt;=</span> <span class="dv">2</span> ,]</span>
<span id="cb3-26"><a href="#cb3-26" tabindex="-1"></a><span class="fu">plot</span>(lrglakes_poly, <span class="at">bor=</span><span class="st">&quot;purple&quot;</span>, <span class="at">add=</span><span class="cn">TRUE</span>)</span></code></pre></div>
<p>Take a look at the <code>admin1_poly</code> dataframe, to figure out
the codes for Candadian and U.S. provincial and state borders.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" tabindex="-1"></a><span class="fu">head</span>(admin0_poly)</span></code></pre></div>
<p>The approprate code to extract the U.S. and Canada data is
<code>admin1_poly$sr_sov_a3 == "CAN"</code> and
<code>admin1_poly$sr_sov_a3 == "US1"</code>. Extract the borders, and
plot the resulting shapefiles.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" tabindex="-1"></a>can_poly <span class="ot">&lt;-</span> admin1_poly[admin1_poly<span class="sc">$</span>sov_a3 <span class="sc">==</span> <span class="st">&quot;CAN&quot;</span> ,]</span>
<span id="cb5-2"><a href="#cb5-2" tabindex="-1"></a>us_poly <span class="ot">&lt;-</span> admin1_poly[admin1_poly<span class="sc">$</span>sov_a3 <span class="sc">==</span> <span class="st">&quot;US1&quot;</span>,]</span>
<span id="cb5-3"><a href="#cb5-3" tabindex="-1"></a><span class="fu">plot</span>(coast_lines)</span>
<span id="cb5-4"><a href="#cb5-4" tabindex="-1"></a><span class="fu">plot</span>(can_poly, <span class="at">bor=</span><span class="st">&quot;red&quot;</span>, <span class="at">add=</span><span class="cn">TRUE</span>)</span>
<span id="cb5-5"><a href="#cb5-5" tabindex="-1"></a><span class="fu">plot</span>(us_poly, <span class="at">bor=</span><span class="st">&quot;blue&quot;</span>, <span class="at">add=</span><span class="cn">TRUE</span>)</span></code></pre></div>
<p>Convert the U.S. and Canada polygons to
<code>SpatialLines</code>:</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" tabindex="-1"></a>can_lines <span class="ot">&lt;-</span> <span class="fu">as</span>(can_poly, <span class="st">&quot;SpatialLines&quot;</span>)</span>
<span id="cb6-2"><a href="#cb6-2" tabindex="-1"></a>us_lines <span class="ot">&lt;-</span> <span class="fu">as</span>(us_poly, <span class="st">&quot;SpatialLines&quot;</span>)</span></code></pre></div>
</div>
<div id="project-the-shape-files" class="section level2" number="1.2">
<h2><span class="header-section-number">1.2</span> Project the shape
files</h2>
<p>Set the <code>proj4string</code> value and the coordinate reference
system for the na10km_v2 grid:</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" tabindex="-1"></a>na_proj4string <span class="ot">&lt;-</span> <span class="st">&quot;+proj=laea +lon_0=-100 +lat_0=50 +x_0=0 +y_0=0 +ellps=WGS84 +datum=WGS84 +units=m +no_defs&quot;</span></span>
<span id="cb7-2"><a href="#cb7-2" tabindex="-1"></a>na_crs <span class="ot">=</span> <span class="fu">CRS</span>(na_proj4string)</span></code></pre></div>
<p>Project the various shapefiles (and plot the coastlines as an
example):</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" tabindex="-1"></a>coast_lines_proj <span class="ot">&lt;-</span><span class="fu">spTransform</span>(coast_lines, na_crs)</span>
<span id="cb8-2"><a href="#cb8-2" tabindex="-1"></a>admin0_poly_proj <span class="ot">&lt;-</span><span class="fu">spTransform</span>(admin0_poly, na_crs)</span>
<span id="cb8-3"><a href="#cb8-3" tabindex="-1"></a>admin1_poly_proj <span class="ot">&lt;-</span><span class="fu">spTransform</span>(admin1_poly, na_crs)</span>
<span id="cb8-4"><a href="#cb8-4" tabindex="-1"></a>lakes_poly_proj <span class="ot">&lt;-</span><span class="fu">spTransform</span>(lakes_poly, na_crs)</span>
<span id="cb8-5"><a href="#cb8-5" tabindex="-1"></a>lrglakes_poly_proj <span class="ot">&lt;-</span><span class="fu">spTransform</span>(lrglakes_poly, na_crs)</span>
<span id="cb8-6"><a href="#cb8-6" tabindex="-1"></a>can_poly_proj <span class="ot">&lt;-</span><span class="fu">spTransform</span>(can_poly, na_crs)</span>
<span id="cb8-7"><a href="#cb8-7" tabindex="-1"></a>us_poly_proj <span class="ot">&lt;-</span><span class="fu">spTransform</span>(us_poly, na_crs)</span>
<span id="cb8-8"><a href="#cb8-8" tabindex="-1"></a>can_lines_proj <span class="ot">&lt;-</span><span class="fu">spTransform</span>(can_lines, na_crs)</span>
<span id="cb8-9"><a href="#cb8-9" tabindex="-1"></a>us_lines_proj <span class="ot">&lt;-</span><span class="fu">spTransform</span>(us_lines, na_crs)</span>
<span id="cb8-10"><a href="#cb8-10" tabindex="-1"></a></span>
<span id="cb8-11"><a href="#cb8-11" tabindex="-1"></a><span class="fu">plot</span>(coast_lines_proj)</span>
<span id="cb8-12"><a href="#cb8-12" tabindex="-1"></a><span class="fu">plot</span>(admin0_poly_proj, <span class="at">bor=</span><span class="st">&quot;gray&quot;</span>, <span class="at">add=</span><span class="cn">TRUE</span>)</span>
<span id="cb8-13"><a href="#cb8-13" tabindex="-1"></a><span class="fu">plot</span>(coast_lines_proj, <span class="at">add=</span><span class="cn">TRUE</span>)</span></code></pre></div>
<p>Define a bounding box for trimming the polygon and line shape files
to the area covered by the na10km_v2 grid. The extent of the area is
known from the definition of the grid, but could also be determined by
reading an na10km_v2 netCDF file. The projected <code>admin</code> shape
files are quite complicated, and create “topology exception errors”.
These can be fixed using an approach discussed on StackExchange <a
href="http://gis.stackexchange.com/questions/163445/r-solution-for-topologyexception-input-geom-1-is-invalid-self-intersection-er">[link]</a></p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" tabindex="-1"></a>na10km_bb <span class="ot">&lt;-</span> <span class="fu">as</span>(<span class="fu">extent</span>(<span class="sc">-</span><span class="dv">5770000</span>,<span class="dv">5000000</span>,<span class="sc">-</span><span class="dv">4510000</span>,<span class="dv">4480000</span>), <span class="st">&quot;SpatialPolygons&quot;</span>)</span>
<span id="cb9-2"><a href="#cb9-2" tabindex="-1"></a><span class="fu">proj4string</span>(na10km_bb) <span class="ot">&lt;-</span> na_proj4string</span>
<span id="cb9-3"><a href="#cb9-3" tabindex="-1"></a></span>
<span id="cb9-4"><a href="#cb9-4" tabindex="-1"></a>na10km_coast_lines_proj <span class="ot">&lt;-</span> <span class="fu">gIntersection</span>(coast_lines_proj, na10km_bb)</span>
<span id="cb9-5"><a href="#cb9-5" tabindex="-1"></a>na10km_lakes_poly_proj <span class="ot">&lt;-</span> <span class="fu">gIntersection</span>(lakes_poly_proj, na10km_bb)</span>
<span id="cb9-6"><a href="#cb9-6" tabindex="-1"></a>na10km_lrglakes_poly_proj <span class="ot">&lt;-</span> <span class="fu">gIntersection</span>(lrglakes_poly_proj, na10km_bb)</span>
<span id="cb9-7"><a href="#cb9-7" tabindex="-1"></a>na10km_can_poly_proj <span class="ot">&lt;-</span> <span class="fu">gIntersection</span>(can_poly_proj, na10km_bb)</span>
<span id="cb9-8"><a href="#cb9-8" tabindex="-1"></a>na10km_us_poly_proj <span class="ot">&lt;-</span> <span class="fu">gIntersection</span>(us_poly_proj, na10km_bb)</span>
<span id="cb9-9"><a href="#cb9-9" tabindex="-1"></a>na10km_can_lines_proj <span class="ot">&lt;-</span> <span class="fu">gIntersection</span>(can_lines_proj, na10km_bb)</span>
<span id="cb9-10"><a href="#cb9-10" tabindex="-1"></a>na10km_us_lines_proj <span class="ot">&lt;-</span> <span class="fu">gIntersection</span>(us_lines_proj, na10km_bb)</span></code></pre></div>
<p>Now do the <code>admin</code> shape files:</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" tabindex="-1"></a>na10km_bb <span class="ot">&lt;-</span> <span class="fu">gBuffer</span>(na10km_bb, <span class="at">byid=</span><span class="cn">TRUE</span>, <span class="at">width=</span><span class="dv">0</span>)</span>
<span id="cb10-2"><a href="#cb10-2" tabindex="-1"></a>admin0_poly_proj <span class="ot">&lt;-</span> <span class="fu">gSimplify</span>(admin0_poly_proj, <span class="at">tol =</span> <span class="fl">0.00001</span>)</span>
<span id="cb10-3"><a href="#cb10-3" tabindex="-1"></a>na10km_admin0_poly_proj <span class="ot">&lt;-</span> <span class="fu">gBuffer</span>(admin0_poly_proj, <span class="at">byid=</span><span class="cn">TRUE</span>, <span class="at">width=</span><span class="dv">0</span>)</span>
<span id="cb10-4"><a href="#cb10-4" tabindex="-1"></a>na10km_admin0_poly_proj <span class="ot">&lt;-</span> <span class="fu">gIntersection</span>(admin0_poly_proj, <span class="at">byid=</span><span class="cn">TRUE</span>, na10km_bb)</span>
<span id="cb10-5"><a href="#cb10-5" tabindex="-1"></a>admin1_poly_proj <span class="ot">&lt;-</span> <span class="fu">gSimplify</span>(admin1_poly_proj, <span class="at">tol =</span> <span class="fl">0.00001</span>)</span>
<span id="cb10-6"><a href="#cb10-6" tabindex="-1"></a>na10km_admin1_poly_proj <span class="ot">&lt;-</span> <span class="fu">gBuffer</span>(admin1_poly_proj, <span class="at">byid=</span><span class="cn">TRUE</span>, <span class="at">width=</span><span class="dv">0</span>)</span>
<span id="cb10-7"><a href="#cb10-7" tabindex="-1"></a>na10km_admin1_poly_proj <span class="ot">&lt;-</span> <span class="fu">gIntersection</span>(admin1_poly_proj, <span class="at">byid=</span><span class="cn">TRUE</span>, na10km_bb)</span></code></pre></div>
<p>Plot the projected shapefiles.</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" tabindex="-1"></a><span class="fu">plot</span>(na10km_coast_lines_proj)</span>
<span id="cb11-2"><a href="#cb11-2" tabindex="-1"></a><span class="fu">plot</span>(na10km_admin0_poly_proj, <span class="at">bor=</span><span class="st">&quot;gray&quot;</span>, <span class="at">add=</span><span class="cn">TRUE</span>)</span>
<span id="cb11-3"><a href="#cb11-3" tabindex="-1"></a><span class="fu">plot</span>(na10km_can_lines_proj, <span class="at">col=</span><span class="st">&quot;pink&quot;</span>, <span class="at">add=</span><span class="cn">TRUE</span>)</span>
<span id="cb11-4"><a href="#cb11-4" tabindex="-1"></a><span class="fu">plot</span>(na10km_us_lines_proj, <span class="at">col=</span><span class="st">&quot;lightblue&quot;</span>, <span class="at">add=</span><span class="cn">TRUE</span>)</span>
<span id="cb11-5"><a href="#cb11-5" tabindex="-1"></a><span class="fu">plot</span>(na10km_lrglakes_poly_proj, <span class="at">bor=</span><span class="st">&quot;blue&quot;</span>, <span class="at">add=</span><span class="cn">TRUE</span>)</span>
<span id="cb11-6"><a href="#cb11-6" tabindex="-1"></a><span class="fu">plot</span>(na10km_bb, <span class="at">bor=</span><span class="st">&quot;purple&quot;</span>, <span class="at">add=</span><span class="cn">TRUE</span>)</span></code></pre></div>
</div>
<div id="write-out-the-projected-and-trimmed-shape-files"
class="section level2" number="1.3">
<h2><span class="header-section-number">1.3</span> Write out the
projected and trimmed shape files</h2>
<p>Next, write out the projected shapefiles, first setting the output
path.</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" tabindex="-1"></a><span class="co"># write out the various shapefiles </span></span>
<span id="cb12-2"><a href="#cb12-2" tabindex="-1"></a>outpath <span class="ot">&lt;-</span> <span class="st">&quot;/Users/bartlein/Projects/ESSD/data/RMaps/derived/na10km_10m/&quot;</span></span>
<span id="cb12-3"><a href="#cb12-3" tabindex="-1"></a>outshape <span class="ot">&lt;-</span> na10km_coast_lines_proj</span>
<span id="cb12-4"><a href="#cb12-4" tabindex="-1"></a>outfile <span class="ot">&lt;-</span> <span class="st">&quot;na10km_10m_coast_lines&quot;</span></span>
<span id="cb12-5"><a href="#cb12-5" tabindex="-1"></a>outshapefile <span class="ot">&lt;-</span> <span class="fu">paste</span>(outpath,outfile,<span class="at">sep=</span><span class="st">&quot;&quot;</span>)</span>
<span id="cb12-6"><a href="#cb12-6" tabindex="-1"></a>spdf <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="fu">as.numeric</span>(<span class="fu">row.names</span>(outshape)))</span>
<span id="cb12-7"><a href="#cb12-7" tabindex="-1"></a><span class="fu">row.names</span>(spdf) <span class="ot">&lt;-</span> <span class="fu">row.names</span>(outshape)</span>
<span id="cb12-8"><a href="#cb12-8" tabindex="-1"></a>outshape <span class="ot">&lt;-</span> <span class="fu">SpatialLinesDataFrame</span>(outshape, spdf)</span>
<span id="cb12-9"><a href="#cb12-9" tabindex="-1"></a><span class="fu">writeOGR</span>(outshape, outshapefile, outfile, <span class="at">driver=</span><span class="st">&quot;ESRI Shapefile&quot;</span>, <span class="at">overwrite_layer=</span><span class="cn">TRUE</span>)</span></code></pre></div>
<p>It’s always good practice to test whether the shapefile has ideed
been written out correctly. Read it back in and plot it.</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" tabindex="-1"></a>test <span class="ot">&lt;-</span> <span class="fu">readOGR</span>(outshapefile)</span>
<span id="cb13-2"><a href="#cb13-2" tabindex="-1"></a><span class="fu">plot</span>(test, <span class="at">col=</span><span class="st">&quot;black&quot;</span>)</span></code></pre></div>
<p>Write out the other shape files (output is suppressed):</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" tabindex="-1"></a><span class="co"># write out the various shapefiles </span></span>
<span id="cb14-2"><a href="#cb14-2" tabindex="-1"></a>outshape <span class="ot">&lt;-</span> na10km_bb</span>
<span id="cb14-3"><a href="#cb14-3" tabindex="-1"></a>outfile <span class="ot">&lt;-</span> <span class="st">&quot;na10km_10m_bb&quot;</span></span>
<span id="cb14-4"><a href="#cb14-4" tabindex="-1"></a>outshapefile <span class="ot">&lt;-</span> <span class="fu">paste</span>(outpath,outfile,<span class="at">sep=</span><span class="st">&quot;&quot;</span>)</span>
<span id="cb14-5"><a href="#cb14-5" tabindex="-1"></a>spdf <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="fu">as.numeric</span>(<span class="fu">row.names</span>(outshape)))</span>
<span id="cb14-6"><a href="#cb14-6" tabindex="-1"></a><span class="fu">row.names</span>(spdf) <span class="ot">&lt;-</span> <span class="fu">row.names</span>(outshape)</span>
<span id="cb14-7"><a href="#cb14-7" tabindex="-1"></a>outshape <span class="ot">&lt;-</span> <span class="fu">SpatialPolygonsDataFrame</span>(outshape, spdf)</span>
<span id="cb14-8"><a href="#cb14-8" tabindex="-1"></a><span class="fu">writeOGR</span>(outshape, outshapefile, outfile, <span class="at">driver=</span><span class="st">&quot;ESRI Shapefile&quot;</span>, <span class="at">overwrite_layer=</span><span class="cn">TRUE</span>)</span>
<span id="cb14-9"><a href="#cb14-9" tabindex="-1"></a></span>
<span id="cb14-10"><a href="#cb14-10" tabindex="-1"></a>outshape <span class="ot">&lt;-</span> na10km_lakes_poly_proj</span>
<span id="cb14-11"><a href="#cb14-11" tabindex="-1"></a>outfile <span class="ot">&lt;-</span> <span class="st">&quot;na10km_10m_lakes_poly&quot;</span></span>
<span id="cb14-12"><a href="#cb14-12" tabindex="-1"></a>outshapefile <span class="ot">&lt;-</span> <span class="fu">paste</span>(outpath,outfile,<span class="at">sep=</span><span class="st">&quot;&quot;</span>)</span>
<span id="cb14-13"><a href="#cb14-13" tabindex="-1"></a>spdf <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="fu">as.numeric</span>(<span class="fu">row.names</span>(outshape)))</span>
<span id="cb14-14"><a href="#cb14-14" tabindex="-1"></a><span class="fu">row.names</span>(spdf) <span class="ot">&lt;-</span> <span class="fu">row.names</span>(outshape)</span>
<span id="cb14-15"><a href="#cb14-15" tabindex="-1"></a>outshape <span class="ot">&lt;-</span> <span class="fu">SpatialPolygonsDataFrame</span>(outshape, spdf)</span>
<span id="cb14-16"><a href="#cb14-16" tabindex="-1"></a><span class="fu">writeOGR</span>(outshape, outshapefile, outfile, <span class="at">driver=</span><span class="st">&quot;ESRI Shapefile&quot;</span>, <span class="at">overwrite_layer=</span><span class="cn">TRUE</span>)</span>
<span id="cb14-17"><a href="#cb14-17" tabindex="-1"></a></span>
<span id="cb14-18"><a href="#cb14-18" tabindex="-1"></a>outshape <span class="ot">&lt;-</span> na10km_lrglakes_poly_proj</span>
<span id="cb14-19"><a href="#cb14-19" tabindex="-1"></a>outfile <span class="ot">&lt;-</span> <span class="st">&quot;na10km_10m_lrglakes_poly&quot;</span></span>
<span id="cb14-20"><a href="#cb14-20" tabindex="-1"></a>outshapefile <span class="ot">&lt;-</span> <span class="fu">paste</span>(outpath,outfile,<span class="at">sep=</span><span class="st">&quot;&quot;</span>)</span>
<span id="cb14-21"><a href="#cb14-21" tabindex="-1"></a>spdf <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="fu">as.numeric</span>(<span class="fu">row.names</span>(outshape)))</span>
<span id="cb14-22"><a href="#cb14-22" tabindex="-1"></a><span class="fu">row.names</span>(spdf) <span class="ot">&lt;-</span> <span class="fu">row.names</span>(outshape)</span>
<span id="cb14-23"><a href="#cb14-23" tabindex="-1"></a>outshape <span class="ot">&lt;-</span> <span class="fu">SpatialPolygonsDataFrame</span>(outshape, spdf)</span>
<span id="cb14-24"><a href="#cb14-24" tabindex="-1"></a><span class="fu">writeOGR</span>(outshape, outshapefile, outfile, <span class="at">driver=</span><span class="st">&quot;ESRI Shapefile&quot;</span>, <span class="at">overwrite_layer=</span><span class="cn">TRUE</span>)</span>
<span id="cb14-25"><a href="#cb14-25" tabindex="-1"></a></span>
<span id="cb14-26"><a href="#cb14-26" tabindex="-1"></a>outshape <span class="ot">&lt;-</span> na10km_can_poly_proj</span>
<span id="cb14-27"><a href="#cb14-27" tabindex="-1"></a>outfile <span class="ot">&lt;-</span> <span class="st">&quot;na10km_10m_can_poly&quot;</span></span>
<span id="cb14-28"><a href="#cb14-28" tabindex="-1"></a>outshapefile <span class="ot">&lt;-</span> <span class="fu">paste</span>(outpath,outfile,<span class="at">sep=</span><span class="st">&quot;&quot;</span>)</span>
<span id="cb14-29"><a href="#cb14-29" tabindex="-1"></a>spdf <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="fu">as.numeric</span>(<span class="fu">row.names</span>(outshape)))</span>
<span id="cb14-30"><a href="#cb14-30" tabindex="-1"></a><span class="fu">row.names</span>(spdf) <span class="ot">&lt;-</span> <span class="fu">row.names</span>(outshape)</span>
<span id="cb14-31"><a href="#cb14-31" tabindex="-1"></a>outshape <span class="ot">&lt;-</span> <span class="fu">SpatialPolygonsDataFrame</span>(outshape, spdf)</span>
<span id="cb14-32"><a href="#cb14-32" tabindex="-1"></a><span class="fu">writeOGR</span>(outshape, outshapefile, outfile, <span class="at">driver=</span><span class="st">&quot;ESRI Shapefile&quot;</span>, <span class="at">overwrite_layer=</span><span class="cn">TRUE</span>)</span>
<span id="cb14-33"><a href="#cb14-33" tabindex="-1"></a></span>
<span id="cb14-34"><a href="#cb14-34" tabindex="-1"></a>outshape <span class="ot">&lt;-</span> na10km_us_poly_proj</span>
<span id="cb14-35"><a href="#cb14-35" tabindex="-1"></a>outfile <span class="ot">&lt;-</span> <span class="st">&quot;na10km_10m_us_poly&quot;</span></span>
<span id="cb14-36"><a href="#cb14-36" tabindex="-1"></a>outshapefile <span class="ot">&lt;-</span> <span class="fu">paste</span>(outpath,outfile,<span class="at">sep=</span><span class="st">&quot;&quot;</span>)</span>
<span id="cb14-37"><a href="#cb14-37" tabindex="-1"></a>spdf <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="fu">as.numeric</span>(<span class="fu">row.names</span>(outshape)))</span>
<span id="cb14-38"><a href="#cb14-38" tabindex="-1"></a><span class="fu">row.names</span>(spdf) <span class="ot">&lt;-</span> <span class="fu">row.names</span>(outshape)</span>
<span id="cb14-39"><a href="#cb14-39" tabindex="-1"></a>outshape <span class="ot">&lt;-</span> <span class="fu">SpatialPolygonsDataFrame</span>(outshape, spdf)</span>
<span id="cb14-40"><a href="#cb14-40" tabindex="-1"></a><span class="fu">writeOGR</span>(outshape, outshapefile, outfile, <span class="at">driver=</span><span class="st">&quot;ESRI Shapefile&quot;</span>, <span class="at">overwrite_layer=</span><span class="cn">TRUE</span>)</span>
<span id="cb14-41"><a href="#cb14-41" tabindex="-1"></a></span>
<span id="cb14-42"><a href="#cb14-42" tabindex="-1"></a>outshape <span class="ot">&lt;-</span> na10km_can_lines_proj</span>
<span id="cb14-43"><a href="#cb14-43" tabindex="-1"></a>outfile <span class="ot">&lt;-</span> <span class="st">&quot;na10km_10m_can_lines&quot;</span></span>
<span id="cb14-44"><a href="#cb14-44" tabindex="-1"></a>outshapefile <span class="ot">&lt;-</span> <span class="fu">paste</span>(outpath,outfile,<span class="at">sep=</span><span class="st">&quot;&quot;</span>)</span>
<span id="cb14-45"><a href="#cb14-45" tabindex="-1"></a>spdf <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="fu">as.numeric</span>(<span class="fu">row.names</span>(outshape)))</span>
<span id="cb14-46"><a href="#cb14-46" tabindex="-1"></a><span class="fu">row.names</span>(spdf) <span class="ot">&lt;-</span> <span class="fu">row.names</span>(outshape)</span>
<span id="cb14-47"><a href="#cb14-47" tabindex="-1"></a>outshape <span class="ot">&lt;-</span> <span class="fu">SpatialLinesDataFrame</span>(outshape, spdf)</span>
<span id="cb14-48"><a href="#cb14-48" tabindex="-1"></a><span class="fu">writeOGR</span>(outshape, outshapefile, outfile, <span class="at">driver=</span><span class="st">&quot;ESRI Shapefile&quot;</span>, <span class="at">overwrite_layer=</span><span class="cn">TRUE</span>)</span>
<span id="cb14-49"><a href="#cb14-49" tabindex="-1"></a></span>
<span id="cb14-50"><a href="#cb14-50" tabindex="-1"></a>outshape <span class="ot">&lt;-</span> na10km_us_lines_proj</span>
<span id="cb14-51"><a href="#cb14-51" tabindex="-1"></a>outfile <span class="ot">&lt;-</span> <span class="st">&quot;na10km_10m_us_lines&quot;</span></span>
<span id="cb14-52"><a href="#cb14-52" tabindex="-1"></a>outshapefile <span class="ot">&lt;-</span> <span class="fu">paste</span>(outpath,outfile,<span class="at">sep=</span><span class="st">&quot;&quot;</span>)</span>
<span id="cb14-53"><a href="#cb14-53" tabindex="-1"></a>spdf <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="fu">as.numeric</span>(<span class="fu">row.names</span>(outshape)))</span>
<span id="cb14-54"><a href="#cb14-54" tabindex="-1"></a><span class="fu">row.names</span>(spdf) <span class="ot">&lt;-</span> <span class="fu">row.names</span>(outshape)</span>
<span id="cb14-55"><a href="#cb14-55" tabindex="-1"></a>outshape <span class="ot">&lt;-</span> <span class="fu">SpatialLinesDataFrame</span>(outshape, spdf)</span>
<span id="cb14-56"><a href="#cb14-56" tabindex="-1"></a><span class="fu">writeOGR</span>(outshape, outshapefile, outfile, <span class="at">driver=</span><span class="st">&quot;ESRI Shapefile&quot;</span>, <span class="at">overwrite_layer=</span><span class="cn">TRUE</span>)</span>
<span id="cb14-57"><a href="#cb14-57" tabindex="-1"></a></span>
<span id="cb14-58"><a href="#cb14-58" tabindex="-1"></a>outshape <span class="ot">&lt;-</span> na10km_admin0_poly_proj</span>
<span id="cb14-59"><a href="#cb14-59" tabindex="-1"></a>outfile <span class="ot">&lt;-</span> <span class="st">&quot;na10km_10m_admin0_poly&quot;</span></span>
<span id="cb14-60"><a href="#cb14-60" tabindex="-1"></a>outshapefile <span class="ot">&lt;-</span> <span class="fu">paste</span>(outpath,outfile,<span class="at">sep=</span><span class="st">&quot;&quot;</span>)</span>
<span id="cb14-61"><a href="#cb14-61" tabindex="-1"></a>spdf <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="fu">as.numeric</span>(<span class="fu">row.names</span>(outshape)))</span>
<span id="cb14-62"><a href="#cb14-62" tabindex="-1"></a><span class="fu">row.names</span>(spdf) <span class="ot">&lt;-</span> <span class="fu">row.names</span>(outshape)</span>
<span id="cb14-63"><a href="#cb14-63" tabindex="-1"></a>outshape <span class="ot">&lt;-</span> <span class="fu">SpatialPolygonsDataFrame</span>(outshape, spdf)</span>
<span id="cb14-64"><a href="#cb14-64" tabindex="-1"></a><span class="fu">writeOGR</span>(outshape, outshapefile, outfile, <span class="at">driver=</span><span class="st">&quot;ESRI Shapefile&quot;</span>, <span class="at">overwrite_layer=</span><span class="cn">TRUE</span>)</span>
<span id="cb14-65"><a href="#cb14-65" tabindex="-1"></a></span>
<span id="cb14-66"><a href="#cb14-66" tabindex="-1"></a>outshape <span class="ot">&lt;-</span> na10km_admin1_poly_proj</span>
<span id="cb14-67"><a href="#cb14-67" tabindex="-1"></a>outfile <span class="ot">&lt;-</span> <span class="st">&quot;na10km_10m_admin1_poly&quot;</span></span>
<span id="cb14-68"><a href="#cb14-68" tabindex="-1"></a>outshapefile <span class="ot">&lt;-</span> <span class="fu">paste</span>(outpath,outfile,<span class="at">sep=</span><span class="st">&quot;&quot;</span>)</span>
<span id="cb14-69"><a href="#cb14-69" tabindex="-1"></a>spdf <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="fu">as.numeric</span>(<span class="fu">row.names</span>(outshape)))</span>
<span id="cb14-70"><a href="#cb14-70" tabindex="-1"></a><span class="fu">row.names</span>(spdf) <span class="ot">&lt;-</span> <span class="fu">row.names</span>(outshape)</span>
<span id="cb14-71"><a href="#cb14-71" tabindex="-1"></a>outshape <span class="ot">&lt;-</span> <span class="fu">SpatialPolygonsDataFrame</span>(outshape, spdf)</span>
<span id="cb14-72"><a href="#cb14-72" tabindex="-1"></a><span class="fu">writeOGR</span>(outshape, outshapefile, outfile, <span class="at">driver=</span><span class="st">&quot;ESRI Shapefile&quot;</span>, <span class="at">overwrite_layer=</span><span class="cn">TRUE</span>)</span></code></pre></div>
<p><a href="Rmaps2.html">[Back to top]</a></p>
</div>
</div>
<div id="map-of-north-american-shaded-relief" class="section level1"
number="2">
<h1><span class="header-section-number">2</span> Map of North American
shaded relief</h1>
<div id="read-the-read-the-projected-and-trimmed-shapefiles"
class="section level2" number="2.1">
<h2><span class="header-section-number">2.1</span> Read the read the
projected and trimmed shapefiles</h2>
<p>Load the appropriate packages.</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" tabindex="-1"></a><span class="fu">library</span>(sp)</span></code></pre></div>
<p>Read the shapefiles:</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" tabindex="-1"></a>shapepath <span class="ot">&lt;-</span> <span class="st">&quot;/Users/bartlein/Projects/ESSD/data/RMaps/derived/na10km_10m/&quot;</span></span>
<span id="cb16-2"><a href="#cb16-2" tabindex="-1"></a>na10km_bb <span class="ot">&lt;-</span> <span class="fu">readOGR</span>(<span class="fu">paste</span>(shapepath, <span class="st">&quot;na10km_10m_bb.shp&quot;</span>, <span class="at">sep=</span><span class="st">&quot;&quot;</span>))</span>
<span id="cb16-3"><a href="#cb16-3" tabindex="-1"></a>na10km_coast_lines_proj <span class="ot">&lt;-</span> <span class="fu">readOGR</span>(<span class="fu">paste</span>(shapepath, <span class="st">&quot;na10km_10m_coast_lines.shp&quot;</span>, <span class="at">sep=</span><span class="st">&quot;&quot;</span>))</span>
<span id="cb16-4"><a href="#cb16-4" tabindex="-1"></a>na10km_admin0_poly_proj <span class="ot">&lt;-</span> <span class="fu">readOGR</span>(<span class="fu">paste</span>(shapepath, <span class="st">&quot;na10km_10m_admin0_poly.shp&quot;</span>, <span class="at">sep=</span><span class="st">&quot;&quot;</span>))</span>
<span id="cb16-5"><a href="#cb16-5" tabindex="-1"></a>na10km_lakes_poly_proj <span class="ot">&lt;-</span> <span class="fu">readOGR</span>(<span class="fu">paste</span>(shapepath, <span class="st">&quot;na10km_10m_lakes_poly.shp&quot;</span>, <span class="at">sep=</span><span class="st">&quot;&quot;</span>))</span>
<span id="cb16-6"><a href="#cb16-6" tabindex="-1"></a>na10km_lrglakes_poly_proj <span class="ot">&lt;-</span> <span class="fu">readOGR</span>(<span class="fu">paste</span>(shapepath, <span class="st">&quot;na10km_10m_lrglakes_poly.shp&quot;</span>, <span class="at">sep=</span><span class="st">&quot;&quot;</span>))</span>
<span id="cb16-7"><a href="#cb16-7" tabindex="-1"></a>na10km_can_lines_proj <span class="ot">&lt;-</span> <span class="fu">readOGR</span>(<span class="fu">paste</span>(shapepath, <span class="st">&quot;na10km_10m_can_lines.shp&quot;</span>, <span class="at">sep=</span><span class="st">&quot;&quot;</span>))</span>
<span id="cb16-8"><a href="#cb16-8" tabindex="-1"></a>na10km_us_lines_proj <span class="ot">&lt;-</span> <span class="fu">readOGR</span>(<span class="fu">paste</span>(shapepath, <span class="st">&quot;na10km_10m_us_lines.shp&quot;</span>, <span class="at">sep=</span><span class="st">&quot;&quot;</span>))</span></code></pre></div>
<p>Plot the projected and trimmed shapefiles:</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" tabindex="-1"></a><span class="fu">plot</span>(na10km_admin0_poly_proj, <span class="at">bor=</span><span class="st">&quot;gray&quot;</span>)</span>
<span id="cb17-2"><a href="#cb17-2" tabindex="-1"></a><span class="fu">plot</span>(na10km_can_lines_proj, <span class="at">col=</span><span class="st">&quot;gray&quot;</span>, <span class="at">add=</span><span class="cn">TRUE</span>)</span>
<span id="cb17-3"><a href="#cb17-3" tabindex="-1"></a><span class="fu">plot</span>(na10km_us_lines_proj, <span class="at">col=</span><span class="st">&quot;gray&quot;</span>, <span class="at">add=</span><span class="cn">TRUE</span>)</span>
<span id="cb17-4"><a href="#cb17-4" tabindex="-1"></a><span class="fu">plot</span>(na10km_lrglakes_poly_proj, <span class="at">col=</span><span class="st">&quot;lightblue&quot;</span>, <span class="at">add=</span><span class="cn">TRUE</span>)</span>
<span id="cb17-5"><a href="#cb17-5" tabindex="-1"></a><span class="fu">plot</span>(na10km_coast_lines_proj, <span class="at">col=</span><span class="st">&quot;black&quot;</span>, <span class="at">add=</span><span class="cn">TRUE</span>)</span>
<span id="cb17-6"><a href="#cb17-6" tabindex="-1"></a><span class="fu">plot</span>(na10km_bb, <span class="at">bor=</span><span class="st">&quot;black&quot;</span>, <span class="at">add=</span><span class="cn">TRUE</span>)</span></code></pre></div>
</div>
<div id="read-a-shaded-relief-file" class="section level2" number="2.2">
<h2><span class="header-section-number">2.2</span> Read a shaded relief
file</h2>
<p>Read a pre-computed shaded relief file. This could also be crearted
by reading the na10km_v2 grid-point elevations and using the
<code>hillshade</code> function from the <code>raster</code> package.
Note that in this file, the coordinates are in km, and so they must be
multiplied by 1000.</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" tabindex="-1"></a>datapath <span class="ot">&lt;-</span> <span class="st">&quot;/Users/bartlein/Projects/ESSD/data/csv_files/&quot;</span></span>
<span id="cb18-2"><a href="#cb18-2" tabindex="-1"></a>datafile <span class="ot">&lt;-</span> <span class="st">&quot;na10km_shade.csv&quot;</span></span>
<span id="cb18-3"><a href="#cb18-3" tabindex="-1"></a>shade <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="fu">paste</span>(datapath,datafile,<span class="at">sep=</span><span class="st">&quot;&quot;</span>))</span>
<span id="cb18-4"><a href="#cb18-4" tabindex="-1"></a>shade<span class="sc">$</span>x <span class="ot">&lt;-</span> shade<span class="sc">$</span>x<span class="sc">*</span><span class="dv">1000</span></span>
<span id="cb18-5"><a href="#cb18-5" tabindex="-1"></a>shade<span class="sc">$</span>y <span class="ot">&lt;-</span> shade<span class="sc">$</span>y<span class="sc">*</span><span class="dv">1000</span></span>
<span id="cb18-6"><a href="#cb18-6" tabindex="-1"></a><span class="fu">head</span>(shade)</span></code></pre></div>
<p>Convert the dataframe to a SpatialPixelsData Frame</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" tabindex="-1"></a><span class="fu">coordinates</span>(shade) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;x&quot;</span>,<span class="st">&quot;y&quot;</span>)</span>
<span id="cb19-2"><a href="#cb19-2" tabindex="-1"></a><span class="fu">points2grid</span>(shade)</span>
<span id="cb19-3"><a href="#cb19-3" tabindex="-1"></a>shade_pixels <span class="ot">&lt;-</span> <span class="fu">as</span>(shade, <span class="st">&quot;SpatialPixelsDataFrame&quot;</span>)</span>
<span id="cb19-4"><a href="#cb19-4" tabindex="-1"></a><span class="fu">summary</span>(shade_pixels)</span></code></pre></div>
<p>Read some predetermined (gray-scale) colors for the shading.</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" tabindex="-1"></a>colorfile <span class="ot">&lt;-</span> <span class="st">&quot;shade40_clr.csv&quot;</span></span>
<span id="cb20-2"><a href="#cb20-2" tabindex="-1"></a>shade_rgb <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="fu">paste</span>(datapath, colorfile, <span class="at">sep=</span><span class="st">&quot;&quot;</span>))</span>
<span id="cb20-3"><a href="#cb20-3" tabindex="-1"></a>shade_clr <span class="ot">&lt;-</span> <span class="fu">rgb</span>(shade_rgb)</span></code></pre></div>
<p>Set the (gray-scale) color numbers for each pixel:</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" tabindex="-1"></a>shade_int <span class="ot">&lt;-</span> <span class="fu">as.integer</span>(((shade<span class="sc">$</span>shade<span class="sc">+</span><span class="dv">1</span>)<span class="sc">/</span><span class="dv">2</span>)<span class="sc">*</span><span class="dv">40</span>)<span class="sc">+</span><span class="dv">1</span></span>
<span id="cb21-2"><a href="#cb21-2" tabindex="-1"></a>shade_colnum <span class="ot">&lt;-</span> shade_clr[shade_int]</span></code></pre></div>
</div>
<div id="make-the-map" class="section level2" number="2.3">
<h2><span class="header-section-number">2.3</span> Make the map</h2>
<p>Plot the shaded-relief colors and the various shape files. The
location of the text string was determined by plotting an initial
version ofthe map, and using the <code>locate()</code> function. The
<code>cex=0.09</code> argument in the <code>points()</code> function was
detrmined by trial and error.</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" tabindex="-1"></a><span class="fu">pdf</span>(<span class="at">file =</span> <span class="st">&quot;na_shade01b.pdf&quot;</span>)</span>
<span id="cb22-2"><a href="#cb22-2" tabindex="-1"></a><span class="fu">plot</span>(na10km_bb, <span class="at">col=</span><span class="st">&quot;gray95&quot;</span>)</span>
<span id="cb22-3"><a href="#cb22-3" tabindex="-1"></a><span class="fu">points</span>(shade_pixels, <span class="at">pch=</span><span class="dv">15</span>, <span class="at">cex=</span><span class="fl">0.09</span>, <span class="at">col=</span>shade_colnum)</span>
<span id="cb22-4"><a href="#cb22-4" tabindex="-1"></a><span class="fu">plot</span>(na10km_admin0_poly_proj, <span class="at">lwd=</span><span class="fl">0.2</span>, <span class="at">bor=</span><span class="st">&quot;gray50&quot;</span>, <span class="at">add=</span><span class="cn">TRUE</span>)</span>
<span id="cb22-5"><a href="#cb22-5" tabindex="-1"></a><span class="fu">plot</span>(na10km_can_lines_proj, <span class="at">lwd=</span><span class="fl">0.2</span>, <span class="at">col=</span><span class="st">&quot;gray50&quot;</span>, <span class="at">add=</span><span class="cn">TRUE</span>)</span>
<span id="cb22-6"><a href="#cb22-6" tabindex="-1"></a><span class="fu">plot</span>(na10km_us_lines_proj, <span class="at">lwd=</span><span class="fl">0.2</span>, <span class="at">col=</span><span class="st">&quot;gray50&quot;</span>, <span class="at">add=</span><span class="cn">TRUE</span>)</span>
<span id="cb22-7"><a href="#cb22-7" tabindex="-1"></a><span class="fu">plot</span>(na10km_lrglakes_poly_proj, <span class="at">lwd=</span><span class="fl">0.2</span>, <span class="at">bor=</span><span class="st">&quot;black&quot;</span>, <span class="at">col=</span><span class="st">&quot;gray90&quot;</span>, <span class="at">add=</span><span class="cn">TRUE</span>)</span>
<span id="cb22-8"><a href="#cb22-8" tabindex="-1"></a><span class="fu">plot</span>(na10km_coast_lines_proj, <span class="at">lwd=</span><span class="fl">0.3</span>, <span class="at">add=</span><span class="cn">TRUE</span>)</span>
<span id="cb22-9"><a href="#cb22-9" tabindex="-1"></a><span class="fu">text</span>(<span class="sc">-</span><span class="dv">5770000</span>, <span class="dv">4620000</span>, <span class="at">pos=</span><span class="fu">c</span>(<span class="dv">4</span>), <span class="at">offset=</span><span class="fl">0.0</span>, <span class="at">cex=</span><span class="fl">1.0</span>, <span class="st">&quot;NA10km_v2 -- 10m Natural Earth Outlines&quot;</span>)</span>
<span id="cb22-10"><a href="#cb22-10" tabindex="-1"></a><span class="fu">plot</span>(na10km_bb, <span class="at">add=</span><span class="cn">TRUE</span>)</span>
<span id="cb22-11"><a href="#cb22-11" tabindex="-1"></a><span class="fu">dev.off</span>()</span></code></pre></div>
<p>The resulting plot will look like this: <img
src="images/na_shade01b.png" /></p>
<p><a href="Rmaps2.html">[Back to top]</a></p>
</div>
</div>




</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.odd').parent('tbody').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open');
  });
});
</script>

<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
